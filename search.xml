<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>使用Oracle oswatcher工具监控服务器性能并生成图形报告</title>
      <link href="/post/709b78ae.html"/>
      <url>/post/709b78ae.html</url>
      
        <content type="html"><![CDATA[<h2 id="关于-OSW"><a href="#关于-OSW" class="headerlink" title="关于  OSW"></a>关于  OSW</h2><p>OSWatcher 的使用符合 Oracle 的标准许可条款，并且不需要额外的许可即可使用！！！！</p><p><strong>关注本人微信公众号，后台回复“oswatcher”获取安装包!!</strong></p><p>OSWatcher (oswbb) 是一种 UNIX shell 脚本的集合，主要用于收集和归档操作系统和网络的度量，以便为诊断性能问题提供支持。作为最佳实践，用户应当在所有运行着 Oracle 实例的节点安装和运行 OSWatcher。当诊断性能问题的时候， Oracle support 可以采用 OSWatcher 数据来诊断那些可能已经超出数据库之外的性能问题。OSWatcher 可以从 MOS Note 301137.1 下载</p><p>作为最佳实践，Oracle Support 建议所有用户在其运行 Oracle 的服务器上部署 OSWatcher。OSWatcher 应被视为任何数据收集可能存在的附加或补充。主要原因是，如果 Oracle Support 不得不向开发提交一个 Bug，那么开发很可能会坚持要求提供 OSWatcher 数据。如果没有，该 Bug 可能无法继续分析，直到安装了 OSWatcher 并且问题再现。此外，比起其他工具，Oracle Support 更熟悉 OSWatcher 并且接受了 OSWatcher 的培训，他们了解基本操作系统诊断实用程序（如 vmstat、iostat、top 等）的输出。Oracle Support 可能不熟悉您现有的其他类型的自定义或特定于操作系统的数据收集工具。最后，Oracle Support 能够使用内部工具分析 OSWatcher 数据，避免耗时的任务比如必须手动检查成堆的文件。这将大大减少问题的解决时间。<br>Oracle Support 建议您使用默认快照间隔运行 OSWatcher，即 30 秒采样间隔和 48 小时的默认保留期。 以较低的频率采样或者大于 60 秒的采样对于诊断性能问题没有太大用处。</p><p>OSWatcher 更适合于小规模的情况，毕竟每台单机都要部署一次，性能都要单独分析！下面我就演示一下最新版本的oswbb840版本的安装及性能报告生成。</p><h2 id="安装oswbba"><a href="#安装oswbba" class="headerlink" title="安装oswbba"></a>安装oswbba</h2><p>上传文件oswbb840.tar到服务器&#x2F;root目录</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@rac1 ~]# mkdir -p /osw_monitor</span><br><span class="line">[root@rac1 ~]# chown -R grid:oinstall /osw_monitor/</span><br><span class="line">[root@rac1 ~]# mv /root/oswbb840.tar  /osw_monitor/</span><br><span class="line">[root@rac1 ~]# chown -R grid:oinstall /osw_monitor/oswbb840.tar </span><br><span class="line">[root@rac1 ~]# su - grid</span><br><span class="line">[grid@rac1 osw_monitor]$ tar -xvf oswbb840.tar </span><br><span class="line">[grid@rac1 osw_monitor]$ ls</span><br><span class="line">oswbb  oswbb840.tar</span><br></pre></td></tr></table></figure><h2 id="创建RAC心跳网络监控配置文件"><a href="#创建RAC心跳网络监控配置文件" class="headerlink" title="创建RAC心跳网络监控配置文件"></a>创建RAC心跳网络监控配置文件</h2><p>这个仅适用于RAC，如果你是单机，可以不看这节。</p><p>这里在oswbb目录提供了一个示例，只需要截取需要的部份并创建private.net文件就行，下面是整个配置文件示例</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">[grid@rac1 osw_monitor]$ cd oswbb</span><br><span class="line">[grid@rac1 oswbb]$ cat Exampleprivate.net </span><br><span class="line">######################################################################</span><br><span class="line"># This file contains examples of how to monitor private networks. To</span><br><span class="line"># monitor your private networks create an executable file in this same</span><br><span class="line"># directory named private.net. Use the example for your host os below.</span><br><span class="line"># Make sure not to remove the last line in this file. Your file</span><br><span class="line"># private.net MUST contain the rm lock.file line.</span><br><span class="line">######################################################################</span><br><span class="line">#Solaris Example</span><br><span class="line">######################################################################</span><br><span class="line">echo &quot;zzz ***&quot;`date`</span><br><span class="line">traceroute -r -F &lt;node1-priv&gt;</span><br><span class="line">traceroute -I -r -F &lt;node1-priv&gt;</span><br><span class="line">traceroute -r -F &lt;node2-priv&gt;</span><br><span class="line">traceroute -I -r -F &lt;node2-priv&gt;</span><br><span class="line">######################################################################</span><br><span class="line">#HP Example</span><br><span class="line">######################################################################</span><br><span class="line">echo &quot;zzz ***&quot;`date`</span><br><span class="line">traceroute -r -F &lt;node1-priv&gt; </span><br><span class="line">traceroute -r -F &lt;node2-priv&gt; </span><br><span class="line"></span><br><span class="line">######################################################################</span><br><span class="line">#Linux Example</span><br><span class="line">######################################################################</span><br><span class="line">echo &quot;zzz ***&quot;`date`</span><br><span class="line">traceroute -r -F &lt;node1-priv&gt; </span><br><span class="line">traceroute -r -F &lt;node2-priv&gt;</span><br><span class="line">######################################################################</span><br><span class="line">#Tru64 Example</span><br><span class="line">######################################################################</span><br><span class="line">echo &quot;zzz ***&quot;`date`</span><br><span class="line">traceroute -r -f &lt;node1-priv&gt;</span><br><span class="line">traceroute -r -f &lt;node2-priv&gt;</span><br><span class="line">######################################################################</span><br><span class="line">#AIX Example</span><br><span class="line">######################################################################</span><br><span class="line">echo &quot;zzz ***&quot;`date`</span><br><span class="line">traceroute -r &lt;node1-priv&gt;</span><br><span class="line">traceroute -r &lt;node2-priv&gt;</span><br><span class="line">######################################################################</span><br><span class="line"># DO NOT DELETE THE FOLLOWING LINE!!!!!!!!!!!!!!!!!!!!!</span><br><span class="line">######################################################################</span><br><span class="line">rm locks/lock.file</span><br><span class="line">[grid@rac1 oswbb]$ </span><br></pre></td></tr></table></figure><p>例如我这里监控的系统是linux，那么需要创建private.net文件内容如下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">######################################################################</span><br><span class="line">#Linux Example</span><br><span class="line">######################################################################</span><br><span class="line">echo &quot;zzz ***&quot;`date`</span><br><span class="line">traceroute -r -F rac1-priv</span><br><span class="line">traceroute -r -F rac2-priv</span><br><span class="line">######################################################################</span><br><span class="line"># DO NOT DELETE THE FOLLOWING LINE!!!!!!!!!!!!!!!!!!!!!</span><br><span class="line">######################################################################</span><br><span class="line">rm locks/lock.file</span><br></pre></td></tr></table></figure><h2 id="运行osw并进行监控"><a href="#运行osw并进行监控" class="headerlink" title="运行osw并进行监控"></a>运行osw并进行监控</h2><p>这里要重点说明一下，比如7版本的LINUX默认最小安装后，没有相应的网络命令，要提前安装下net-tools包。</p><p>手动启动 OSWbb 实用程序，可以直接在 OSWbb 的安装目录下执行 startOSWbb.sh shell 脚本,  该脚本一共有4个参数,其中两个为可选参数,他们分别是:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$1 = 快照间隔，以秒为单位。</span><br><span class="line">$2 = 要存储的归档数据的小时数。</span><br><span class="line">$3 = (可选)压缩工具的名称，可以自动将生成的文件进行压缩。</span><br><span class="line">$4 = (可选)保存归档的非默认路径，改参数用于替换OSWBB_ARCHIVE_DEST环境变量，</span><br></pre></td></tr></table></figure><p>这里设置保留每5s采集一次，保存期限360h&#x2F;24&#x3D;15天，后台运行，只需要执行nohup .&#x2F;startOSWbb.sh 5 360  &amp;即可</p><p>（如果不用nohup会在当前屏幕打印一堆）如果想要看输出，可以tail -f nohup.out文件。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">[grid@rac1 oswbb]$ nohup ./startOSWbb.sh 5 360  &amp;</span><br><span class="line"></span><br><span class="line">[grid@rac1 oswbb]$ tail -f nohup.out </span><br><span class="line">Setting the archive log directory to/osw_monitor/oswbb/archive</span><br><span class="line"></span><br><span class="line">Testing for discovery of OS Utilities...</span><br><span class="line">VMSTAT found on your system.</span><br><span class="line">IOSTAT found on your system.</span><br><span class="line">MPSTAT found on your system.</span><br><span class="line">IP found on your system.</span><br><span class="line">TOP found on your system.</span><br><span class="line">PIDSTAT found on your system.</span><br><span class="line">NFSIOSTAT found on your system.</span><br><span class="line">ARP found on your system.</span><br><span class="line">TRACEROUTE found on your system.</span><br><span class="line">Number of RAC Nodes: 2</span><br><span class="line"></span><br><span class="line">The following Nodes are members of RAC Cluster:</span><br><span class="line">Local Node: rac1</span><br><span class="line">Remote Node(s): rac2</span><br><span class="line"></span><br><span class="line"> CRS is up and running on local Node</span><br><span class="line"></span><br><span class="line">ssh test is successful on all RAC Nodes.</span><br><span class="line">Private.net configured on local node !</span><br><span class="line"></span><br><span class="line">Discovery of CPU CORE COUNT</span><br><span class="line">CPU CORE COUNT will be used by oswbba to automatically look for cpu problems</span><br><span class="line"></span><br><span class="line">CPU CORE COUNT = 4</span><br><span class="line">VCPUS/THREADS = 4</span><br><span class="line"></span><br><span class="line">Discovery completed.</span><br><span class="line"></span><br><span class="line">Starting OSWatcher v8.4.0  on Thu Dec 5 21:50:11 CST 2024</span><br><span class="line">With SnapshotInterval = 5</span><br><span class="line">With ArchiveInterval = 360</span><br><span class="line"></span><br><span class="line">OSWatcher - Written by Carl Davis, Center of Expertise,</span><br><span class="line">Oracle Corporation</span><br><span class="line">For questions on install/usage please go to MOS (Note:301137.1)</span><br><span class="line"></span><br><span class="line">Data is stored in directory: /osw_monitor/oswbb/archive</span><br><span class="line"></span><br><span class="line">Starting Data Collection...</span><br><span class="line"></span><br><span class="line">oswbb heartbeat:Thu Dec 5 21:50:16 CST 2024</span><br><span class="line">oswbb heartbeat:Thu Dec 5 21:50:21 CST 2024</span><br><span class="line">oswbb heartbeat:Thu Dec 5 21:50:26 CST 2024</span><br><span class="line">oswbb heartbeat:Thu Dec 5 21:50:31 CST 2024</span><br></pre></td></tr></table></figure><p>如果想要停止监控，只要执行stopSWbb.sh即可。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[grid@rac1 oswbb]$ nohup ./stopSWbb.sh</span><br></pre></td></tr></table></figure><h2 id="如何在windows执行生成报告"><a href="#如何在windows执行生成报告" class="headerlink" title="如何在windows执行生成报告"></a>如何在windows执行生成报告</h2><p>当然也是支持在Linux上输出图形报告，这要求你必须安装了x windows，并配置JDK环境，然后执行命令输出图形。</p><p>如果你的oracle服务不能安装图形界面且不能安装最新的JDK，那么我推荐你把监控数据打包拷贝到windows上，然后在windows端解析，新版本可以直接生成HTML报告，HTML看起来更友好。</p><p>我这里用的是新版本840的，所以需要最低jdk 1.8才行。windows安装JDK就没有啥可说的，一直下一步就行，环境变量不想配置也可以，只要cmd下执行java -jar能看到当前版本就OK。</p><p>那行，首先在linux端打包收集的信息，在oswbb目录下执行脚本，会在当前目录下生成tar包</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[grid@rac1 oswbb]$ ./tar_up_full_archive.sh /osw_monitor/</span><br><span class="line">[grid@rac1 oswbb]$ ls *.tar</span><br><span class="line">osw_archive_1205242152.tar</span><br></pre></td></tr></table></figure><p>文件拷贝到windows，解压到E盘根目录下，电脑安装JDK 1.8配置好环境变量。</p><p>先解压该压缩包，会生成osw_monitor文件夹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E:\&gt;winrar x osw_archive_1205242152.tar</span><br></pre></td></tr></table></figure><p>我们把新版本的解析包oswbba9013拷贝到E盘，然后执行如下命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -Duser.language=en -Duser.country=us -jar -Xmx256m e:\oswbba9013.jar -i E:\osw_monitor\oswbb\archive</span><br></pre></td></tr></table></figure><p>这里进入到交互式界面，我这里按D生成HTML报告</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br></pre></td><td class="code"><pre><span class="line">E:\&gt;java -Duser.language=en -Duser.country=us -jar -Xmx256m e:\oswbba9013.jar -i</span><br><span class="line"> E:\osw_monitor\oswbb\archive</span><br><span class="line"></span><br><span class="line">Validating times in the archive...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Starting OSW Analyzer V9.0.13</span><br><span class="line">Copyright (c)  2023 by Oracle Corporation</span><br><span class="line"></span><br><span class="line">Parsing Data. Please Wait...</span><br><span class="line"></span><br><span class="line">Scanning file headers for version and platform info...</span><br><span class="line"></span><br><span class="line">Parsing file rac1_prvtnet_24.12.05.2100.dat ...</span><br><span class="line"></span><br><span class="line">Parsing file rac1_pidstat_24.12.05.2100.dat ...</span><br><span class="line"></span><br><span class="line">Parsing file rac1_iostat_24.12.05.2100.dat ...</span><br><span class="line"></span><br><span class="line">Parsing file rac1_nfsiostat_24.12.05.2100.dat ...</span><br><span class="line"></span><br><span class="line">Parsing file rac1_vmstat_24.12.05.2100.dat ...</span><br><span class="line"></span><br><span class="line">Parsing file rac1_meminfo_24.12.05.2100.dat ...</span><br><span class="line"></span><br><span class="line">Parsing file rac1_netstat_24.12.05.2100.dat ...</span><br><span class="line"></span><br><span class="line">Parsing file rac1_top_24.12.05.2100.dat ...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Parsing file rac1_ps_24.12.05.2100.dat ...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Parsing Completed.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Enter 1 to Display CPU Process Queue Graphs</span><br><span class="line">Enter 2 to Display CPU Utilization Graphs</span><br><span class="line">Enter 3 to Display CPU Other Graphs</span><br><span class="line">Enter 4 to Display Memory Graphs</span><br><span class="line">Enter 5 to Display Disk IO Graphs</span><br><span class="line">Enter 61 to Display Individual OS Process I/O RPS Graphs</span><br><span class="line">Enter 62 to Display Individual OS Process I/O WPS Graphs</span><br><span class="line">Enter 63 to Display Individual OS Process Percent User CPU Graphs</span><br><span class="line">Enter 64 to Display Individual OS Process Percent System CPU Graphs</span><br><span class="line">Enter 65 to Display Individual OS Process Percent Total CPU (User + System) Grap</span><br><span class="line">hs</span><br><span class="line">Enter 66 to Display Individual OS Process Percent Memory Graphs</span><br><span class="line"></span><br><span class="line">Enter GP to Generate Individual Process Profile</span><br><span class="line">Enter GC to Generate All CPU Gif Files</span><br><span class="line">Enter GM to Generate All Memory Gif Files</span><br><span class="line">Enter GD to Generate All Disk Gif Files</span><br><span class="line">Enter GN to Generate All Network Gif Files</span><br><span class="line"></span><br><span class="line">Enter L to Specify Alternate Location of Gif Directory</span><br><span class="line">Enter Z to Zoom Graph Time Scale (Does not change analysis dataset)</span><br><span class="line">Enter B to Returns to Baseline Graph Time Scale (Does not change analysis datase</span><br><span class="line">t)</span><br><span class="line">Enter R to Remove Currently Displayed Graphs</span><br><span class="line"></span><br><span class="line">Enter X to Export Parsed Data to Flat File</span><br><span class="line">Enter S to Analyze Subset of Data(Changes analysis dataset including graph time</span><br><span class="line">scale)</span><br><span class="line">Enter A to Analyze Data</span><br><span class="line">Enter D to Generate DashBoard</span><br><span class="line"></span><br><span class="line">Enter Q to Quit Program</span><br><span class="line"></span><br><span class="line">Please Select an Option:D</span><br><span class="line">Enter a unique analysis/dashboard directory name or enter &lt;CR&gt; to accept default</span><br><span class="line"> name:</span><br><span class="line"></span><br><span class="line">A new analysis file analysis\rac1_Dec05215016_1733407401\analysis.txt has been c</span><br><span class="line">reated.</span><br><span class="line"></span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_OS_Run_Queue.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_OS_Run_Adjusted_Queue.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_OS_Block_Queue.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_OS_HB.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_PS_Processes.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_OS_Cpu_Idle.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_OS_Cpu_Util.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_OS_Cpu_System.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_OS_Cpu_User.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_OS_Cpu_Wa.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_OS_Cpu_Interrupts.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_OS_Context_Switches.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_OS_Memory_Swap.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_OS_Memory_Page_In_Rate.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_OS_Memory_Page_Out_Rate.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_MemInfoTotalMem.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_MemInfoFreeMem.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_MemInfoAvailMem.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_MemInfoPercentFree.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_OS_Cpu_Wa.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_OS_Block_Queue.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_OS_IO_ST.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_OS_IO_AW.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_OS_IO_PB.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_OS_IO_RPS.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_OS_IO_WPS.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_OS_IO_TPS.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_link_ lo_rx_ok.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_link_ lo_rx_err.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_link_ lo_rx_drp.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_link_ lo_rx_ovr.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_link_ lo_tx_ok.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_link_ lo_tx_err.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_link_ lo_tx_drp.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_link_ eth0_rx_ok.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_link_ eth0_rx_err.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_link_ eth0_rx_drp.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_link_ eth0_rx_ovr.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_link_ eth0_tx_ok.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_link_ eth0_tx_err.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_link_ eth0_tx_drp.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_link_ eth1_rx_ok.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_link_ eth1_rx_err.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_link_ eth1_rx_drp.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_link_ eth1_rx_ovr.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_link_ eth1_tx_ok.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_link_ eth1_tx_err.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_link_ eth1_tx_drp.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_link_ eth2_rx_ok.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_link_ eth2_rx_err.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_link_ eth2_rx_drp.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_link_ eth2_rx_ovr.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_link_ eth2_tx_ok.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_link_ eth2_tx_err.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_link_ eth2_tx_drp.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_IpOutRequests.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_IpInReceives.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_IpFragCreates.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_IpFragOKs.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_IpInDiscards.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_IpReasmFails.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_ip_fragments_in_rate.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_ip_fragments_out_rate.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_UdpInDatagrams.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_UdpOutDatagrams.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_UdpInErrors.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_UdpInCsumErrors.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_UdpRcvbufErrors.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_UdpSndbufErrors.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_TcpInSegs.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_TcpOutSegs.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_TcpRetransSegs.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_TcpOutRsts.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_TcpEstabResets.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_TcpAttemptFails.jpg</span><br><span class="line">Generating file analysis\rac1_Dec05215016_1733407401\dashboard\generated_files\O</span><br><span class="line">SWg_tcp_retran_error_rate.jpg</span><br><span class="line"></span><br><span class="line">Files written to the analysis directory.</span><br><span class="line"></span><br><span class="line">Enter 1 to Display CPU Process Queue Graphs</span><br><span class="line">Enter 2 to Display CPU Utilization Graphs</span><br><span class="line">Enter 3 to Display CPU Other Graphs</span><br><span class="line">Enter 4 to Display Memory Graphs</span><br><span class="line">Enter 5 to Display Disk IO Graphs</span><br><span class="line">Enter 61 to Display Individual OS Process I/O RPS Graphs</span><br><span class="line">Enter 62 to Display Individual OS Process I/O WPS Graphs</span><br><span class="line">Enter 63 to Display Individual OS Process Percent User CPU Graphs</span><br><span class="line">Enter 64 to Display Individual OS Process Percent System CPU Graphs</span><br><span class="line">Enter 65 to Display Individual OS Process Percent Total CPU (User + System) Grap</span><br><span class="line">hs</span><br><span class="line">Enter 66 to Display Individual OS Process Percent Memory Graphs</span><br><span class="line"></span><br><span class="line">Enter GP to Generate Individual Process Profile</span><br><span class="line">Enter GC to Generate All CPU Gif Files</span><br><span class="line">Enter GM to Generate All Memory Gif Files</span><br><span class="line">Enter GD to Generate All Disk Gif Files</span><br><span class="line">Enter GN to Generate All Network Gif Files</span><br><span class="line"></span><br><span class="line">Enter L to Specify Alternate Location of Gif Directory</span><br><span class="line">Enter Z to Zoom Graph Time Scale (Does not change analysis dataset)</span><br><span class="line">Enter B to Returns to Baseline Graph Time Scale (Does not change analysis datase</span><br><span class="line">t)</span><br><span class="line">Enter R to Remove Currently Displayed Graphs</span><br><span class="line"></span><br><span class="line">Enter X to Export Parsed Data to Flat File</span><br><span class="line">Enter S to Analyze Subset of Data(Changes analysis dataset including graph time</span><br><span class="line">scale)</span><br><span class="line">Enter A to Analyze Data</span><br><span class="line">Enter D to Generate DashBoard</span><br><span class="line"></span><br><span class="line">Enter Q to Quit Program</span><br><span class="line"></span><br><span class="line">Please Select an Option:</span><br></pre></td></tr></table></figure><p>然后就在E盘下生成如下目录。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E:\analysis\rac1_Dec05215016_1733407401\dashboard</span><br></pre></td></tr></table></figure><p>我们直接运行目录里的index.html即可</p><h2 id="效果展示"><a href="#效果展示" class="headerlink" title="效果展示"></a>效果展示</h2><p>下面是部分展示，是不是看起来还不错！</p><img alt="1.png" src="https://oss-emcsprod-public.modb.pro/image/editor/20241205-1864686776904855552_3605.png" referrerpolicy="no-referrer"/><p>​</p><img alt="1.png" src="https://oss-emcsprod-public.modb.pro/image/editor/20241205-1864686776904855552_3605.png" referrerpolicy="no-referrer"/><img alt="1.png" src="https://oss-emcsprod-public.modb.pro/image/editor/20241205-1864686850313568256_3605.png" referrerpolicy="no-referrer"/><img alt="1.png" src="https://oss-emcsprod-public.modb.pro/image/editor/20241205-1864686885101125632_3605.png" referrerpolicy="no-referrer"/><p>欢迎联系我一起讨论。我的微信号：Eric_xu_2023</p><p>也欢迎关注我的公众号：</p><img alt="1.png" src="https://oss-emcsprod-public.modb.pro/image/editor/20251010-1976625582993584128_3605.png" referrerpolicy="no-referrer"/>]]></content>
      
      
      <categories>
          
          <category> linux os </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oracle </tag>
            
            <tag> linux </tag>
            
            <tag> monitor </tag>
            
            <tag> oswatcher </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在Centos7.9上安装netbackup 9.1服务器端</title>
      <link href="/post/2b862cbb.html"/>
      <url>/post/2b862cbb.html</url>
      
        <content type="html"><![CDATA[<h2 id="安装环境"><a href="#安装环境" class="headerlink" title="安装环境"></a>安装环境</h2><p>Centos 7.6 x86_64</p><p>netbackup 9.1 服务端</p><h2 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">groupadd nbwebgrp</span><br><span class="line">mkdir -p /usr/openv/wmc</span><br><span class="line">useradd -g nbwebgrp -c &#x27;NetBackup Web Services account&#x27; -d /usr/openv/wmc nbwebsvc</span><br><span class="line">useradd -c &#x27;NetBackup Services account&#x27; -d /usr/openv/ nbusvc</span><br><span class="line">usermod -a -G nbwebgrp nbusvc</span><br></pre></td></tr></table></figure><h2 id="配置系统参数"><a href="#配置系统参数" class="headerlink" title="配置系统参数"></a>配置系统参数</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;kernel.sem = 300 307200 32 1024&quot; &gt;&gt; /etc/sysctl.conf </span><br><span class="line">sysctl -p</span><br><span class="line">echo &quot;*    soft    nofile         8192&quot; &gt;&gt; /etc/security/limits.conf</span><br><span class="line">echo &quot;*    hard    nofile        65536&quot; &gt;&gt; /etc/security/limits.conf</span><br><span class="line">echo &quot;*    soft    nproc         65536&quot; &gt;&gt; /etc/security/limits.conf</span><br><span class="line">echo &quot;*    hard    nproc         65536&quot; &gt;&gt; /etc/security/limits.conf</span><br><span class="line">echo &quot;*    soft    fsize     unlimited&quot; &gt;&gt; /etc/security/limits.conf</span><br><span class="line">echo &quot;*    hard    fsize     unlimited&quot; &gt;&gt; /etc/security/limits.conf</span><br></pre></td></tr></table></figure><h2 id="修改主名"><a href="#修改主名" class="headerlink" title="修改主名"></a>修改主名</h2><p>配置主机名</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname nbuserver</span><br><span class="line">echo &quot;192.168.31.160 nbuserver&quot; &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><h2 id="关闭SELINUX"><a href="#关闭SELINUX" class="headerlink" title="关闭SELINUX"></a>关闭SELINUX</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed -i &#x27;s/enforcing/disabled/g&#x27; /etc/selinux/config</span><br><span class="line">setenforce 0</span><br></pre></td></tr></table></figure><h2 id="修改系统环境变量"><a href="#修改系统环境变量" class="headerlink" title="修改系统环境变量"></a>修改系统环境变量</h2><p>vi &#x2F;etc&#x2F;profile<br>添加如下行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PATH=$PATH:$HOME/bin:/usr/openv/netbackup/bin/admincmd:/usr/openv/netbackup/bin:/usr/openv/netbackup/bin/goodies:/usr/openv/volmgr/bin</span><br><span class="line">export PATH</span><br></pre></td></tr></table></figure><h2 id="安装备必软件包"><a href="#安装备必软件包" class="headerlink" title="安装备必软件包"></a>安装备必软件包</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">如何配置YUM源我就不写了，大家应该都会</span><br><span class="line">yum install net-tools unzip gzip bzip* libnsl.so* insserv-compat* libXtst compat* -y</span><br></pre></td></tr></table></figure><h2 id="安装master-server-media-server"><a href="#安装master-server-media-server" class="headerlink" title="安装master-server&amp;&amp; media server"></a>安装master-server&amp;&amp; media server</h2><p>veritas_customer_registration_key.json需要提前准备，购买了许可之后可以通过控制台下载（从netbackup 8.0变回veritas商标之后，安装都需要许可。还是symantec时代的版本安装时不需要许可，）</p><p>1.查看准备的软包</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@netbackup ~]# ls</span><br><span class="line">anaconda-ks.cfg  License.txt   NetBackup_9.1.0.1_LinuxR_x86_64.tar.gz  veritas_customer_registration_key.json</span><br></pre></td></tr></table></figure><p>使用tar解压软件包</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf NetBackup_9.1.0.1_LinuxR_x86_64.tar.gz</span><br></pre></td></tr></table></figure><p>进到安装目录里查看</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@netbackup ~]# cd NetBackup_9.1.0.1_LinuxR_x86_64</span><br><span class="line">[root@netbackup NetBackup_9.1.0.1_LinuxR_x86_64]# ls</span><br><span class="line">Doc  install  LICENSE  linuxR_x86  NBInstallAnswer-client.template  NBInstallAnswer-master.template  NBInstallAnswer-media.template</span><br></pre></td></tr></table></figure><p>开始安装，这里由于输出太长，我只列出关键位置，大家安装的时候可以参考。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line">[root@netbackup NetBackup_9.1.0.1_LinuxR_x86_64]# ./install </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Veritas Installation Script</span><br><span class="line">Copyright (c) 2021 Veritas Technologies LLC. All rights reserved.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Installing NetBackup Server Software</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Please review the VERITAS SOFTWARE LICENSE AGREEMENT located on</span><br><span class="line">………………</span><br><span class="line">中间太长，少略一下。</span><br><span class="line">………………</span><br><span class="line"></span><br><span class="line">ATTENTION!  To help ensure a successful upgrade to NetBackup 9.1.0.1,</span><br><span class="line">please visit the NetBackup 9.x Upgrade Portal:</span><br><span class="line">https://www.veritas.com/content/support/en_US/article.100048493.</span><br><span class="line"></span><br><span class="line">Do you wish to continue? [y,n] (y)      ---------输入Y继续</span><br><span class="line">Starting NetBackup Deduplication installer</span><br><span class="line">testing: /tmp/pdde_pkg_dir_16149</span><br><span class="line">NetBackup Deduplication preinstall check passed</span><br><span class="line">Running install analysis tool.</span><br><span class="line"></span><br><span class="line">Is this host the master server? [y,n] (y)   ---------输入Y继续</span><br><span class="line">Are you currently performing a disaster recovery of a master server? [y,n] (n)   ---------输入N，这里是全新安装，不是恢复安装</span><br><span class="line"></span><br><span class="line">Using nbwebsvc and nbwebgrp for the</span><br><span class="line">NetBackup web service user and group.</span><br><span class="line"></span><br><span class="line">ATTENTION! Provide the name of the service user account to be used to start</span><br><span class="line">most of the daemons.</span><br><span class="line"></span><br><span class="line">- It is not recommended to use the root user as the service user.</span><br><span class="line">- The length of the service user name must be less than 32 characters.</span><br><span class="line">- The service user name must contain only English characters.</span><br><span class="line">- The nbwebsvc user should not be used as the service user.</span><br><span class="line">- nbwebgrp must be a secondary group of the service user.</span><br><span class="line">  For more details, see the article: https://www.veritas.com/docs/100048220.</span><br><span class="line"></span><br><span class="line">Enter the name of the service user account to be used to start most of the daemons: nbusvc</span><br><span class="line"></span><br><span class="line">The private_tmp value is /tmp/nbcheck_dir.16107</span><br><span class="line"></span><br><span class="line">Checking for critical system conditions...</span><br><span class="line"></span><br><span class="line">………………</span><br><span class="line">中间太长，少略一下。</span><br><span class="line">………………</span><br><span class="line">A customer registration key is required to proceed with the installation of this</span><br><span class="line">master server.</span><br><span class="line">Log into Veritas NetInsights Console (https://netinsights.veritas.com) and go </span><br><span class="line">to the &quot;Registration Keys&quot; page and download the appropriate customer registration</span><br><span class="line">key for this master server.  If you need help with customer registration keys to </span><br><span class="line">proceed with the installation or upgrade of this master server, please refer to the </span><br><span class="line">NetBackup Release Notes or contact Veritas Support.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Please enter the fully qualified path containing your customer registration key </span><br><span class="line">file, or enter q to quit the install script.   -------这里会提示让你输入密钥文件的位置</span><br><span class="line">/root/veritas_customer_registration_key.json</span><br><span class="line"></span><br><span class="line">The NetBackup and Media Manager software is built for use on LINUX_RH_X86 hardware.</span><br><span class="line">Do you want to install NetBackup and Media Manager files? [y,n] (y)    --------回复Y继续</span><br><span class="line"></span><br><span class="line">NetBackup and Media Manager are normally installed in /usr/openv.</span><br><span class="line">The existing /usr/openv directory will be used for NetBackup and Media Manager.</span><br><span class="line">No existing NetBackup server files to save.</span><br><span class="line">Client folder [/usr/openv/netbackup/client] does not exist.  No work to do.</span><br><span class="line"></span><br><span class="line">Reading NetBackup files from /root/NetBackup_9.1.0.1_LinuxR_x86_64/linuxR_x86/anb</span><br><span class="line"></span><br><span class="line">Checking for pre-existing SYMCnetbp package.</span><br><span class="line">package SYMCnetbp is not installed</span><br><span class="line">Successfully copied VRTSpddes.rpm into staging area.</span><br><span class="line">Successfully copied VRTSpddei.rpm into staging area.</span><br><span class="line"></span><br><span class="line">x openv/netbackup/client/Linux/</span><br><span class="line">x openv/netbackup/client/Linux/SuSE4.4.73/</span><br><span class="line">x openv/netbackup/client/Linux/SuSE4.4.73/VRTSpddea.rpm</span><br><span class="line">………………</span><br><span class="line">中间太长，少略一下。</span><br><span class="line">………………</span><br><span class="line">A NetBackup Server or Enterprise Server license key is needed</span><br><span class="line">for installation to continue.</span><br><span class="line"></span><br><span class="line">Enter license key: XXXX-XXXX-XXXX-XXXX-XXX-XXXX           -----------这里让你输入密钥，我就脱敏一下</span><br><span class="line"></span><br><span class="line">XXXX-XXXX-XXXX-XXXX-XXX-XXXX :  </span><br><span class="line">NetBackup Enterprise Server Base product with all the features enabled</span><br><span class="line">has been registered.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">All additional keys should be added at this time.</span><br><span class="line">Do you want to add additional license keys now? [y,n] (y) n     ----------问是否还有其它密钥需要继续输入，没有回复N</span><br><span class="line"></span><br><span class="line">Use /usr/openv/netbackup/bin/admincmd/get_license_key</span><br><span class="line">to add, delete or list license keys at a later time.</span><br><span class="line"></span><br><span class="line">Installing NetBackup Enterprise Server version: 9.1.0.1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">If this machine will be using a different network interface than the</span><br><span class="line">default (netbackup), the name of the preferred interface should be used</span><br><span class="line">as the configured server name.  If this machine will be part of a</span><br><span class="line">cluster, the virtual name should be used as the configured server name.</span><br><span class="line"></span><br><span class="line">Would you like to use &quot;netbackup&quot; as the configured</span><br><span class="line">NetBackup server name of this machine? [y,n] (y)         -----------回复Y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Media servers can be added during this installation or</span><br><span class="line">to a NetBackup environment after installation completes.</span><br><span class="line">Refer to the NetBackup Administrator&#x27;s Guide, Volume I for</span><br><span class="line">more information.</span><br><span class="line"></span><br><span class="line">Do you want to add any media servers now? [y,n] (n)    -----------问是你是否要加其它的media servers这里N就行</span><br><span class="line"></span><br><span class="line">………………</span><br><span class="line">中间太长，少略一下。</span><br><span class="line">………………</span><br><span class="line"></span><br><span class="line">Do you want to start the job-related NetBackup daemons</span><br><span class="line">so backups and restores can be initiated? [y,n] (y)     ------------回复Y，开始启动服务</span><br><span class="line">Starting the NetBackup request daemon process (bprd).</span><br><span class="line">………………</span><br><span class="line">中间太长，少略一下。</span><br><span class="line">………………</span><br><span class="line">Starting the NetBackup Bare Metal Restore Boot Server daemon.</span><br><span class="line"></span><br><span class="line">Checking the current NetBackup KMS configuration.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">OpsCenter is the monitoring, reporting and administrative</span><br><span class="line">solution designed to centrally manage one or more NetBackup</span><br><span class="line">installations from a web browser.</span><br><span class="line"></span><br><span class="line">If an OpsCenter server already exists in your environment</span><br><span class="line">or you plan to install one, enter the real hostname of that</span><br><span class="line">OpsCenter server here.  Do not use a virtual name.  If you</span><br><span class="line">do not want this local machine to be an OpsCenter server,</span><br><span class="line">enter NONE.</span><br><span class="line"></span><br><span class="line">Enter the OpsCenter server (default: NONE):         -----这里没有OPSCENTER就回车就行（是veritas的一套管理平台）</span><br><span class="line">WARNING: Catalog backups fail if the disaster recovery passphrase is not set.</span><br><span class="line">NetBackup server installation complete.</span><br><span class="line">Running install analysis tool.</span><br><span class="line">File /usr/openv/tmp/install_trace.16107 contains a trace of this install.</span><br></pre></td></tr></table></figure><h2 id="解决安装后WEB控制台无法打开"><a href="#解决安装后WEB控制台无法打开" class="headerlink" title="解决安装后WEB控制台无法打开"></a>解决安装后WEB控制台无法打开</h2><p>netbackup提供了WEB控制台，也可以用来配置备份（当然也是JAVA控制台可以使用）</p><p>创建如下文件，并赋予权限</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">touch /usr/openv/var/global/wsl/config/allowedlist.properties</span><br><span class="line">chmod a+r /usr/openv/var/global/wsl/config/allowedlist.properties</span><br><span class="line">chown nbwebsvc:nbwebgrp /usr/openv/var/global/wsl/config/allowedlist.properties</span><br></pre></td></tr></table></figure><p>编辑 allowedlist.properties文件，输入如下内容</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@nbmaster2 config]# cat allowedlist.properties</span><br><span class="line">#Properties file to allow additional valid HOST and X-FORWARDED-HOST header values</span><br><span class="line">#Tue Jan 25 2022</span><br><span class="line">host.headers=192.168.31.160</span><br><span class="line">x.forwarded.host.headers=192.168.31.160</span><br></pre></td></tr></table></figure><p>如果netbackup安装在windows平台，需要重启Web Management Console service </p><p>我这里是LINUX平台，需要按如下方法重启服务</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/openv/netbackup/bin/nbwmc stop &amp;&amp; /usr/openv/netbackup/bin/nbwmc start.</span><br></pre></td></tr></table></figure><h2 id="给备份存储目录赋予权限"><a href="#给备份存储目录赋予权限" class="headerlink" title="给备份存储目录赋予权限"></a>给备份存储目录赋予权限</h2><p>我这里以&#x2F;mnt&#x2F;remotedr为例，如不赋予权限，备份的时候会提示目录没有写入权限</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chown -R nbsvcusr /mnt/remotedr</span><br><span class="line">chmod -R 755 /mnt/remotedr</span><br></pre></td></tr></table></figure><h2 id="客户端JAVA-CONSOLE不是中文"><a href="#客户端JAVA-CONSOLE不是中文" class="headerlink" title="客户端JAVA CONSOLE不是中文"></a>客户端JAVA CONSOLE不是中文</h2><p>可以在windows平台安装netbackup管理控制台，但是默认是英文的，这时候可以去官网下载语言包，或者去服务端的安装包里找到语言包文件<br>拷贝ZH、i18n_zh.properties、dbexti18n_zh.properties至客户端如下目录<br>C:\Program Files\Veritas\Java\vrts\nbvsm_l10n</p><p>之后再打开客户端就是中文了</p><h2 id="linux服务器端如何打开控制台"><a href="#linux服务器端如何打开控制台" class="headerlink" title="linux服务器端如何打开控制台"></a>linux服务器端如何打开控制台</h2><p>&#x2F;usr&#x2F;open&#x2F;netbackup&#x2F;bin&#x2F;jnbSA启动控制台</p><p>就先写到这里，后面的有空再写………………</p><p>欢迎联系我一起讨论。我的微信号：Eric_xu_2023</p><p>也欢迎关注我的公众号：</p><img alt="1.png" src="https://oss-emcsprod-public.modb.pro/image/editor/20251010-1976625582993584128_3605.png" referrerpolicy="no-referrer"/>]]></content>
      
      
      <categories>
          
          <category> backup_nbu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> netbackup </tag>
            
            <tag> veritas </tag>
            
            <tag> centos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OracleLinux快速配置多路径multipath</title>
      <link href="/post/b6540e26.html"/>
      <url>/post/b6540e26.html</url>
      
        <content type="html"><![CDATA[<h2 id="多路径multipath作用"><a href="#多路径multipath作用" class="headerlink" title="多路径multipath作用"></a>多路径multipath作用</h2><p>使用设备映射器多路径（DM Multipath），您可以将服务器节点和存储阵列间的多个 I&#x2F;O 路径配置为单一设备。这些 I&#x2F;O 路径是可包含独立电缆、交换机和控制器的物理 SAN 连接。多路径聚合了 I&#x2F;O 路径并生成由聚合路径组成的新设备。</p><p>比如按下图所示：</p><img alt="2.png" src="https://i-blog.csdnimg.cn/img_convert/958b28f9b7c953df748bf3861d5bf786.png" referrerpolicy="no-referrer"/><p>server主机通过2个hba卡分别接到2台SAN交换机，2台SAN交换机又分别接了存储的控制器1和2.</p><p>此时从存储1映射给主机的1个LUN就会识别到多个路径，变成4块磁盘。为了达到高可用冗余的效果，就需要把多个磁盘聚合成一个设备来使用，这样任何一条路径发生故障，都不会影响业务运行。</p><p>多路径软件分为Linux操作系统自带的multipath和存储厂商提供的专用多路径软件。</p><p>常见的比如华为的UltraPath、EMC的power path、ibm存储的SDDPCM（AIX下特有）、Veritas的StorageFoundation</p><p>用存储厂商的好处就是能针对自家的存储做负载链路优化，可以自动屏蔽质量有问题的链路（这点multipathd不具备，经常会出现一条链路有问题，导致存储卡顿的情况）</p><p>当然也是有缺点的，就是一台主机只能安装一个厂商的多路径软件，这样的话，你一台服务器要是连多个厂家的存储就会出现问题。</p><p>此时multipath的高兼容性就体现出来了，用它可以配置同时连接多个厂家的存储。</p><p><strong>我次就遇到了坑，华为的存储多路径软件最新居然只支持到oracle linux 7.6不支持7.9，真是让人大跌眼镜！oracle linux7.9都出了多少年了，居然没有人适配（估计改一下install.sh安装脚本里的版本校验就能安上。。。研发懒得改了），我一定要给他们提需求🤣。</strong></p><p>我下面的示例就是用华为的OceanStor Dorado 2000连接Oracle linux7.9为例（这里的device配置和以前的V2&#x2F;V3&#x2F;V5完全不一样，因为dorado存储又做了改动）</p><h2 id="安装multipath"><a href="#安装multipath" class="headerlink" title="安装multipath"></a>安装multipath</h2><p>首先先要检查、安装multipath</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--检查是否安装了该软件包</span><br><span class="line">rpm -q device-mapper-multipath</span><br></pre></td></tr></table></figure><p>配置YUM安装</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">--增加本地YUM配置文件</span><br><span class="line">cat &gt;/etc/yum.repos.d/local.repo&lt;&lt;EOF</span><br><span class="line">[local]</span><br><span class="line">name=local</span><br><span class="line">baseurl=file:///media/os</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">EOF</span><br><span class="line">--手动执行挂载系统ISO文件</span><br><span class="line">mount /mnt/*.iso /medis/os</span><br><span class="line">yum cleanmetadata</span><br><span class="line">yum makecache</span><br><span class="line">--执行安装</span><br><span class="line">yum install device-mapper-multipath</span><br></pre></td></tr></table></figure><h2 id="配置multipathd服务"><a href="#配置multipathd服务" class="headerlink" title="配置multipathd服务"></a>配置multipathd服务</h2><p>安装之后，需要启用multipath，执行如下命令初始化多路径配置文件。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mpathconf --enable</span><br></pre></td></tr></table></figure><p>此时会生成默认的&#x2F;etc&#x2F;multipath.conf文件，配置multipath开机启动</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable multipathd.service</span><br></pre></td></tr></table></figure><p>需要注意的是一定要配置多路径忽略本地磁盘，因为系统盘很有可能在下次重启的时候不是sda了，可以参考之前我写的文章《<a href="https://mp.weixin.qq.com/s?__biz=MzU0NTU1MzI5MQ==&mid=2247484657&idx=1&sn=f7ca8c3158e62258644d3203c117370c&scene=21#wechat_redirect">Linux解决multipath多路径磁盘盘符与系统盘盘符重叠问题</a>》。这里我再说一下基本操作，需要先获取系统盘的WWID</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">====LINUX 5.0====</span><br><span class="line">/sbin/scsi_id -g -u -s  /dev/sda</span><br><span class="line">====Linux 6.0====</span><br><span class="line">/sbin/scsi_id -g -u -d  /dev/sda </span><br><span class="line">====Linux 7.0/8.0/9.0====</span><br><span class="line">/usr/lib/udev/scsi_id -g -u -d  /dev/sda</span><br></pre></td></tr></table></figure><p>然后下一步就是要编辑多路径配置文件了，这里先把原来的配置备份，再按我配置好的模板新建一下。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">--备份配置</span><br><span class="line">mv /etc/multipath.conf /etc/multipath.conf.bak</span><br><span class="line">--创建新的配置文件</span><br><span class="line">touch /etc/multipath.conf</span><br><span class="line">粘贴内容如下</span><br><span class="line"></span><br><span class="line">defaults &#123;</span><br><span class="line"> user_friendly_names yes</span><br><span class="line">  &#125;</span><br><span class="line">blacklist &#123;</span><br><span class="line"> wwid &lt;这里写刚才获取的SDA磁盘WWID&gt;</span><br><span class="line">  &#125;</span><br><span class="line">multipaths &#123;</span><br><span class="line"> multipath &#123;</span><br><span class="line">   wwid  3624974510092e319011e66c200000000</span><br><span class="line">   alias crs01</span><br><span class="line">   &#125; </span><br><span class="line">  &#125;</span><br><span class="line">devices &#123;</span><br><span class="line">      device &#123;</span><br><span class="line">               vendor                  &quot;HUAWEI&quot;</span><br><span class="line">               product                 &quot;XSG1&quot;</span><br><span class="line">               path_grouping_policy    multibus</span><br><span class="line">               path_checker            tur</span><br><span class="line">               prio                    const</span><br><span class="line">               path_selector           &quot;round-robin 0&quot;</span><br><span class="line">               failback                immediate</span><br><span class="line">               dev_loss_tmo            30</span><br><span class="line">               fast_io_fail_tmo        5</span><br><span class="line">               no_path_retry           6</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>简单说一下multipath.conf的配置文件分为几个部分</p><ul><li><p>blacklist</p><p>不视为多路径的特定设备列表。</p></li><li><p>defaults</p><p>DM 多路径的常规默认设置。</p></li><li><p>devices</p><p>各个存储控制器的设置。这些值覆盖了在 配置文件的 <code>defaults</code> 部分中指定的内容。如果您使用默认不支持的存储阵列，您可能需要为阵列创建 <code>devices</code> 子部分。</p></li><li><p>multipaths</p><p>各个多路径设备特性的设置。这些值会覆盖在配置文件中的 <code>overrides</code>, <code>devices</code>, 和 <code>defaults</code> 部分指定的值。</p></li></ul><p>具体各个部分的参数我就不详细说了，大家直接看红帽官方文档就行，我就不在这里水篇幅了。我只说我这个配置模板里的重要参数：</p><p>1、defaults里标注使用user_friendly_names，否则的话生成的设备文件就是WWID看起来不是很友好，这里对应下面multipahs里的alias标出设备别名</p><p>2、blacklist的WWID代表本地磁盘或都你想要屏蔽掉的磁盘WWID</p><p>3、multipaths里每个multipath{}代表一个生成的存储设备，按实际情况填写，具体磁盘的WWID可以用multipath -ll找到或者用scsi_id命令获取，这个建议是存储侧LUN的名称和要生成的多路径设备的名称对应，这样既避免用错盘，也方便日后排错。磁盘的WWID也可以在存储的管理界面匹配上LUN的WWID</p><p>4、devices里的每个device{}代表一个存储型号。这块可以直接找存储厂家要，不要自己瞎配置，会影响使用效果（比如多路径磁盘用来做oracle asm磁盘，你要不用厂商的配置自己瞎写可能就识别有问题）</p><p>最后配置完毕最后重新load multipathd服务配置文件即可，执行systemctl reloal multipathd。最后就是去&#x2F;dev&#x2F;mapper下直接使用生成的别名设备就行了。</p><h2 id="关于更多配置"><a href="#关于更多配置" class="headerlink" title="关于更多配置"></a>关于更多配置</h2><p>关于多路径常用的命令也是建议直接看红帽的官方文档就行，有中文</p><p>具体参考:</p><p><a href="https://docs.redhat.com/zh-cn/documentation/red_hat_enterprise_linux/9/html-single/configuring_device_mapper_multipath/index#ignoring-local-disks-when-generating-multipath-devices_configuring-dm-multipath">https://docs.redhat.com/zh-cn/documentation/red_hat_enterprise_linux/9/html-single/configuring_device_mapper_multipath/index#ignoring-local-disks-when-generating-multipath-devices_configuring-dm-multipath</a></p><p>欢迎联系我一起讨论。我的微信号：Eric_xu_2023</p><p>也欢迎关注我的公众号：</p><img alt="1.png" src="https://oss-emcsprod-public.modb.pro/image/editor/20251010-1976625582993584128_3605.png" referrerpolicy="no-referrer"/>]]></content>
      
      
      <categories>
          
          <category> 操作系统_linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oracle </tag>
            
            <tag> linux </tag>
            
            <tag> multipath </tag>
            
            <tag> huawei </tag>
            
            <tag> Dorado2000 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OEL7挂载ISCSI存储配置示例</title>
      <link href="/post/d477c414.html"/>
      <url>/post/d477c414.html</url>
      
        <content type="html"><![CDATA[<p>客户让帮忙挂载个ISCSI存储，大概结构如下图所示：</p><img alt="1.png" src="https://i-blog.csdnimg.cn/img_convert/887a5b3d496dbdef664ab1a3373e9048.png" referrerpolicy="no-referrer"/><p>ISCSI存储为一台安装了truenas的X86服务器，提供存储服务的IP地址为10.16.0.1</p><p>服务器的ETH1网卡配置与10.16.0.1同段网络。</p><p>为了给客户做个简单培训，整理了一下操作步骤。下面是配置示例：</p><h2 id="清空ISCSI存储连接"><a href="#清空ISCSI存储连接" class="headerlink" title="清空ISCSI存储连接"></a>清空ISCSI存储连接</h2><p>为防止有其它配置影响，先断开所有登录会话</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# iscsiadm -m node -U all</span><br><span class="line">Logging out of session [sid: 1, target: iqn.2024.12.org.trusnas.ctl:server1, portal: 10.16.0.1,3260]</span><br><span class="line">Logout of [sid: 1, target: iqn.2024.12.org.trusnas.ctl:server1, portal: 10.16.0.1,3260] successful.</span><br><span class="line">[root@localhost ~]# lsblk</span><br><span class="line">NAME            MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda               8:0    0 278.5G  0 disk </span><br><span class="line">├─sda1            8:1    0     1G  0 part /boot</span><br><span class="line">└─sda2            8:2    0 277.5G  0 part </span><br><span class="line">  ├─centos-root 253:0    0    50G  0 lvm  /</span><br><span class="line">  ├─centos-swap 253:1    0     4G  0 lvm  [SWAP]</span><br><span class="line">  └─centos-home 253:2    0 223.5G  0 lvm  /home</span><br><span class="line">sr0              11:0    1  1024M  0 rom  </span><br></pre></td></tr></table></figure><h2 id="登录ISCSI存储会话"><a href="#登录ISCSI存储会话" class="headerlink" title="登录ISCSI存储会话"></a>登录ISCSI存储会话</h2><p>执行命令登陆ISCSI存储，并配置开机自动启动ISCSI和登陆存储</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# iscsiadm -m discovery -t st -p 10.16.0.1</span><br><span class="line">10.16.0.1:3260,1 iqn.2024.12.org.trusnas.ctl:server1</span><br><span class="line">[root@localhost ~]# iscsiadm -m node -p 10.16.0.1 -l</span><br><span class="line">Logging in to [iface: default, target: iqn.2024.12.org.trusnas.ctl:server1, portal: 10.16.0.1,3260] (multiple)</span><br><span class="line">Login to [iface: default, target: iqn.2024.12.org.trusnas.ctl:server1, portal: 10.16.0.1,3260] successful.</span><br><span class="line">[root@localhost ~]# systemctl enable iscsi.service</span><br><span class="line">[root@localhost ~]# iscsiadm -m node -o update -n node.startup -v automatic</span><br><span class="line">[root@localhost ~]# lsblk</span><br><span class="line">NAME            MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda               8:0    0 278.5G  0 disk </span><br><span class="line">├─sda1            8:1    0     1G  0 part /boot</span><br><span class="line">└─sda2            8:2    0 277.5G  0 part </span><br><span class="line">  ├─centos-root 253:0    0    50G  0 lvm  /</span><br><span class="line">  ├─centos-swap 253:1    0     4G  0 lvm  [SWAP]</span><br><span class="line">  └─centos-home 253:2    0 223.5G  0 lvm  /home</span><br><span class="line">sdc               8:32   0     3T  0 disk </span><br><span class="line">└─sdc1            8:33   0     3T  0 part </span><br><span class="line">sr0              11:0    1  1024M  0 rom  </span><br></pre></td></tr></table></figure><p>登陆成功后，lsblk命令可以查看到发现新磁盘空间sdc</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# lsblk</span><br><span class="line">NAME            MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda               8:0    0 278.5G  0 disk </span><br><span class="line">├─sda1            8:1    0     1G  0 part /boot</span><br><span class="line">└─sda2            8:2    0 277.5G  0 part </span><br><span class="line">  ├─centos-root 253:0    0    50G  0 lvm  /</span><br><span class="line">  ├─centos-swap 253:1    0     4G  0 lvm  [SWAP]</span><br><span class="line">  └─centos-home 253:2    0 223.5G  0 lvm  /home</span><br><span class="line">sdc               8:32   0     3T  0 disk </span><br><span class="line">sr0              11:0    1  1024M  0 rom  </span><br></pre></td></tr></table></figure><h2 id="配置格式化磁盘"><a href="#配置格式化磁盘" class="headerlink" title="配置格式化磁盘"></a>配置格式化磁盘</h2><p>不确定磁盘是否用过的话，为了清空数据，可以dd接磁盘头</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# dd if=/dev/zero of=/dev/sdc bs=1024k count=100</span><br><span class="line">记录了100+0 的读入</span><br><span class="line">记录了100+0 的写出</span><br></pre></td></tr></table></figure><p>这里我们不适用LVM，直接用parted分区，可以参照如下公式对齐分区 (默认创建可以会报警<strong>The resulting partition is not properly aligned for best performance</strong>) </p><p>计算公式如下： </p><p>parted分区起点&#x3D;(optimal_io_size + alignment_offset) &#x2F; physical_block_size &#x3D;  (8388608 + 0) &#x2F; 16384 &#x3D; 512</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat /sys/block/sdc/queue/optimal_io_size              </span><br><span class="line">8388608</span><br><span class="line">[root@localhost ~]# cat /sys/block/sdc/queue/minimum_io_size </span><br><span class="line">16384</span><br><span class="line">[root@localhost ~]# cat /sys/block/sdc/alignment_offset </span><br><span class="line">0</span><br><span class="line">[root@localhost ~]# cat /sys/block/sdc/queue/physical_block_size </span><br><span class="line">16384</span><br><span class="line">[root@localhost ~]# parted /dev/sdc</span><br><span class="line">GNU Parted 3.1</span><br><span class="line">使用 /dev/sdc</span><br><span class="line">Welcome to GNU Parted! Type &#x27;help&#x27; to view a list of commands.</span><br><span class="line">(parted) mklabel gpt                        </span><br><span class="line">(parted) mkpart primary 512 100%</span><br><span class="line">(parted) print                                                            </span><br><span class="line">Model: TrueNAS iSCSI Disk (scsi)</span><br><span class="line">Disk /dev/sdc: 3299GB</span><br><span class="line">Sector size (logical/physical): 512B/16384B</span><br><span class="line">Partition Table: gpt</span><br><span class="line">Disk Flags: </span><br><span class="line"></span><br><span class="line">Number  Start  End     Size    File system  Name     标志</span><br><span class="line"> 1      512MB  3299GB  3298GB               primary</span><br><span class="line">(parted) quit                                                             </span><br><span class="line">信息: You may need to update /etc/fstab.</span><br></pre></td></tr></table></figure><p>格式化文件系统</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# lsblk</span><br><span class="line">NAME            MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda               8:0    0 278.5G  0 disk </span><br><span class="line">├─sda1            8:1    0     1G  0 part /boot</span><br><span class="line">└─sda2            8:2    0 277.5G  0 part </span><br><span class="line">  ├─centos-root 253:0    0    50G  0 lvm  /</span><br><span class="line">  ├─centos-swap 253:1    0     4G  0 lvm  [SWAP]</span><br><span class="line">  └─centos-home 253:2    0 223.5G  0 lvm  /home</span><br><span class="line">sdc               8:32   0     3T  0 disk </span><br><span class="line">└─sdc1            8:33   0     3T  0 part </span><br><span class="line">sr0              11:0    1  1024M  0 rom  </span><br><span class="line">[root@localhost ~]# mkfs.xfs /dev/sdc1 </span><br><span class="line">specified blocksize 4096 is less than device physical sector size 16384</span><br><span class="line">switching to logical sector size 512</span><br><span class="line">meta-data=/dev/sdc1              isize=512    agcount=4, agsize=201294848 blks</span><br><span class="line">         =                       sectsz=512   attr=2, projid32bit=1</span><br><span class="line">         =                       crc=1        finobt=0, sparse=0</span><br><span class="line">data     =                       bsize=4096   blocks=805179392, imaxpct=5</span><br><span class="line">         =                       sunit=0      swidth=0 blks</span><br><span class="line">naming   =version 2              bsize=4096   ascii-ci=0 ftype=1</span><br><span class="line">log      =internal log           bsize=4096   blocks=393154, version=2</span><br><span class="line">         =                       sectsz=512   sunit=0 blks, lazy-count=1</span><br><span class="line">realtime =none                   extsz=4096   blocks=0, rtextents=0</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# blkid |grep sdc1</span><br><span class="line">/dev/sdc1: UUID=&quot;40668fd3-ce0a-4f84-9619-084190ff23ca&quot; TYPE=&quot;xfs&quot; PARTLABEL=&quot;primary&quot; PARTUUID=&quot;9be008d4-9e4a-4569-9bec-33e17a9432d9&quot; </span><br></pre></td></tr></table></figure><p>创建挂载点并挂载文件系统</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mkdir /data</span><br><span class="line">[root@localhost ~]# vi /etc/fstab </span><br><span class="line">[root@localhost ~]# cat /etc/fstab </span><br><span class="line"># /etc/fstab</span><br><span class="line"># Created by anaconda on Wed Mar 19 13:54:48 2025</span><br><span class="line">#</span><br><span class="line"># Accessible filesystems, by reference, are maintained under &#x27;/dev/disk&#x27;</span><br><span class="line"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span><br><span class="line">#</span><br><span class="line">/dev/mapper/centos-root /                       xfs     defaults        0 0</span><br><span class="line">UUID=3b897744-11d6-4253-870c-03e1819b09f6 /boot                   xfs     defaults        0 0</span><br><span class="line">/dev/mapper/centos-home /home                   xfs     defaults        0 0</span><br><span class="line">/dev/mapper/centos-swap swap                    swap    defaults        0 0</span><br><span class="line">UUID=&quot;40668fd3-ce0a-4f84-9619-084190ff23ca&quot; /data xfs defaults,_netdev 0 0</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# mount -a</span><br><span class="line">[root@localhost ~]# df -h</span><br><span class="line">文件系统                 容量  已用  可用 已用% 挂载点</span><br><span class="line">/dev/mapper/centos-root   50G  4.3G   46G    9% /</span><br><span class="line">devtmpfs                  63G     0   63G    0% /dev</span><br><span class="line">tmpfs                     63G     0   63G    0% /dev/shm</span><br><span class="line">tmpfs                     63G   11M   63G    1% /run</span><br><span class="line">tmpfs                     63G     0   63G    0% /sys/fs/cgroup</span><br><span class="line">/dev/sda1               1014M  179M  836M   18% /boot</span><br><span class="line">/dev/mapper/centos-home  224G   39M  224G    1% /home</span><br><span class="line">tmpfs                     13G   12K   13G    1% /run/user/42</span><br><span class="line">tmpfs                     13G     0   13G    0% /run/user/0</span><br><span class="line">/dev/sdc1                3.0T   33M  3.0T    1% /data</span><br></pre></td></tr></table></figure><p>欢迎联系我一起讨论。我的微信号：Eric_xu_2023</p><p>也欢迎关注我的公众号：</p><img alt="1.png" src="https://oss-emcsprod-public.modb.pro/image/editor/20251010-1976625582993584128_3605.png" referrerpolicy="no-referrer"/>]]></content>
      
      
      <categories>
          
          <category> 操作系统_linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oracle </tag>
            
            <tag> linux </tag>
            
            <tag> iscsi </tag>
            
            <tag> parted </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IBM_AIX平台搭建GPFS集群演示</title>
      <link href="/post/d543d14a.html"/>
      <url>/post/d543d14a.html</url>
      
        <content type="html"><![CDATA[<p>早年间的实施记录，重新排版了一下：</p><h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><p>当年是计划做一套10G的rac：</p><p>1、用的主机是两台IBM P740；</p><p>2、硬件存储使用的是V7000；</p><p>3、使用共享存储搭建GPFS集群文件系统给ORACLE做存储。</p><p>当时一共划了4块磁盘hdisk1-hdisk4(hdisk0系统用了，raid5)，做好主机层面多路径后，主机识别磁盘，开始下面的操作。</p><h2 id="搭建过程记录"><a href="#搭建过程记录" class="headerlink" title="搭建过程记录"></a>搭建过程记录</h2><p>创建配置文件目录</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /etc/gpfs</span><br><span class="line">cd /etc/gpfs/</span><br><span class="line">touch nodeslist</span><br></pre></td></tr></table></figure><p>编辑文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bash-3.2# cat nodeslist</span><br><span class="line">p740-gpfs1:manager-quorum</span><br><span class="line">p740-gpfs2:manager-quorum</span><br></pre></td></tr></table></figure><p>PATH里添加gpfs命令目录</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bash-3.2# echo $PATH</span><br><span class="line">/usr/bin:/etc:/usr/sbin:/usr/ucb:/usr/bin/X11:/sbin:/usr/java5/jre/bin:/usr/java5/bin:/usr/lpp/mmfs/bin:/u01/app/oracle/crs/bin</span><br></pre></td></tr></table></figure><p>修改磁盘属性</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chdev -l hdisk1 -a reserve_policy=no_reserve</span><br><span class="line">chdev -l hdisk2 -a reserve_policy=no_reserve</span><br><span class="line">chdev -l hdisk3 -a reserve_policy=no_reserve</span><br><span class="line">chdev -l hdisk4 -a reserve_policy=no_reserve</span><br></pre></td></tr></table></figure><p>命令帮助说明</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">bash-3.2# mmcrcluster -h</span><br><span class="line">Usage:</span><br><span class="line">mmcrcluster -N &#123;NodeDesc[,NodeDesc...] | NodeFile&#125;</span><br><span class="line">[--ccr-enable | &#123;--ccr-disable -p PrimaryServer [-s SecondaryServer]&#125;]</span><br><span class="line">[-r RemoteShellCommand] [-R RemoteFileCopyCommand]</span><br><span class="line">[-C ClusterName] [-U DomainName] [-A]</span><br><span class="line">[-c ConfigFile | --profile ProfileName]</span><br></pre></td></tr></table></figure><p>创建gpfs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mmcrcluster -C jljjgpfs -N /etc/gpfs/nodeslist -p p740-gpfs1 -s p740-gpfs2 -r /usr/bin/ssh -R /usr/bin/scp</span><br><span class="line">mmcrcluster: Performing preliminary node verification ...</span><br><span class="line">mmcrcluster: Processing quorum and other critical nodes ...</span><br><span class="line">mmcrcluster: Finalizing the cluster data structures ...</span><br><span class="line">mmcrcluster: Command successfully completed</span><br><span class="line">mmcrcluster: 6027-1254 Warning: Not all nodes have proper GPFS license designations.</span><br><span class="line">Use the mmchlicense command to designate licenses as needed.</span><br><span class="line">mmcrcluster: 6027-1371 Propagating the cluster configuration data to all</span><br><span class="line">affected nodes.  This is an asynchronous process.</span><br></pre></td></tr></table></figure><p>查看集群状态</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">bash-3.2# mmlscluster</span><br><span class="line">===============================================================================</span><br><span class="line">| Warning:                                                                    |</span><br><span class="line">|   This cluster contains nodes that do not have a proper GPFS license        |</span><br><span class="line">|   designation.  This violates the terms of the GPFS licensing agreement.    |</span><br><span class="line">|   Use the mmchlicense command and assign the appropriate GPFS licenses      |</span><br><span class="line">|   to each of the nodes in the cluster.  For more information about GPFS     |</span><br><span class="line">|   license designation, see the Concepts, Planning, and Installation Guide.  |</span><br><span class="line">===============================================================================</span><br><span class="line">GPFS cluster information</span><br><span class="line">========================</span><br><span class="line">GPFS cluster name:         jljjgpfs.p740-gpfs1</span><br><span class="line">GPFS cluster id:           2512513396710449389</span><br><span class="line">GPFS UID domain:           jljjgpfs.p740-gpfs1</span><br><span class="line">Remote shell command:      /usr/bin/ssh</span><br><span class="line">Remote file copy command:  /usr/bin/scp</span><br><span class="line">Repository type:           CCR</span><br><span class="line">Node  Daemon node name  IP address     Admin node name  Designation</span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">1   p740-gpfs1        200.200.200.2  p740-gpfs1       quorum-manager</span><br><span class="line">2   p740-gpfs2        200.200.200.3  p740-gpfs2       quorum-manager</span><br></pre></td></tr></table></figure><p>查看llic。这里使用DB2 for aix里带的GPFS包，可以不用lic就能用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">bash-3.2# mmchlicense server --accept -N p740-gpfs1,p740-gpfs2</span><br><span class="line">The following nodes will be designated as possessing server licenses:</span><br><span class="line">p740-gpfs1</span><br><span class="line">p740-gpfs2</span><br><span class="line">mmchlicense: Command successfully completed</span><br><span class="line">mmchlicense: 6027-1371 Propagating the cluster configuration data to all</span><br><span class="line">affected nodes.  This is an asynchronous process.</span><br><span class="line">bash-3.2# mmlslicense -L</span><br><span class="line">Node name                      Required license   Designated license</span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">p740-gpfs1                         server              server</span><br><span class="line">p740-gpfs2                         server              server</span><br><span class="line">Summary information</span><br><span class="line">---------------------</span><br><span class="line">Number of nodes defined in the cluster:                          2</span><br><span class="line">Number of nodes with server license designation:                 2</span><br><span class="line">Number of nodes with client license designation:                 0</span><br><span class="line">Number of nodes still requiring server license designation:      0</span><br><span class="line">Number of nodes still requiring client license designation:      0</span><br><span class="line">This node runs IBM Spectrum Scale Standard Edition</span><br></pre></td></tr></table></figure><p>再次查看集群状态</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">bash-3.2# mmlscluster</span><br><span class="line">GPFS cluster information</span><br><span class="line">========================</span><br><span class="line">GPFS cluster name:         jljjgpfs.p740-gpfs1</span><br><span class="line">GPFS cluster id:           2512513396710449389</span><br><span class="line">GPFS UID domain:           jljjgpfs.p740-gpfs1</span><br><span class="line">Remote shell command:      /usr/bin/ssh</span><br><span class="line">Remote file copy command:  /usr/bin/scp</span><br><span class="line">Repository type:           CCR</span><br><span class="line">Node  Daemon node name  IP address     Admin node name  Designation</span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">1   p740-gpfs1        200.200.200.2  p740-gpfs1       quorum-manager</span><br><span class="line">2   p740-gpfs2        200.200.200.3  p740-gpfs2       quorum-manager</span><br></pre></td></tr></table></figure><p>创建临时文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">bash-3.2# touch oradata_disklist</span><br><span class="line">bash-3.2# cat oradata_disklist</span><br><span class="line">hdisk1:::dataAndMetadata:1:oradatansd1</span><br><span class="line">hdisk2:::dataAndMetadata:1:oradatansd2</span><br><span class="line">hdisk3:::dataAndMetadata:1:oradatansd3</span><br><span class="line">hdisk4:::dataAndMetadata:1:oradatansd4</span><br></pre></td></tr></table></figure><p>生成NSD磁盘</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">bash-3.2# mmcrnsd -F /etc/gpfs/oradata_disklist</span><br><span class="line">mmcrnsd: Processing disk hdisk1</span><br><span class="line">mmcrnsd: Processing disk hdisk2</span><br><span class="line">mmcrnsd: Processing disk hdisk3</span><br><span class="line">mmcrnsd: Processing disk hdisk4</span><br><span class="line">mmcrnsd: 6027-1371 Propagating the cluster configuration data to all</span><br><span class="line">affected nodes.  This is an asynchronous process.</span><br></pre></td></tr></table></figure><p>查看NSD磁盘</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">bash-3.2# mmlsnsd</span><br><span class="line">File system   Disk name    NSD servers</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">(free disk)   oradatansd1  (directly attached)</span><br><span class="line">(free disk)   oradatansd2  (directly attached)</span><br><span class="line">(free disk)   oradatansd3  (directly attached)</span><br><span class="line">(free disk)   oradatansd4  (directly attached)</span><br></pre></td></tr></table></figure><p>启动所有并行文件系统集群列表中的服务器的并行文件系统服务</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">bash-3.2# mmstartup -a</span><br><span class="line">Sun Dec 18 13:57:35 CST 2016: 6027-1642 mmstartup: Starting GPFS ...</span><br><span class="line">bash-3.2# mmgetstate -a</span><br><span class="line">Node number  Node name        GPFS state</span><br><span class="line">------------------------------------------</span><br><span class="line">1      p740-gpfs1       arbitrating</span><br><span class="line">2      p740-gpfs2       arbitrating</span><br><span class="line">bash-3.2# mmgetstate -a</span><br><span class="line">Node number  Node name        GPFS state</span><br><span class="line">------------------------------------------</span><br><span class="line">1      p740-gpfs1       active</span><br><span class="line">2      p740-gpfs2       active</span><br></pre></td></tr></table></figure><p>创建文件系统命令帮助查看</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">bash-3.2# mmcrfs -h</span><br><span class="line">Usage:</span><br><span class="line">mmcrfs Device &#123;&quot;DiskDesc[;DiskDesc...]&quot; | -F StanzaFile&#125;</span><br><span class="line">[-A &#123;yes | no | automount&#125;] [-B BlockSize] [-D &#123;posix | nfs4&#125;]</span><br><span class="line">[-E &#123;yes | no&#125;] [-i InodeSize] [-j &#123;cluster | scatter&#125;]</span><br><span class="line">[-k &#123;posix | nfs4 | all&#125;] [-K &#123;no | whenpossible | always&#125;]</span><br><span class="line">[-L LogFileSize] [-m DefaultMetadataReplicas]</span><br><span class="line">[-M MaxMetadataReplicas] [-n NumNodes] [-Q &#123;yes | no&#125;]</span><br><span class="line">[-r DefaultDataReplicas] [-R MaxDataReplicas]</span><br><span class="line">[-S &#123;yes | no | relatime&#125;] [-T Mountpoint] [-t DriveLetter]</span><br><span class="line">[-v &#123;yes | no&#125;] [-z &#123;yes | no&#125;] [--filesetdf | --nofilesetdf]</span><br><span class="line">[--inode-limit MaxNumInodes[:NumInodesToPreallocate]]</span><br><span class="line">[--log-replicas LogReplicas] [--metadata-block-size BlockSize]</span><br><span class="line">[--perfileset-quota | --noperfileset-quota]</span><br><span class="line">[--mount-priority Priority] [--version VersionString]</span><br><span class="line">[--write-cache-threshold HAWCThreshold]</span><br></pre></td></tr></table></figure><p>创建GPFS文件系统</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">bash-3.2# mmcrfs /oradata oradatalv -F /etc/gpfs/oradata_disklist -B 1M -n 10 -A yes -v no</span><br><span class="line">GPFS: 6027-531 The following disks of oradatalv will be formatted on node p740-rac1:</span><br><span class="line">oradatansd1: size 5242880 MB</span><br><span class="line">oradatansd2: size 5242880 MB</span><br><span class="line">oradatansd3: size 5242880 MB</span><br><span class="line">oradatansd4: size 5242880 MB</span><br><span class="line">GPFS: 6027-540 Formatting file system ...</span><br><span class="line">GPFS: 6027-535 Disks up to size 44 TB can be added to storage pool system.</span><br><span class="line">Creating Inode File</span><br><span class="line">Creating Allocation Maps</span><br><span class="line">Creating Log Files</span><br><span class="line">Clearing Inode Allocation Map</span><br><span class="line">Clearing Block Allocation Map</span><br><span class="line">Formatting Allocation Map for storage pool system</span><br><span class="line">GPFS: 6027-572 Completed creation of file system /dev/oradatalv.</span><br><span class="line">mmcrfs: 6027-1371 Propagating the cluster configuration data to all</span><br><span class="line">affected nodes.  This is an asynchronous process.</span><br><span class="line">查看文件系统</span><br><span class="line"></span><br><span class="line">bash-3.2# lsfs</span><br><span class="line">Name            Nodename   Mount Pt               VFS   Size    Options    Auto Accounting</span><br><span class="line">/dev/hd4        --         /                      jfs2  62914560 rw         yes  no</span><br><span class="line">/dev/hd1        --         /home                  jfs2  41943040 rw         yes  no</span><br><span class="line">/dev/hd2        --         /usr                   jfs2  41943040 rw         yes  no</span><br><span class="line">/dev/hd9var     --         /var                   jfs2  20971520 rw         yes  no</span><br><span class="line">/dev/hd3        --         /tmp                   jfs2  20971520 rw         yes  no</span><br><span class="line">/dev/hd11admin  --         /admin                 jfs2  2097152 rw         yes  no</span><br><span class="line">/proc           --         /proc                  procfs --      rw         yes  no</span><br><span class="line">/dev/hd10opt    --         /opt                   jfs2  20971520 rw         yes  no</span><br><span class="line">/dev/fwdump     --         /var/adm/ras/platform  jfs2  2097152 rw         no   no</span><br><span class="line">/dev/livedump   --         /var/adm/ras/livedump  jfs2  2097152 rw         yes  no</span><br><span class="line">/dev/lv00       --         /var/adm/csd           jfs   2097152 rw         yes  no</span><br><span class="line">/dev/lv_u01     --         /u01                   jfs2  209715200 rw         yes  no</span><br><span class="line">/dev/fslv01     --         /oradata               jfs2  --      rw         yes  no</span><br><span class="line">/dev/lv_g01     --         /g01                   jfs2  209715200 rw         yes  no</span><br><span class="line">/dev/odm        --         /dev/odm               vxodm --      rw         no   no</span><br><span class="line">/dev/oradatalv  -          /oradata               mmfs  --      rw,mtime,atime,dev=oradatalv no   no</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">在所有节点挂载文件系统</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bash-3.2# mmmount all -a</span><br><span class="line">Sun Dec 18 14:26:33 CST 2016: 6027-1623 mmmount: Mounting file systems ...</span><br><span class="line">bash-3.2# mmlsmount all</span><br><span class="line">File system oradatalv is mounted on 2 nodes</span><br><span class="line">查看配置</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bash-3.2# mmlsconfig</span><br><span class="line">Configuration data for cluster jljjgpfs.p740-gpfs1:</span><br><span class="line">---------------------------------------------------</span><br><span class="line">clusterName jljjgpfs.p740-gpfs1</span><br><span class="line">clusterId 2512513396710449389</span><br><span class="line">autoload no</span><br><span class="line">dmapiFileHandleSize 32</span><br><span class="line">minReleaseLevel 4.1.1.4</span><br><span class="line">ccrEnabled yes</span><br><span class="line">adminMode central</span><br><span class="line">File systems in cluster jljjgpfs.p740-gpfs1:</span><br><span class="line">---------</span><br><span class="line">-----------------------------------</span><br><span class="line"></span><br><span class="line">/dev/oradatalv</span><br><span class="line"></span><br><span class="line">参数修改</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bash-3.2# mmchconfig autoload=yes</span><br><span class="line">mmchconfig: Command successfully completed</span><br><span class="line">mmchconfig: 6027-1371 Propagating the cluster configuration data to all</span><br><span class="line">affected nodes.  This is an asynchronous process.</span><br></pre></td></tr></table></figure><p>查看文件系统</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">bash-3.2# lsfs</span><br><span class="line">Name            Nodename   Mount Pt               VFS   Size    Options    Auto Accounting</span><br><span class="line">/dev/hd4        --         /                      jfs2  62914560 rw         yes  no</span><br><span class="line">/dev/hd1        --         /home                  jfs2  41943040 rw         yes  no</span><br><span class="line">/dev/hd2        --         /usr                   jfs2  41943040 rw         yes  no</span><br><span class="line">/dev/hd9var     --         /var                   jfs2  20971520 rw         yes  no</span><br><span class="line">/dev/hd3        --         /tmp                   jfs2  20971520 rw         yes  no</span><br><span class="line">/dev/hd11admin  --         /admin                 jfs2  2097152 rw         yes  no</span><br><span class="line">/proc           --         /proc                  procfs --      rw         yes  no</span><br><span class="line">/dev/hd10opt    --         /opt                   jfs2  20971520 rw         yes  no</span><br><span class="line">/dev/fwdump     --         /var/adm/ras/platform  jfs2  2097152 rw         no   no</span><br><span class="line">/dev/livedump   --         /var/adm/ras/livedump  jfs2  2097152 rw         yes  no</span><br><span class="line">/dev/lv00       --         /var/adm/csd           jfs   2097152 rw         yes  no</span><br><span class="line">/dev/lv_u01     --         /u01                   jfs2  209715200 rw         yes  no</span><br><span class="line">/dev/fslv01     --         /oradata               jfs2  --      rw         yes  no</span><br><span class="line">/dev/lv_g01     --         /g01                   jfs2  209715200 rw         yes  no</span><br><span class="line">/dev/odm        --         /dev/odm               vxodm --      rw         no   no</span><br><span class="line">/dev/oradatalv  -          /oradata               mmfs  --      rw,mtime,atime,dev=oradatalv no   no</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在所有节点挂载文件系统</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bash-3.2# mmmount all -a</span><br><span class="line">Sun Dec 18 14:26:33 CST 2016: 6027-1623 mmmount: Mounting file systems ...</span><br><span class="line">bash-3.2# mmlsmount all</span><br><span class="line">File system oradatalv is mounted on 2 nodes</span><br></pre></td></tr></table></figure><p>查看配置</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">bash-3.2# mmlsconfig</span><br><span class="line">Configuration data for cluster jljjgpfs.p740-gpfs1:</span><br><span class="line">---------------------------------------------------</span><br><span class="line">clusterName jljjgpfs.p740-gpfs1</span><br><span class="line">clusterId 2512513396710449389</span><br><span class="line">autoload no</span><br><span class="line">dmapiFileHandleSize 32</span><br><span class="line">minReleaseLevel 4.1.1.4</span><br><span class="line">ccrEnabled yes</span><br><span class="line">adminMode central</span><br><span class="line">File systems in cluster jljjgpfs.p740-gpfs1:</span><br><span class="line">--------------------------------------------</span><br><span class="line">/dev/oradatalv</span><br></pre></td></tr></table></figure><p>参数修改</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bash-3.2# mmchconfig autoload=yes</span><br><span class="line">mmchconfig: Command successfully completed</span><br><span class="line">mmchconfig: 6027-1371 Propagating the cluster configuration data to all</span><br><span class="line">affected nodes.  This is an asynchronous process.</span><br></pre></td></tr></table></figure><p>欢迎联系我一起讨论。我的微信号：Eric_xu_2023</p><p>也欢迎关注我的公众号：</p><img alt="1.png" src="https://oss-emcsprod-public.modb.pro/image/editor/20251010-1976625582993584128_3605.png" referrerpolicy="no-referrer"/>]]></content>
      
      
      <categories>
          
          <category> aix os </category>
          
      </categories>
      
      
        <tags>
            
            <tag> aix </tag>
            
            <tag> gpfs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AIX系统The largest dump device is too small问题</title>
      <link href="/post/e2e5d7ab.html"/>
      <url>/post/e2e5d7ab.html</url>
      
        <content type="html"><![CDATA[<h2 id="问题报错"><a href="#问题报错" class="headerlink" title="问题报错"></a>问题报错</h2><p>今天巡检HIS的数据库服务器，发现小机AIX系统有大量的报错：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@hisdb01:/]errpt</span><br><span class="line">IDENTIFIER TIMESTAMP  T C RESOURCE_NAME  DESCRIPTION</span><br><span class="line">E87EF1BE   0207150025 P O dumpcheck      The largest dump device is too small.</span><br><span class="line">E87EF1BE   0206150025 P O dumpcheck      The largest dump device is too small.</span><br><span class="line">E87EF1BE   0205150025 P O dumpcheck      The largest dump device is too small.</span><br><span class="line">E87EF1BE   0204150025 P O dumpcheck      The largest dump device is too small.</span><br><span class="line">E87EF1BE   0203150025 P O dumpcheck      The largest dump device is too small.</span><br><span class="line">E87EF1BE   0202150025 P O dumpcheck      The largest dump device is too small.</span><br><span class="line">E87EF1BE   0201150025 P O dumpcheck      The largest dump device is too small.</span><br><span class="line">E87EF1BE   0131150025 P O dumpcheck      The largest dump device is too small.</span><br><span class="line">E87EF1BE   0130150025 P O dumpcheck      The largest dump device is too small.</span><br><span class="line">E87EF1BE   0129150025 P O dumpcheck      The largest dump device is too small.</span><br><span class="line">E87EF1BE   0128150025 P O dumpcheck      The largest dump device is too small.</span><br><span class="line">E87EF1BE   0127150025 P O dumpcheck      The largest dump device is too small.</span><br><span class="line">E87EF1BE   0126150025 P O dumpcheck      The largest dump device is too small.</span><br></pre></td></tr></table></figure><p>关于AIX报错errpt有具体含义如下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">这里的输出分为六列依次为：</span><br><span class="line"></span><br><span class="line">1．错误标示符IDENTIFIER：并不唯一，由它来确定使用的错误模板，显然同一种错误的IDENTIFIER是相同的。</span><br><span class="line"></span><br><span class="line">2．时间戳TIMESTAMP：错误发生的时间，MMDDhhmmYY,依次表示月日时分年。</span><br><span class="line"></span><br><span class="line">3．类型TYPE：错误的类型，或者说严重的程度，共分为6种：</span><br><span class="line">PEND 设备或功能组件可能丢失 简写P</span><br><span class="line">PERF 性能严重下降 P</span><br><span class="line">PERM 硬件设备或软件模块损坏，确诊了的 P</span><br><span class="line">TEMP 临时性错误，经过重试后已经恢复正常 T</span><br><span class="line">INFO 一般消息，不是错误 I</span><br><span class="line">UNKN 不能确定错误的严重性 U</span><br><span class="line"></span><br><span class="line">4．种类CLASS c:指出错误源</span><br><span class="line">H 硬件故障 Hardware</span><br><span class="line">S 软件故障 Software</span><br><span class="line">O 人为操作 Operation</span><br><span class="line">U 不能确定 Unknown</span><br><span class="line"></span><br><span class="line">5． 资源名RESOURCE_NAME</span><br><span class="line">最初检测到错误的资源名软件或者硬件，并不代表这个资源有问题，而只是最先在它发现的。</span><br><span class="line"></span><br><span class="line">6．描述</span><br><span class="line">具体的错误代表的意义可以打IBM的支持热线寻求帮助。</span><br></pre></td></tr></table></figure><h2 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h2><p>那么让我们查看一下报错的具体内容是什么，使用errpt -aj E87EF1BE |more进行分页查看</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">---------------------------------------------------------------------------</span><br><span class="line">LABEL:          DMPCHK_TOOSMALL</span><br><span class="line">IDENTIFIER:     E87EF1BE</span><br><span class="line"></span><br><span class="line">Date/Time:       Fri Feb  7 15:00:00 CST 2025</span><br><span class="line">Sequence Number: 498</span><br><span class="line">Machine Id:      00CB4D104B00</span><br><span class="line">Node Id:         hisdb02</span><br><span class="line">Class:           O</span><br><span class="line">Type:            PEND</span><br><span class="line">WPAR:            Global</span><br><span class="line">Resource Name:   dumpcheck       </span><br><span class="line"></span><br><span class="line">Description</span><br><span class="line">The largest dump device is too small.</span><br><span class="line"></span><br><span class="line">Probable Causes</span><br><span class="line">Neither dump device is large enough to accommodate a system dump at this time.</span><br><span class="line"></span><br><span class="line">        Recommended Actions</span><br><span class="line">        Increase the size of one or both dump devices.</span><br><span class="line"></span><br><span class="line">Detail Data</span><br><span class="line">Largest dump device</span><br><span class="line">lg_dumplv                                                                                                                       </span><br><span class="line">Largest dump device size in kb</span><br><span class="line">     4194304</span><br><span class="line">Current estimated dump size in kb</span><br><span class="line">     4637388</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">LABEL:          DMPCHK_TOOSMALL</span><br><span class="line">IDENTIFIER:     E87EF1BE</span><br></pre></td></tr></table></figure><p>根据上述的内容可以看出Probable Causes的原因是lg_dumplv空间不足导致的，设置的大小是4194304，实际的大小是</p><p>4637388，因此报错。关于<strong>dump devices</strong> IBM的描述如下：</p><blockquote><p>When an unexpected system halt occurs, the system dump facility automatically copies selected areas of kernel data to the primary dump device. These areas include kernel segment 0, and other areas registered in the Master Dump Table by kernel modules or kernel extensions.</p><p>当系统意外停止时，系统转储工具会自动将内核数据的选定区域复制到主转储设备。这些区域包括内核段 0 以及内核模块或内核扩展在 Master Dump Table 中注册的其他区域。</p></blockquote><p>可以通过命令查看当前大小</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@hisdb01:/]sysdumpdev -e</span><br><span class="line">0453-041 Estimated dump size in bytes: 4505080954</span><br></pre></td></tr></table></figure><p>比较有意思的就是这个报错总在每天的15点报错，这是为啥呢。其实是系统的默认定时任务</p><p>通过crontab -l可以看到每天15：00有个默认的任务执行&#x2F;usr&#x2F;lib&#x2F;ras&#x2F;dumpcheck</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@hisdb01:/]crontab -l</span><br><span class="line"># @(#)08        1.15.1.3  src/bos/usr/sbin/cron/root, cmdcntl, bos720 2/11/94 17:19:47</span><br><span class="line"># IBM_PROLOG_BEGIN_TAG </span><br><span class="line"># This is an automatically generated prolog. </span><br><span class="line">#  </span><br><span class="line"># bos720 src/bos/usr/sbin/cron/root 1.15.1.3 </span><br><span class="line">#  </span><br><span class="line"># Licensed Materials - Property of IBM </span><br><span class="line">#  </span><br><span class="line"># COPYRIGHT International Business Machines Corp. 1989,1994 </span><br><span class="line"># All Rights Reserved </span><br><span class="line">#  </span><br><span class="line"># US Government Users Restricted Rights - Use, duplication or </span><br><span class="line"># disclosure restricted by GSA ADP Schedule Contract with IBM Corp. </span><br><span class="line">#  </span><br><span class="line"># IBM_PROLOG_END_TAG </span><br><span class="line">#</span><br><span class="line"># COMPONENT_NAME: (CMDCNTL) commands needed for basic system needs</span><br><span class="line">#</span><br><span class="line"># FUNCTIONS: </span><br><span class="line">#</span><br><span class="line"># ORIGINS: 27</span><br><span class="line">#</span><br><span class="line"># (C) COPYRIGHT International Business Machines Corp. 1989,1994</span><br><span class="line"># All Rights Reserved</span><br><span class="line"># Licensed Materials - Property of IBM</span><br><span class="line">#</span><br><span class="line"># US Government Users Restricted Rights - Use, duplication or</span><br><span class="line"># disclosure restricted by GSA ADP Schedule Contract with IBM Corp.</span><br><span class="line">#</span><br><span class="line">#0 3 * * * /usr/sbin/skulker</span><br><span class="line">#45 2 * * 0 /usr/lib/spell/compress</span><br><span class="line">#45 23 * * * ulimit 5000; /usr/lib/smdemon.cleanu &gt; /dev/null</span><br><span class="line">0 11 * * * /usr/bin/errclear -d S,O 30</span><br><span class="line">0 12 * * * /usr/bin/errclear -d H 90</span><br><span class="line">0,5,10,15,20,25,30,35,40,45,50,55 * * * * /usr/sbin/dumpctrl -k &gt;/dev/null 2&gt;/dev/null</span><br><span class="line">0 15 * * *  /usr/lib/ras/dumpcheck &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">30 23 * * * /usr/sbin/ntpdate 192.168.50.250</span><br><span class="line">0 0 * * * /usr/bin/nmon -f -N -m /nmon -s 30 -c 2880</span><br></pre></td></tr></table></figure><p>我们来简单看一下这个命令的作用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@hisdb01:/]/usr/lib/ras/dumpcheck -h</span><br><span class="line">getopt: Not a recognized flag: h</span><br><span class="line">Usage:</span><br><span class="line">dumpcheck [[-l] [-p ] [-t time-parameters] [-P ]]</span><br><span class="line">dumpcheck [-r ]</span><br><span class="line"></span><br><span class="line">Checks to see that the dump device and copy directory </span><br><span class="line">are able to receive the system dump.</span><br><span class="line"></span><br><span class="line">-l                      Log any warnings to the error log. </span><br><span class="line">-p                      Print any warnings produced to stdout.</span><br><span class="line">-r                      Remove the crontab entry for this function.</span><br><span class="line">-P                      Indicates that the changes are to be made permenently.</span><br><span class="line">-t time-parameters      Change the time when dumpcheck is executed.</span><br><span class="line"></span><br><span class="line">The -r parameter must be specified alone, </span><br><span class="line">(i.e.) it is not valid with any other parameters. </span><br></pre></td></tr></table></figure><p>执行一下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@hisdb01:/]/usr/lib/ras/dumpcheck -p</span><br><span class="line">The largest dump device is too small.</span><br><span class="line"></span><br><span class="line">Largest dump device</span><br><span class="line">         lg_dumplv</span><br><span class="line">Largest dump device size in kb</span><br><span class="line">         4194304</span><br><span class="line">Current estimated dump size in kb</span><br><span class="line">         4637388</span><br></pre></td></tr></table></figure><h2 id="问题处理"><a href="#问题处理" class="headerlink" title="问题处理"></a>问题处理</h2><p>即然确定了问题哪里来的，下面进行一下问题fix，先确认一下lg_dumplv分配的大小，默认分配的是4G（PPS&#x3D;4，PP SIZE&#x3D;1024M）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@hisdb01:/]lslv lg_dumplv</span><br><span class="line">LOGICAL VOLUME:     lg_dumplv              VOLUME GROUP:   rootvg</span><br><span class="line">LV IDENTIFIER:      00cb47b000004b0000000189e0b21f89.12 PERMISSION:     read/write</span><br><span class="line">VG STATE:           active/complete        LV STATE:       opened/syncd</span><br><span class="line">TYPE:               sysdump                WRITE VERIFY:   off</span><br><span class="line">MAX LPs:            512                    PP SIZE:        1024 megabyte(s)</span><br><span class="line">COPIES:             1                      SCHED POLICY:   parallel</span><br><span class="line">LPs:                4                      PPs:            4</span><br><span class="line">STALE PPs:          0                      BB POLICY:      relocatable</span><br><span class="line">INTER-POLICY:       minimum                RELOCATABLE:    yes</span><br><span class="line">INTRA-POLICY:       middle                 UPPER BOUND:    32</span><br><span class="line">MOUNT POINT:        N/A                    LABEL:          None</span><br><span class="line">MIRROR WRITE CONSISTENCY: on/ACTIVE                              </span><br><span class="line">EACH LP COPY ON A SEPARATE PV ?: yes                                    </span><br><span class="line">Serialize IO ?:     NO                                     </span><br><span class="line">INFINITE RETRY:     no                     PREFERRED READ: 0</span><br><span class="line">ENCRYPTION:         no                                     </span><br></pre></td></tr></table></figure><p>lg_dumplv来自于系统rootvg，该LV为非mirror lv，可以看到lg_dumplov来自于hdisk0磁盘上。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">[root@hisdb01:/]lsvg -l rootvg</span><br><span class="line">rootvg:</span><br><span class="line">LV NAME             TYPE       LPs     PPs     PVs  LV STATE      MOUNT POINT</span><br><span class="line">hd5                 boot       1       2       2    closed/syncd  N/A</span><br><span class="line">hd6                 paging     33      66      2    open/syncd    N/A</span><br><span class="line">hd8                 jfs2log    1       2       2    open/syncd    N/A</span><br><span class="line">hd4                 jfs2       50      100     2    open/syncd    /</span><br><span class="line">hd2                 jfs2       10      20      2    open/syncd    /usr</span><br><span class="line">hd9var              jfs2       10      20      2    open/syncd    /var</span><br><span class="line">hd3                 jfs2       10      20      2    open/syncd    /tmp</span><br><span class="line">hd1                 jfs2       1       2       2    open/syncd    /home</span><br><span class="line">hd10opt             jfs2       10      20      2    open/syncd    /opt</span><br><span class="line">hd11admin           jfs2       1       2       2    open/syncd    /admin</span><br><span class="line">fwdump              jfs2       3       6       2    open/syncd    /var/adm/ras/platform</span><br><span class="line">lg_dumplv           sysdump    6       6       1    open/syncd    N/A</span><br><span class="line">livedump            jfs2       1       2       2    open/syncd    /var/adm/ras/livedump</span><br><span class="line">fslv00              jfs2       100     200     2    open/syncd    /u01</span><br><span class="line">fslv01              jfs2       100     200     2    open/syncd    /g01</span><br><span class="line">[root@hisdb01:/]lspv -l hdisk0</span><br><span class="line">hdisk0:</span><br><span class="line">LV NAME               LPs     PPs     DISTRIBUTION          MOUNT POINT</span><br><span class="line">fwdump                3       3       00..03..00..00..00    /var/adm/ras/platform</span><br><span class="line">hd11admin             1       1       00..00..01..00..00    /admin</span><br><span class="line">livedump              1       1       00..01..00..00..00    /var/adm/ras/livedump</span><br><span class="line">lg_dumplv             6       6       00..06..00..00..00    N/A</span><br><span class="line">fslv01                100     100     00..00..43..57..00    /g01</span><br><span class="line">fslv00                100     100     100..00..00..00..00   /u01</span><br><span class="line">hd5                   1       1       01..00..00..00..00    N/A</span><br><span class="line">hd6                   33      33      00..33..00..00..00    N/A</span><br><span class="line">hd8                   1       1       00..00..01..00..00    N/A</span><br><span class="line">hd4                   50      50      00..30..20..00..00    /</span><br><span class="line">hd2                   10      10      00..00..10..00..00    /usr</span><br><span class="line">hd9var                10      10      00..00..10..00..00    /var</span><br><span class="line">hd3                   10      10      00..00..10..00..00    /tmp</span><br><span class="line">hd1                   1       1       00..00..01..00..00    /home</span><br><span class="line">hd10opt               10      10      00..00..10..00..00    /opt</span><br><span class="line">[root@hisdb01:/]lspv -l hdisk1</span><br><span class="line">hdisk1:</span><br><span class="line">LV NAME               LPs     PPs     DISTRIBUTION          MOUNT POINT</span><br><span class="line">fwdump                3       3       00..03..00..00..00    /var/adm/ras/platform</span><br><span class="line">hd11admin             1       1       00..00..01..00..00    /admin</span><br><span class="line">livedump              1       1       00..01..00..00..00    /var/adm/ras/livedump</span><br><span class="line">fslv01                100     100     00..00..43..57..00    /g01</span><br><span class="line">fslv00                100     100     100..00..00..00..00   /u01</span><br><span class="line">hd5                   1       1       01..00..00..00..00    N/A</span><br><span class="line">hd6                   33      33      00..33..00..00..00    N/A</span><br><span class="line">hd8                   1       1       00..00..01..00..00    N/A</span><br><span class="line">hd4                   50      50      00..30..20..00..00    /</span><br><span class="line">hd2                   10      10      00..00..10..00..00    /usr</span><br><span class="line">hd9var                10      10      00..00..10..00..00    /var</span><br><span class="line">hd3                   10      10      00..00..10..00..00    /tmp</span><br><span class="line">hd1                   1       1       00..00..01..00..00    /home</span><br><span class="line">hd10opt               10      10      00..00..10..00..00    /opt</span><br></pre></td></tr></table></figure><p>检查一下rootvg是否有可用空间</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@hisdb01:/]lsvg rootvg</span><br><span class="line">VOLUME GROUP:       rootvg                   VG IDENTIFIER:  00cb47b000004b0000000189e0b21f89</span><br><span class="line">VG STATE:           active                   PP SIZE:        1024 megabyte(s)</span><br><span class="line">VG PERMISSION:      read/write               TOTAL PPs:      1064 (1089536 megabytes)</span><br><span class="line">MAX LVs:            256                      FREE PPs:       398 (407552 megabytes)</span><br><span class="line">LVs:                15                       USED PPs:       666 (681984 megabytes)</span><br><span class="line">OPEN LVs:           14                       QUORUM:         1 (Disabled)</span><br><span class="line">TOTAL PVs:          2                        VG DESCRIPTORS: 3</span><br><span class="line">STALE PVs:          0                        STALE PPs:      0</span><br><span class="line">ACTIVE PVs:         2                        AUTO ON:        yes</span><br><span class="line">MAX PPs per VG:     32512                                     </span><br><span class="line">MAX PPs per PV:     1016                     MAX PVs:        32</span><br><span class="line">LTG size (Dynamic): 256 kilobyte(s)          AUTO SYNC:      no</span><br><span class="line">HOT SPARE:          no                       BB POLICY:      relocatable </span><br><span class="line">PV RESTRICTION:     none                     INFINITE RETRY: no</span><br><span class="line">DISK BLOCK SIZE:    512                      CRITICAL VG:    no</span><br><span class="line">FS SYNC OPTION:     no                       CRITICAL PVs:   no</span><br><span class="line">ENCRYPTION:         no                                        </span><br></pre></td></tr></table></figure><p>执行lg_dumplv扩容，之后再查看</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@hisdb01:/]extendlv lg_dumplv 2</span><br><span class="line">[root@hisdb01:/]lslv lg_dumplv</span><br><span class="line">LOGICAL VOLUME:     lg_dumplv              VOLUME GROUP:   rootvg</span><br><span class="line">LV IDENTIFIER:      00cb47b000004b0000000189e0b21f89.12 PERMISSION:     read/write</span><br><span class="line">VG STATE:           active/complete        LV STATE:       opened/syncd</span><br><span class="line">TYPE:               sysdump                WRITE VERIFY:   off</span><br><span class="line">MAX LPs:            512                    PP SIZE:        1024 megabyte(s)</span><br><span class="line">COPIES:             1                      SCHED POLICY:   parallel</span><br><span class="line">LPs:                6                      PPs:            6</span><br><span class="line">STALE PPs:          0                      BB POLICY:      relocatable</span><br><span class="line">INTER-POLICY:       minimum                RELOCATABLE:    yes</span><br><span class="line">INTRA-POLICY:       middle                 UPPER BOUND:    32</span><br><span class="line">MOUNT POINT:        N/A                    LABEL:          None</span><br><span class="line">MIRROR WRITE CONSISTENCY: on/ACTIVE                              </span><br><span class="line">EACH LP COPY ON A SEPARATE PV ?: yes                                    </span><br><span class="line">Serialize IO ?:     NO                                     </span><br><span class="line">INFINITE RETRY:     no                     PREFERRED READ: 0</span><br><span class="line">ENCRYPTION:         no             </span><br></pre></td></tr></table></figure><p>这时再查看，可以看到rootvg的FREE PPS少了2个。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@hisdb01:/]lsvg rootvg</span><br><span class="line">VOLUME GROUP:       rootvg                   VG IDENTIFIER:  00cb47b000004b0000000189e0b21f89</span><br><span class="line">VG STATE:           active                   PP SIZE:        1024 megabyte(s)</span><br><span class="line">VG PERMISSION:      read/write               TOTAL PPs:      1064 (1089536 megabytes)</span><br><span class="line">MAX LVs:            256                      FREE PPs:       396 (405504 megabytes)</span><br><span class="line">LVs:                15                       USED PPs:       668 (684032 megabytes)</span><br><span class="line">OPEN LVs:           14                       QUORUM:         1 (Disabled)</span><br><span class="line">TOTAL PVs:          2                        VG DESCRIPTORS: 3</span><br><span class="line">STALE PVs:          0                        STALE PPs:      0</span><br><span class="line">ACTIVE PVs:         2                        AUTO ON:        yes</span><br><span class="line">MAX PPs per VG:     32512                                     </span><br><span class="line">MAX PPs per PV:     1016                     MAX PVs:        32</span><br><span class="line">LTG size (Dynamic): 256 kilobyte(s)          AUTO SYNC:      no</span><br><span class="line">HOT SPARE:          no                       BB POLICY:      relocatable </span><br><span class="line">PV RESTRICTION:     none                     INFINITE RETRY: no</span><br><span class="line">DISK BLOCK SIZE:    512                      CRITICAL VG:    no</span><br><span class="line">FS SYNC OPTION:     no                       CRITICAL PVs:   no</span><br><span class="line">ENCRYPTION:         no                                        </span><br></pre></td></tr></table></figure><p>由于这台服务器再没有别的报错，那么我们手动清空下报错，再手动check一下。确认无报错产生，问题解决完毕。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@hisdb01:/]errclear 0</span><br><span class="line">[root@hisdb01:/]errpt</span><br><span class="line">[root@hisdb01:/]/usr/lib/ras/dumpcheck</span><br><span class="line">[root@hisdb01:/]errpt</span><br></pre></td></tr></table></figure><h2 id="此问题产生的原因"><a href="#此问题产生的原因" class="headerlink" title="此问题产生的原因"></a>此问题产生的原因</h2><p><strong>默认的lg_dumplv大小</strong></p><p>在AIX 系统中的lg_dumplv 逻辑卷是用于存放系统dump 的区域。 在安装系统时是否创建该逻辑卷与服务器的内存配置有关。 若服务器的内存小于4GB时, 那么在安装 AIX 5.2 或 5.3时，系统就不会自动创建它。而缺省将系统dump 存放在hd6上。 当服务器的内存大于4GB时，在安装AIX时，就会为系统 dump 创建一专用区域，该逻辑卷名就是 lg_dumplv. 其缺省大小是按以下规则分配的： . 4GB &lt; &#x3D; 服务器的内存 〈 12GB lg_dump 的大小为 1GB . 12GB &lt; &#x3D; 服务器的内存 〈 24GB lg_dump 的大小为 2GB . 24GB &lt; &#x3D; 服务器的内存 〈 48GB lg_dump 的大小为 3GB . 48GB &lt; &#x3D; 服务器的内存 lg_dump 的大小为 4GB</p><p>我这台服务器是128G内存的，因此默认的lg_dumplv大小为4G也符合。</p><p><strong>关于dumpcheck</strong></p><p><strong>&#x2F;usr&#x2F;lib&#x2F;ras&#x2F;dumpcheck</strong> 命令用来检查系统转储使用的磁盘资源。 如果最大转储设备不足以接收转储，或者转储调页空间时，在拷贝目录中空间不够，该命令就记录一个错误。</p><p><strong>dumpcheck</strong> 通常是每天在当地时间下午 3 点由守护程序运行。 当使用 <strong>-r</strong> 标志从根目录的 <strong>crontab</strong> 中删除或者使用 <strong>-t</strong> <em>TimeParameters</em>，更改转储检查的运行时间时，这可能有所变化。 也可以从 SMIT 进行配置。 安装服务辅助时， <strong>dumpcheck</strong> 会自动添加到 root 用户的 <strong>crontab</strong> 。</p><p>要取得最大效力，应该是在系统负载最大时运行 <strong>dumpcheck</strong>。 这些时候，系统的转储最有可能是它的最大值。 同样，即使使用 <strong>dumpcheck</strong> 观察转储的大小，仍然可能发生转储在转储装置或者是发生时在拷贝目录中不合适。 如果在转储时间刚好有一个系统负载高峰，这也可能发生。</p><p>然而默认转储设备通常不够大，无法进行完整转储，因此会有这个定时任务定时检查，并在不足的时候报错提示进行扩展。</p><p>这里提供一些参考</p><p>[管理系统转储设备]:</p><p><a href="https://www.ibm.com/support/pages/managing-system-dump-devices">https://www.ibm.com/support/pages/managing-system-dump-devices</a></p><p>[dumpcheck 命令 - IBM 文档]:</p><p><a href="https://www.ibm.com/docs/zh/aix/7.3?topic=d-dumpcheck-command">https://www.ibm.com/docs/zh/aix/7.3?topic=d-dumpcheck-command</a></p><p>欢迎联系我一起讨论。我的微信号：Eric_xu_2023</p><p>也欢迎关注我的公众号：</p><img alt="1.png" src="https://oss-emcsprod-public.modb.pro/image/editor/20251010-1976625582993584128_3605.png" referrerpolicy="no-referrer"/>]]></content>
      
      
      <categories>
          
          <category> aix os </category>
          
      </categories>
      
      
        <tags>
            
            <tag> aix </tag>
            
            <tag> dump </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AIX平台下Oracle 11g RAC修改PUBLIC/VIP/SCAN</title>
      <link href="/post/4358307c.html"/>
      <url>/post/4358307c.html</url>
      
        <content type="html"><![CDATA[<h2 id="当前环境"><a href="#当前环境" class="headerlink" title="当前环境"></a>当前环境</h2><p>由于机房网络变更，客户要修改现在RAC的public&#x2F;vip&#x2F;scan地址，这里记录一下。</p><p>主机操作系统：AIX 7.2</p><p>数据库版本：11.2.0.4 rac</p><p>数据库实例名：orcl1&#x2F;orcl2</p><p>当前hosts文件配置</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">192.168.56.10   rac1</span><br><span class="line">192.168.56.11   rac2</span><br><span class="line">10.10.10.1      rac1-priv</span><br><span class="line">10.10.10.2      rac2-priv</span><br><span class="line">192.168.56.12   rac1-vip</span><br><span class="line">192.168.56.13   rac2-vip</span><br><span class="line">192.168.56.14   rac-scan</span><br></pre></td></tr></table></figure><p>计划修改后的IP地址（priv-IP由于两台服务器直连不过交换机，保持不变）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">192.168.56.120   rac1</span><br><span class="line">192.168.56.121   rac2</span><br><span class="line">10.10.10.1      rac1-priv</span><br><span class="line">10.10.10.2      rac2-priv</span><br><span class="line">192.168.56.122   rac1-vip</span><br><span class="line">192.168.56.123   rac2-vip</span><br><span class="line">192.168.56.124   rac-scan</span><br></pre></td></tr></table></figure><h2 id="修改PUBLIC-IP"><a href="#修改PUBLIC-IP" class="headerlink" title="修改PUBLIC-IP"></a>修改PUBLIC-IP</h2><p>1、停止两节点CRS</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--root用户执行</span><br><span class="line">/g01/app/11.2.0/grid/bin/crsctl stop crs</span><br></pre></td></tr></table></figure><p>2、备份并修改hosts</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cp /etc/hosts /etc/hosts.bak</span><br><span class="line">注释或删除旧的配置，修改。</span><br><span class="line">cat /etc/hots</span><br><span class="line">192.168.56.120   rac1</span><br><span class="line">192.168.56.121   rac2</span><br><span class="line">10.10.10.1      rac1-priv</span><br><span class="line">10.10.10.2      rac2-priv</span><br><span class="line">192.168.56.122   rac1-vip</span><br><span class="line">192.168.56.123   rac2-vip</span><br><span class="line">192.168.56.124   rac-scan</span><br></pre></td></tr></table></figure><p>3、修改主机IP地址</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#这里以AIX为例，如果是LINUX，请用相应的命令修改，使用root用户执行</span><br><span class="line">chdev -l en8 -a netaddr=192.168.56.120 -a netmask=255.255.255.0 -a state=up</span><br><span class="line">chdev -l en8 -a netaddr=192.168.56.121 -a netmask=255.255.255.0 -a state=up</span><br><span class="line">--修改完重新连接新的IP地址</span><br></pre></td></tr></table></figure><p>4、启动CRS</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--root用户执行</span><br><span class="line">/g01/app/11.2.0/grid/bin/crsctl start crs</span><br></pre></td></tr></table></figure><p>检查修改情况，此时VIP应该自动使用最新的</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/g01/app/11.2.0/grid/bin/srvctl config nodeapps -a</span><br><span class="line">ifconfig -a</span><br></pre></td></tr></table></figure><h2 id="修改SCAN-IP"><a href="#修改SCAN-IP" class="headerlink" title="修改SCAN-IP"></a>修改SCAN-IP</h2><p>srvctl config scan 查看当前设置</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">--root用户执行</span><br><span class="line">/u01/11.2.0/grid/bin/srvctl config scan</span><br><span class="line">SCAN name: rac-scan, Network: 1/192.168.56.0/255.255.255.0/en8</span><br><span class="line">SCAN VIP name: scan1, IP: /rac-scan/192.168.56.14</span><br></pre></td></tr></table></figure><p>执行命令修改</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">--root执行</span><br><span class="line">/g01/app/11.2.0/grid/bin/srvctl stop scan_listener</span><br><span class="line">/g01/app/11.2.0/grid/bin/srvctl stop scan         </span><br><span class="line">/g01/app/11.2.0/grid/bin/srvctl modify scan -n 192.168.56.124</span><br><span class="line">/g01/app/11.2.0/grid/bin/srvctl start scan_listener</span><br><span class="line">/g01/app/11.2.0/grid/bin/srvctl config scan        </span><br></pre></td></tr></table></figure><p>检查是否修改成功</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">--root用户执行</span><br><span class="line">/g01/app/11.2.0/grid/bin/srvctl config scan</span><br><span class="line">返回结果</span><br><span class="line">SCAN name: 192.168.56.124, Network: 1/192.168.56.0/255.255.255.0/en8</span><br><span class="line">SCAN VIP name: scan1, IP: /192.168.56.124/192.168.56.124</span><br></pre></td></tr></table></figure><h2 id="修改数据库"><a href="#修改数据库" class="headerlink" title="修改数据库"></a>修改数据库</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">--登录到数据库执行</span><br><span class="line">alter system set local_listener=&#x27;(DESCRIPTION=(ADDRESS_LIST=(ADDRESS=(PROTOCOL=TCP)(HOST=192.168.56.122)(PORT=1521))))&#x27; scope=both sid=&#x27;orcl1&#x27;;</span><br><span class="line">alter system set local_listener=&#x27;(DESCRIPTION=(ADDRESS_LIST=(ADDRESS=(PROTOCOL=TCP)(HOST=192.168.56.123)(PORT=1521))))&#x27; scope=both sid=&#x27;orcl2&#x27;;</span><br></pre></td></tr></table></figure><p>检查无误，大功告成！</p><p>欢迎联系我一起讨论。我的微信号：Eric_xu_2023</p><p>也欢迎关注我的公众号：</p><img alt="1.png" src="https://oss-emcsprod-public.modb.pro/image/editor/20251010-1976625582993584128_3605.png" referrerpolicy="no-referrer"/>]]></content>
      
      
      <categories>
          
          <category> oracle_rac </category>
          
      </categories>
      
      
        <tags>
            
            <tag> aix </tag>
            
            <tag> oracle </tag>
            
            <tag> database </tag>
            
            <tag> rac </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>推荐一些学习数据库的BLOG</title>
      <link href="/post/443887d3.html"/>
      <url>/post/443887d3.html</url>
      
        <content type="html"><![CDATA[<p>这里我推荐一些学习中遇到的非常好的国内外BLOG给大家，仅供参考。</p><p><strong>Oracle top 100-blog排名</strong></p><p><a href="https://developer.feedspot.com/oracle_blogs/">https://developer.feedspot.com/oracle_blogs/</a></p><p><strong>英国老牌ACE  Tim Hall的BLOG，几乎涵盖了所有版本Oracle的安装配置，写的非常的详细，入门必看</strong></p><p><a href="https://oracle-base.com/">https://oracle-base.com/</a></p><p><strong>徐小强的blog，都是详解万字长文！</strong></p><p><a href="https://blog.csdn.net/JiekeXu">https://blog.csdn.net/JiekeXu</a></p><p><strong>尹总监的blog，19c全系列实战干货</strong></p><p><a href="https://blog.csdn.net/yhw1809">https://blog.csdn.net/yhw1809</a></p><p><strong>陈举超大佬的文章也是十分的详细🔎的实验</strong></p><p><a href="https://www.modb.pro/u/4703">https://www.modb.pro/u/4703</a></p><p><strong>三哥的自动化安装脚本可谓是全网第一，还有各种干货。</strong></p><p><a href="https://luciferliu.blog.csdn.net/">https://luciferliu.blog.csdn.net/</a></p><p><strong>云和恩墨的专家张维照，内容很全，可以通篇看一遍</strong></p><p><a href="https://www.anbob.com/aboutme-page">https://www.anbob.com/aboutme-page</a></p><p><strong>墨天轮知识图谱，涵盖大部分数据库，己经按照相应的学习路线整理好文章。</strong></p><p><a href="https://www.modb.pro/graph">https://www.modb.pro/graph</a></p><p><strong>墨天轮高分技术文档分享——Oracle升级迁移篇（共96个）</strong></p><p><a href="https://www.modb.pro/db/406311">https://www.modb.pro/db/406311</a></p><p><strong>来自大名顶顶存储公司Pure Storage的Oracle ACE专家Ro****n</strong></p><p><a href="https://ronekins.com/">https://ronekins.com/</a></p><p><strong>具体是谁这个没看明白，不过blog写的内容十分具有参考价值</strong></p><p><a href="https://www.howtosop.com/">https://www.howtosop.com/</a></p><p><strong>来自印度大佬的BLOG，内容也很全面</strong></p><p><a href="https://oracledbwr.com/">https://oracledbwr.com/</a></p><p><strong>还有一个或取知识的好办法，就是直接登陆oracle ace directory网站，找到任意ACE的链接进入，看看ACE大佬们的BLOG，哈哈！</strong></p><p><a href="https://ace.oracle.com/pls/apex/r/ace_program/oracle-aces/directory">https://ace.oracle.com/pls/apex/r/ace_program/oracle-aces/directory</a></p>]]></content>
      
      
      <categories>
          
          <category> Recommended Articles </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oracle </tag>
            
            <tag> database </tag>
            
            <tag> linux </tag>
            
            <tag> recommended </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用expdp按条件导出oracle逻辑备份</title>
      <link href="/post/d1734970.html"/>
      <url>/post/d1734970.html</url>
      
        <content type="html"><![CDATA[<p>今天遇到一个客户找我处理一个小问题，主要是按条件导出数据表报错，这里记录一下如何处理的。</p><h2 id="expdp-直接带查询条件语句可能出现的情况"><a href="#expdp-直接带查询条件语句可能出现的情况" class="headerlink" title="expdp 直接带查询条件语句可能出现的情况"></a>expdp 直接带查询条件语句可能出现的情况</h2><p>直接在导出命令里写QUERY&#x3D;&lt;查询SQL&gt;来按条件导出数据表可能会报这些错误</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">--错误1</span><br><span class="line">LRM-00101: unknown parameter name &#x27;empno&#x27;</span><br><span class="line">--错误2</span><br><span class="line">ORA-39001: invalid argument value</span><br><span class="line">ORA-39035: Data filter SUBQUERY has already been specified</span><br><span class="line">--错误3</span><br><span class="line">ORA-31693: Table data object &quot;SCOTT&quot;.&quot;DEPT&quot; failed to load/unload and is being skipped due to error:</span><br><span class="line">ORA-00933: SQL command not properly ended</span><br><span class="line">--错误4</span><br><span class="line">LRM-00111: no closing quote for value &#x27;&#x27;</span><br><span class="line">EXP-19: failed to process parameters, type &#x27;EXP HELP=Y&#x27; for help</span><br><span class="line">EXP-0: Export terminated unsuccessfully</span><br><span class="line">--错误5</span><br><span class="line">ORA-31693: Table data object &quot;SCOTT&quot;.&quot;DEPT&quot; failed to load/unload and is being skipped due to error:</span><br><span class="line">ORA-06502: PL/SQL: numeric or value error</span><br><span class="line">ORA-31605: the following was returned from LpxXSLSetTextVar in routine kuxslSetParam:</span><br><span class="line">LPX-314: an internal failure occurred</span><br><span class="line">--错误6</span><br><span class="line">...</span><br><span class="line">Processing object type TABLE_EXPORT/TABLE/TABLE</span><br><span class="line">ORA-31693: Table data object &quot;&lt;SCHEMA_NAME&gt;&quot;.&quot;&lt;TABLE_NAME&gt;&quot; failed to load/unload and is being skipped due</span><br><span class="line">to error:</span><br><span class="line">ORA-00911: invalid character</span><br></pre></td></tr></table></figure><p>大部分的原因为是因为涉及到特殊字符需要转义，如果没有加转义符号\可能就会报错，但是万一是个复杂SQL还要到处去转义一下比较麻烦。</p><h2 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h2><p>把相关的参数写到配置文件里，expdp直接调用文件即可。</p><p>比如我要导出某张表里指定时间内的数据，并且每个文件30G大小，示例如下：</p><p>oracle用户在当前目录创建文件 query.par，内容如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">DIRECTORY=DATA_PUMP_DIR</span><br><span class="line">DUMPFILE=2024_%U</span><br><span class="line">LOGFILE=2024.log</span><br><span class="line">filesize=30000M</span><br><span class="line">tables=TABLE_01</span><br><span class="line">QUERY=TABLE_01:&quot;where to_char(time,&#x27;YYYY-MM-DD hh:mi&#x27;)&gt;=&#x27;2024-01-01 00:00&#x27;and to_char(time,&#x27;YYYY-MM-DD hh:mi&#x27;)&lt;=&#x27;2024-12-31 23:59&#x27;&quot;</span><br></pre></td></tr></table></figure><p>执行，手动输入密码即可。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expdp parfile=query.par</span><br></pre></td></tr></table></figure><h2 id="结束"><a href="#结束" class="headerlink" title="结束"></a>结束</h2><p>不是啥新知识点，不总干数据库的活，手生，现学现用，记录一下。</p><p>更多示例参考Export&#x2F;Import DataPump Parameter QUERY - How to Specify a Query (Doc ID 277010.1)</p><p>欢迎联系我一起讨论。我的微信号：Eric_xu_2023</p><p>也欢迎关注我的公众号：</p><img alt="1.png" src="https://oss-emcsprod-public.modb.pro/image/editor/20251010-1976625582993584128_3605.png" referrerpolicy="no-referrer"/>]]></content>
      
      
      <categories>
          
          <category> oracle_backup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oracle </tag>
            
            <tag> database </tag>
            
            <tag> linux </tag>
            
            <tag> backup </tag>
            
            <tag> logical </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>简易异地保留RMAN备份的方案</title>
      <link href="/post/dca58675.html"/>
      <url>/post/dca58675.html</url>
      
        <content type="html"><![CDATA[<h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p>客户原有个中心机房A，里面有台windows 服务器运行oracle 11g</p><p>在不远的机房B里有台XXG备份一体机对这个oracle进行定时备份，但是由于XXG备份一本体过保且备份故障无法继续了。</p><p>客户想要实现一个简易的备份，并能存储到B机房的服务器中，以防止数据丢失。</p><h2 id="简易RMAN设计"><a href="#简易RMAN设计" class="headerlink" title="简易RMAN设计"></a>简易RMAN设计</h2><p>由于数据库不是很大，实际的数据量只有几十G，于是计划如下：</p><p>1、在A中心的数据库服务器上配置定时RMAN备份</p><p>2、在B中心的服务器上配置FTP，并打通A中心数据库服务器到B中心FTP的网络</p><p>3、配置A中心的数据库RMAN备份后，进行RAR压缩备份，再上传备份包到B中心的FTP上</p><p>4、A中心的数据库服务器保留15天备份。B中心的备份一直保留。</p><p>A中心的数据库服务器新建如下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">--备份目录</span><br><span class="line">F:\BACKUP</span><br><span class="line">--FTP上传日志记录</span><br><span class="line">F:\backup\FTP-LOG</span><br><span class="line">--存储相关的执行脚本</span><br><span class="line">F:\scriptr\rman_backup_full.bat  //备份执行脚本</span><br><span class="line">F:\script\Dbfull.rman            //备份脚本</span><br><span class="line">F:\script\ftp.bat                //FTP上传脚本</span><br><span class="line">F:\script\clear15.bat            //定时清理</span><br></pre></td></tr></table></figure><h2 id="配置脚本"><a href="#配置脚本" class="headerlink" title="配置脚本"></a>配置脚本</h2><p>1、创建备份脚本</p><p>备份脚本F:\script\Dbfull.rman</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">run&#123;   </span><br><span class="line">allocate channel c1 type disk;   </span><br><span class="line">backup  incremental level 0 tag &#x27;db0&#x27; format &#x27;f:\backup\rman_backup_db%u_%s_%p.dbf&#x27;database </span><br><span class="line">include current controlfile;</span><br><span class="line">release channel c1;   </span><br><span class="line">sql &#x27;alter system archive log current&#x27;;</span><br><span class="line">allocate channel c10 type disk;</span><br><span class="line">backup filesperset 50 format &#x27;f:\backup\rman_backup_arch%u_%s_%p.dbf&#x27; archivelog all delete input;    </span><br><span class="line">release channel c10;    </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line">run&#123;</span><br><span class="line">allocate channel t1 type disk;  </span><br><span class="line">allocate channel t2 type disk;  </span><br><span class="line">allocate channel t3 type disk;  </span><br><span class="line">report obsolete;</span><br><span class="line">crosscheck backup;</span><br><span class="line">crosscheck archivelog all;</span><br><span class="line">delete noprompt obsolete;</span><br><span class="line">delete noprompt expired backup;</span><br><span class="line">delete noprompt expired archivelog all;</span><br><span class="line">release channel t1;  </span><br><span class="line">release channel t2;  </span><br><span class="line">release channel t3;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行任务脚本F:\scriptr\rman_backup_full.bat</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rman target  / log=&#x27;F:\backup\FTP-LOG\RMAN_BACKUP_%DATE:~0,4%%DATE:~5,2%%DATE:~8,2%&quot;.log&#x27; cmdfile=f:\script\Dbfull.rman</span><br></pre></td></tr></table></figure><p>FTP定时上传任务脚本F:\script\ftp.bat </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&quot;c:\Program Files (x86)\WinRAR\Rar.exe&quot; a -ep -df -m0 F:\backup\RMAN_%DATE:~0,4%%DATE:~5,2%%DATE:~8,2%.rar F:\backup\*.log  F:\backup\*.dbf</span><br><span class="line"></span><br><span class="line">set FILENAME=RMAN_%DATE:~0,4%%DATE:~5,2%%DATE:~8,2%.rar</span><br><span class="line"></span><br><span class="line">echo open 10.10.1.253 &gt;&gt;F:\script\ftp.txt</span><br><span class="line">echo ftpuser&gt;&gt;F:\script\ftp.txt</span><br><span class="line">echo Jiacheng2022&gt;&gt;F:\script\ftp.txt</span><br><span class="line">echo bin &gt;&gt;F:\script\ftp.txt</span><br><span class="line">echo prompt off &gt;&gt;F:\script\ftp.txt</span><br><span class="line">echo lcd f:\backup &gt;&gt;F:\script\ftp.txt</span><br><span class="line">echo mput %FILENAME% &gt;&gt;F:\script\ftp.txt</span><br><span class="line">echo prompt on  &gt;&gt;F:\script\ftp.txt</span><br><span class="line">echo bye  &gt;&gt;F:\script\ftp.txt</span><br><span class="line">echo quit &gt;&gt;F:\script\ftp.txt</span><br><span class="line"></span><br><span class="line">ftp -s:F:\script\ftp.txt &gt;F:\backup\FTP-LOG\ftp_%DATE:~0,4%%DATE:~5,2%%DATE:~8,2%.log 2&gt;F:\backup\FTP-LOG\err_%DATE:~0,4%%DATE:~5,2%%DATE:~8,2%.log</span><br><span class="line"></span><br><span class="line">del f:\script\ftp.txt</span><br></pre></td></tr></table></figure><p>保留15天备份脚本F:\script\clear15.bat </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">forfiles /p &quot;F:\backup&quot; /m *.rar /d -15 /c &quot;cmd /c del @path&quot;</span><br></pre></td></tr></table></figure><p>最后在windows上创建三个定时任务：</p><p>1、每天定时备份oracle脚本:\scriptr\rman_backup_full.bat</p><p>2、定时FTP上传脚本F:\script\ftp.bat  （与第一个任务时间错开）</p><p>3、定时清理空间F:\script\clear15.bat </p><p>最后就是告诉运维工程师，定期检查F:\BACKUP\FTP-LOG目录，看看有没有报错即可。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这个就是个纯简易方案，还是存在不少缺陷</p><p>1、没有任何的纠错机制，各个脚本之间独立运行，一步报错后面步步错。</p><p>2、任务之间的时间间隔要自己提前计算好</p><p>3、还需要运维工程师定期检查</p><p>当然，白嫖还想要啥，哈哈！对付能用就行。</p><p>欢迎联系我一起讨论。我的微信号：Eric_xu_2023</p><p>也欢迎关注我的公众号：</p><img alt="1.png" src="https://oss-emcsprod-public.modb.pro/image/editor/20251010-1976625582993584128_3605.png" referrerpolicy="no-referrer"/>]]></content>
      
      
      <categories>
          
          <category> oracle_backup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oracle </tag>
            
            <tag> database </tag>
            
            <tag> linux </tag>
            
            <tag> backup </tag>
            
            <tag> rman </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DBA必掌握的小技巧-分区满了如何处理2-迁移到新存储</title>
      <link href="/post/b6b44e86.html"/>
      <url>/post/b6b44e86.html</url>
      
        <content type="html"><![CDATA[<h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>话说上次DBA小倩通过删除home lv，把空间扩给了&#x2F;分区，问题暂时得到了解决。</p><p>没过几天，领导找到小倩下达任务，客户说数据库在本地磁盘空间太小了又快要满了，由于之前用的服务器本地磁盘，性能也比较差，现在不想扩展服务器本地硬盘了。正好这台服务器有HBA卡，客户从别的高端存储上划了个2TB的LUN过来，映射给这台数据库服务器，想让DBA小倩来做一下数据迁移，当然停机时间己经客户己经安排好了，就差小倩上线了。</p><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>正式停机之前还有一些准备工作要作，比如先把存储空间挂载到服务器上（后做也可以，用不了多久）。</p><p>检查一下当前磁盘空间情况，根目录满上要用光了。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@dbserver ~]# df -Th</span><br><span class="line">Filesystem              Type      Size  Used Avail Use% Mounted on</span><br><span class="line">devtmpfs                devtmpfs  1.9G     0  1.9G   0% /dev</span><br><span class="line">tmpfs                   tmpfs     1.9G  259M  1.6G  14% /dev/shm</span><br><span class="line">tmpfs                   tmpfs     1.9G   12M  1.9G   1% /run</span><br><span class="line">tmpfs                   tmpfs     1.9G     0  1.9G   0% /sys/fs/cgroup</span><br><span class="line">/dev/mapper/centos-root xfs       496G  493G  2.8G 100% /</span><br><span class="line">/dev/sda1               xfs      1014M  151M  864M  15% /boot</span><br><span class="line">tmpfs                   tmpfs     378M     0  378M   0% /run/user/0</span><br></pre></td></tr></table></figure><p>再看一下磁盘情况，目前只是识别到了一块磁盘</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@dbserver ~]# lsblk</span><br><span class="line">NAME            MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda               8:0    0   500G  0 disk </span><br><span class="line">├─sda1            8:1    0     1G  0 part /boot</span><br><span class="line">└─sda2            8:2    0   499G  0 part </span><br><span class="line">  ├─centos-root 253:0    0 495.1G  0 lvm  /</span><br><span class="line">  └─centos-swap 253:1    0   3.9G  0 lvm  [SWAP]</span><br><span class="line">sr0              11:0    1   4.4G  0 rom  </span><br></pre></td></tr></table></figure><p>下面说一下怎么识别磁盘，正常这个操作是需要客户的系统管理员来操作（非必要DBA不要操作）。我这里用虚拟机给大家演示，就直接简化操作了（<strong>实际生产环境有可能还需要配置ISCSI、多路径，比较复杂，一般有专人处理，这个放在后面单独一章简单给大家做个知识补充</strong>）</p><p><strong>我这里用虚拟机模拟，那么操作就是这样，扫描之后发现2T磁盘</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@dbserver scsi_host]# lsscsi</span><br><span class="line">[0:0:0:0]    disk    VMware,  VMware Virtual S 1.0   /dev/sda </span><br><span class="line">[2:0:0:0]    cd/dvd  NECVMWar VMware IDE CDR10 1.00  /dev/sr0 </span><br><span class="line">[root@dbserver scsi_host]# echo &quot;- - -&quot; &gt;/sys/class/scsi_host/host0/scan </span><br><span class="line">[root@dbserver scsi_host]# </span><br><span class="line">[root@dbserver scsi_host]# lsblk</span><br><span class="line">NAME            MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda               8:0    0   500G  0 disk </span><br><span class="line">├─sda1            8:1    0     1G  0 part /boot</span><br><span class="line">└─sda2            8:2    0   499G  0 part </span><br><span class="line">  ├─centos-root 253:0    0 495.1G  0 lvm  /</span><br><span class="line">  └─centos-swap 253:1    0   3.9G  0 lvm  [SWAP]</span><br><span class="line">sdb               8:16   0     2T  0 disk </span><br><span class="line">sr0              11:0    1   4.4G  0 rom  </span><br></pre></td></tr></table></figure><p>下面对2T磁盘进行分区，并标记为LVM格式（划分区再标记这是标准做法，这样避免以后被别人当成空盘，直接给用了。当然也可以直接pvcreate &#x2F;dev&#x2F;sdb，但是这样就没有标记了。）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@dbserver ~]# parted -s /dev/sdb mklabel gpt</span><br><span class="line">[root@dbserver ~]# parted -s /dev/sdb mkpart primary 2048s 100%</span><br><span class="line">[root@dbserver ~]# parted -s /dev/sdb toggle 1 lvm</span><br><span class="line"></span><br><span class="line">[root@dbserver ~]# fdisk -l /dev/sdb</span><br><span class="line">WARNING: fdisk GPT support is currently new, and therefore in an experimental phase. Use at your own discretion.</span><br><span class="line"></span><br><span class="line">Disk /dev/sdb: 2199.0 GB, 2199023255552 bytes, 4294967296 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk label type: gpt</span><br><span class="line">Disk identifier: 96DE5EB7-29A5-42AA-9651-03995AF95DEC</span><br><span class="line"></span><br><span class="line">#         Start          End    Size  Type            Name</span><br><span class="line"> 1         2048   4294965247      2T  Linux LVM       primary</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>下一步就是创建lvm，创建挂载点，挂载到操作系统上。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@dbserver ~]# pvcreate /dev/sdb1 </span><br><span class="line">  Physical volume &quot;/dev/sdb1&quot; successfully created.</span><br><span class="line">[root@dbserver ~]# vgcreate oradatavg /dev/sdb1 </span><br><span class="line">  Volume group &quot;oradatavg&quot; successfully created</span><br><span class="line">[root@dbserver ~]# lvcreate -l 100%FREE -n oralv oradatavg</span><br><span class="line">  Logical volume &quot;oralv&quot; created.</span><br><span class="line">[root@dbserver ~]# lvs</span><br><span class="line">  LV    VG        Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert</span><br><span class="line">  root  centos    -wi-ao---- 495.12g                                                    </span><br><span class="line">  swap  centos    -wi-ao----  &lt;3.88g                                                    </span><br><span class="line">  oralv oradatavg -wi-a-----  &lt;2.00t                                                    </span><br><span class="line">[root@dbserver ~]# vgs</span><br><span class="line">  VG        #PV #LV #SN Attr   VSize    VFree</span><br><span class="line">  centos      1   2   0 wz--n- &lt;499.00g    0 </span><br><span class="line">  oradatavg   1   1   0 wz--n-   &lt;2.00t    0 </span><br><span class="line">[root@dbserver ~]# mkfs.xfs /dev/mapper/oradatavg-oralv </span><br><span class="line">meta-data=/dev/mapper/oradatavg-oralv isize=512    agcount=4, agsize=134217472 blks</span><br><span class="line">         =                       sectsz=512   attr=2, projid32bit=1</span><br><span class="line">         =                       crc=1        finobt=0, sparse=0</span><br><span class="line">data     =                       bsize=4096   blocks=536869888, imaxpct=5</span><br><span class="line">         =                       sunit=0      swidth=0 blks</span><br><span class="line">naming   =version 2              bsize=4096   ascii-ci=0 ftype=1</span><br><span class="line">log      =internal log           bsize=4096   blocks=262143, version=2</span><br><span class="line">         =                       sectsz=512   sunit=0 blks, lazy-count=1</span><br><span class="line">realtime =none                   extsz=4096   blocks=0, rtextents=0</span><br></pre></td></tr></table></figure><h2 id="开始迁移"><a href="#开始迁移" class="headerlink" title="开始迁移"></a>开始迁移</h2><p>开始停机，先让客户结束业务办理，把应用系统都关了，然后建议是先把LOCAL&#x3D;NO进程全KILL，不然生产库一般很难正常shutdown immediate。操作步骤：先杀进程、关监听、关库、关EM</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">ps -ef |grep LOCAL=NO|grep -v grep|cut -c 9-15|xargs kill -9</span><br><span class="line">[oracle@dbserver ~]$ lsnrctl stop</span><br><span class="line"></span><br><span class="line">LSNRCTL for Linux: Version 11.2.0.4.0 - Production on 11-SEP-2024 23:07:17</span><br><span class="line"></span><br><span class="line">Copyright (c) 1991, 2013, Oracle.  All rights reserved.</span><br><span class="line"></span><br><span class="line">Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=IPC)(KEY=EXTPROC1521)))</span><br><span class="line">The command completed successfully</span><br><span class="line">[oracle@dbserver ~]$ sqlplus / as sysdba</span><br><span class="line"></span><br><span class="line">SQL*Plus: Release 11.2.0.4.0 Production on Wed Sep 11 23:07:00 2024</span><br><span class="line"></span><br><span class="line">Copyright (c) 1982, 2013, Oracle.  All rights reserved.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Connected to:</span><br><span class="line">Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit Production</span><br><span class="line">With the Partitioning, OLAP, Data Mining and Real Application Testing options</span><br><span class="line"></span><br><span class="line">SQL&gt; shutdown immediate;</span><br><span class="line">Database closed.</span><br><span class="line">Database dismounted.</span><br><span class="line">ORACLE instance shut down.</span><br><span class="line">SQL&gt; exit</span><br><span class="line">Disconnected from Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit Production</span><br><span class="line">With the Partitioning, OLAP, Data Mining and Real Application Testing options</span><br><span class="line"></span><br><span class="line">[oracle@dbserver ~]$ emctl stop dbconsole</span><br><span class="line">OC4J Configuration issue. /u01/app/oracle/product/11.2.0/dbhome_1/oc4j/j2ee/OC4J_DBConsole_dbserver_oracle not found.</span><br></pre></td></tr></table></figure><p>操作步骤是这样：</p><p>1、先重命名&#x2F;u01目录为&#x2F;u01.old</p><p>2、创建新的&#x2F;u01目录，然后挂载&#x2F;dev&#x2F;mapper&#x2F;oradatavg-oralv到&#x2F;u01</p><p>3、给&#x2F;u01目录赋予oracle:oinstall权限</p><p>4、使用rsync迁移&#x2F;u01.old目录里的文件到&#x2F;u01目录下（这里写成脚本用nohup运行，防止终端断开），这里注意rsync源目录后面要带&#x2F;，就是比如这样&#x2F;u01.old&#x2F;</p><p>5、启动数据库恢复业务</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@dbserver ~]#cd /</span><br><span class="line">[root@dbserver /]#mv /u01 /u01.old</span><br><span class="line">[root@dbserver /]# mkdir -p /u01</span><br><span class="line">[root@dbserver /]# echo &quot;/dev/mapper/oradatavg-oralv /u01 xfs defaults 0 0&quot; &gt;&gt; /etc/fstab </span><br><span class="line">[root@dbserver /]# mount -a</span><br><span class="line">[root@dbserver /]# df -h</span><br><span class="line">Filesystem                   Size  Used Avail Use% Mounted on</span><br><span class="line">devtmpfs                     1.9G     0  1.9G   0% /dev</span><br><span class="line">tmpfs                        1.9G     0  1.9G   0% /dev/shm</span><br><span class="line">tmpfs                        1.9G   12M  1.9G   1% /run</span><br><span class="line">tmpfs                        1.9G     0  1.9G   0% /sys/fs/cgroup</span><br><span class="line">/dev/mapper/centos-root      496G  493G  2.8G 100% /</span><br><span class="line">/dev/sda1                   1014M  151M  864M  15% /boot</span><br><span class="line">tmpfs                        378M     0  378M   0% /run/user/0</span><br><span class="line">/dev/mapper/oradatavg-oralv  2.0T   33M  2.0T   1% /u01</span><br><span class="line">[root@dbserver /]# chown  oracle:oinstall /u01</span><br><span class="line">[root@dbserver /]# echo &quot;/usr/bin/rsync -av /u01.old/ /u01&quot; &gt;rsync.sh</span><br><span class="line">[root@dbserver /]# chmod +x rsync.sh </span><br><span class="line">[root@dbserver /]# nohup ./rsync.sh &amp;</span><br><span class="line">#如果需要查看同步情况,最后显示完成</span><br><span class="line">[root@dbserver /]# tail -f nohup.out </span><br><span class="line">app/oracle/product/11.2.0/dbhome_1/xdk/mesg/</span><br><span class="line">app/oracle/product/11.2.0/dbhome_1/xdk/mesg/lpxus.msb</span><br><span class="line">app/oracle/product/11.2.0/dbhome_1/xdk/mesg/lpxus.msg</span><br><span class="line">app/oracle/product/11.2.0/dbhome_1/xdk/mesg/lpxzhs.msb</span><br><span class="line">app/oracle/product/11.2.0/dbhome_1/xdk/mesg/lsxus.msb</span><br><span class="line">app/oracle/product/11.2.0/dbhome_1/xdk/mesg/lsxus.msg</span><br><span class="line">app/oracle/product/11.2.0/dbhome_1/xdk/mesg/lsxzhs.msb</span><br><span class="line"></span><br><span class="line">sent 6,049,894,594 bytes  received 709,411 bytes  145,797,686.87 bytes/sec</span><br><span class="line">total size is 6,046,010,967  speedup is 1.00</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>最后启动数据库，成功运行后，确认无错误，就可以把&#x2F;u01.old目录删除释放空间了。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">[oracle@dbserver ~]$ lsnrctl start</span><br><span class="line"></span><br><span class="line">LSNRCTL for Linux: Version 11.2.0.4.0 - Production on 11-SEP-2024 23:29:57</span><br><span class="line"></span><br><span class="line">Copyright (c) 1991, 2013, Oracle.  All rights reserved.</span><br><span class="line"></span><br><span class="line">Starting /u01/app/oracle/product/11.2.0/dbhome_1/bin/tnslsnr: please wait...</span><br><span class="line"></span><br><span class="line">TNSLSNR for Linux: Version 11.2.0.4.0 - Production</span><br><span class="line">System parameter file is /u01/app/oracle/product/11.2.0/dbhome_1/network/admin/listener.ora</span><br><span class="line">Log messages written to /u01/app/oracle/diag/tnslsnr/dbserver/listener/alert/log.xml</span><br><span class="line">Listening on: (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC1521)))</span><br><span class="line">Listening on: (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=dbserver)(PORT=1521)))</span><br><span class="line"></span><br><span class="line">Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=IPC)(KEY=EXTPROC1521)))</span><br><span class="line">STATUS of the LISTENER</span><br><span class="line">------------------------</span><br><span class="line">Alias                     LISTENER</span><br><span class="line">Version                   TNSLSNR for Linux: Version 11.2.0.4.0 - Production</span><br><span class="line">Start Date                11-SEP-2024 23:29:57</span><br><span class="line">Uptime                    0 days 0 hr. 0 min. 0 sec</span><br><span class="line">Trace Level               off</span><br><span class="line">Security                  ON: Local OS Authentication</span><br><span class="line">SNMP                      OFF</span><br><span class="line">Listener Parameter File   /u01/app/oracle/product/11.2.0/dbhome_1/network/admin/listener.ora</span><br><span class="line">Listener Log File         /u01/app/oracle/diag/tnslsnr/dbserver/listener/alert/log.xml</span><br><span class="line">Listening Endpoints Summary...</span><br><span class="line">  (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC1521)))</span><br><span class="line">  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=dbserver)(PORT=1521)))</span><br><span class="line">The listener supports no services</span><br><span class="line">The command completed successfully</span><br><span class="line">[oracle@dbserver ~]$ sqlplus / as sysdba</span><br><span class="line"></span><br><span class="line">SQL*Plus: Release 11.2.0.4.0 Production on Wed Sep 11 23:30:03 2024</span><br><span class="line"></span><br><span class="line">Copyright (c) 1982, 2013, Oracle.  All rights reserved.</span><br><span class="line"></span><br><span class="line">Connected to an idle instance.</span><br><span class="line"></span><br><span class="line">SQL&gt; startup;</span><br><span class="line">ORACLE instance started.</span><br><span class="line"></span><br><span class="line">Total System Global Area 1586708480 bytes</span><br><span class="line">Fixed Size    2253624 bytes</span><br><span class="line">Variable Size  989859016 bytes</span><br><span class="line">Database Buffers  587202560 bytes</span><br><span class="line">Redo Buffers    7393280 bytes</span><br><span class="line">Database mounted.</span><br><span class="line">Database opened.</span><br><span class="line">SQL&gt; exit</span><br></pre></td></tr></table></figure><h2 id="扩展知识"><a href="#扩展知识" class="headerlink" title="扩展知识"></a>扩展知识</h2><p>1、如果生产服务器用的是hba卡的话一般都2块卡，需要重新扫描一下hba卡就可以发现新硬盘了，我给大家看一下我这有一个生产环境样例是这样：主机有2块HBA卡为host1、host2。host0是本地的硬盘控制器。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@rac1]# cd /sys/class/fc_host/</span><br><span class="line">[root@rac1 fc_host]# ls -l</span><br><span class="line">total 0</span><br><span class="line">lrwxrwxrwx 1 root root 0 Aug  6 03:02 host1 -&gt; ../../devices/pci0000:00/0000:00:03.0/0000:04:00.0/host1/fc_host/host1</span><br><span class="line">lrwxrwxrwx 1 root root 0 Aug  6 03:02 host2 -&gt; ../../devices/pci0000:40/0000:40:02.2/0000:47:00.0/host2/fc_host/host2</span><br><span class="line">[root@rac1 fc_host]# cd /sys/class/scsi_host/</span><br><span class="line">[root@rac1 scsi_host]# ls -l</span><br><span class="line">total 0</span><br><span class="line">lrwxrwxrwx 1 root root 0 Aug  6 03:02 host0 -&gt; ../../devices/pci0000:00/0000:00:02.0/0000:02:00.0/host0/scsi_host/host0</span><br><span class="line">lrwxrwxrwx 1 root root 0 Aug  6 03:02 host1 -&gt; ../../devices/pci0000:00/0000:00:03.0/0000:04:00.0/host1/scsi_host/host1</span><br><span class="line">lrwxrwxrwx 1 root root 0 Aug  6 03:02 host2 -&gt; ../../devices/pci0000:40/0000:40:02.2/0000:47:00.0/host2/scsi_host/host2</span><br><span class="line">[root@rac1 scsi_host]# lsscsi</span><br><span class="line">[0:0:0:0]    disk    HP       LOGICAL VOLUME   4.04  /dev/sda </span><br><span class="line">[0:3:0:0]    storage HP       P830i            4.04  -       </span><br><span class="line">[1:0:0:0]    disk    3PARdata VV               3315  /dev/sdb </span><br><span class="line">[1:0:0:1]    disk    3PARdata VV               3315  /dev/sdc </span><br><span class="line">[1:0:0:2]    disk    3PARdata VV               3315  /dev/sdd </span><br><span class="line">[1:0:0:3]    disk    3PARdata VV               3315  /dev/sde </span><br><span class="line">[1:0:0:4]    disk    3PARdata VV               3315  /dev/sdf </span><br><span class="line">[1:0:0:254]  enclosu 3PARdata SES              3315  -       </span><br><span class="line">[1:0:1:0]    disk    3PARdata VV               3315  /dev/sdg </span><br><span class="line">[1:0:1:1]    disk    3PARdata VV               3315  /dev/sdh </span><br><span class="line">[1:0:1:3]    disk    3PARdata VV               3315  /dev/sdi </span><br><span class="line">[1:0:1:4]    disk    3PARdata VV               3315  /dev/sdj </span><br><span class="line">[1:0:1:5]    disk    3PARdata VV               3315  /dev/sdk </span><br><span class="line">[1:0:1:254]  enclosu 3PARdata SES              3315  -       </span><br><span class="line">[2:0:0:0]    disk    3PARdata VV               3315  /dev/sdl </span><br><span class="line">[2:0:0:1]    disk    3PARdata VV               3315  /dev/sdm </span><br><span class="line">[2:0:0:3]    disk    3PARdata VV               3315  /dev/sdn </span><br><span class="line">[2:0:0:4]    disk    3PARdata VV               3315  /dev/sdo </span><br><span class="line">[2:0:0:5]    disk    3PARdata VV               3315  /dev/sdp </span><br><span class="line">[2:0:0:254]  enclosu 3PARdata SES              3315  -       </span><br><span class="line">[root@rac1 scsi_host]# </span><br></pre></td></tr></table></figure><p>那么需要进行的操作就是扫描两块HBA卡。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;- - -&quot; &gt;/sys/class/scsi_host/host1/scan</span><br><span class="line">echo &quot;- - -&quot; &gt;/sys/class/scsi_host/host2/scan</span><br></pre></td></tr></table></figure><p>2、如果是用万兆ISCSI连接的存储，那么就需要配置ISCSI，主机需要安装iscsi-initiator。生产一般会接2个网卡做为冗余，假设主机这边对接ISCSI存储的IP是192.168.1.2，存储侧是192.168.1.101、192.168.1.102</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">iscsiadm -m discovery -t st -p 192.168.1.101</span><br><span class="line">iscsiadm -m node -p 192.168.1.101 -l</span><br><span class="line">iscsiadm -m discovery -t st -p 192.168.1.102</span><br><span class="line">iscsiadm -m node -p 192.168.1.102 -l</span><br><span class="line">systemctl enable iscsi.service</span><br><span class="line">iscsiadm -m node -o update -n node.startup -v automatic</span><br></pre></td></tr></table></figure><p>3、上面无论是FC-HBA或是ISCSI连接完存储后，剩下需要做的就是配置多路径multipath或者直接安装存储厂商的多路径软件（如果客户现场没有多个存储要同时用的话，推荐使用存储厂商的多路径软件，这样几乎不用啥配置），此处略长，大家要有兴趣我回头再写一篇。</p><h2 id="未完待续"><a href="#未完待续" class="headerlink" title="未完待续"></a>未完待续</h2><p>解决了这个问题，又来了一个棘手的活， 这回客户也是数据库装在根目录，然后根目录总满了，目前是一直手动清日志保证业务能用。但不一样的是，这次客户用的是虚拟机系统，而且虚拟机没用LVM装的系统，客户系统又不能停机，看看下期DBA小倩如何处理。</p><p>欢迎联系我一起讨论。我的微信号：Eric_xu_2023</p><p>也欢迎关注我的公众号：</p><img alt="1.png" src="https://oss-emcsprod-public.modb.pro/image/editor/20251010-1976625582993584128_3605.png" referrerpolicy="no-referrer"/>]]></content>
      
      
      <categories>
          
          <category> 操作系统_linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oracle </tag>
            
            <tag> linux </tag>
            
            <tag> dba </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DBA必掌握的小技巧-分区满了如何处理1-删除home扩容根分区</title>
      <link href="/post/b6e27480.html"/>
      <url>/post/b6e27480.html</url>
      
        <content type="html"><![CDATA[<h2 id="故障发生了！"><a href="#故障发生了！" class="headerlink" title="故障发生了！"></a>故障发生了！</h2><p>今天DBA小倩接到一个客户紧急任务，客户说自己的业务数据库突然不好使了，连接也出现了问题，开发人员连库就报这个错</p><p>小倩要来了系统的登录用户名密码，登录到了数据库服务器一看</p><p>好家伙！根目录满了。</p><p>仔细检查发现，之前软件实施的人员把数据库直接装到了根目录下，最后导致根目录空间耗尽，数据库无法写入审计文件，无法登录了。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@dbserver /]# df -Th</span><br><span class="line">Filesystem              Type      Size  Used Avail Use% Mounted on</span><br><span class="line">devtmpfs                devtmpfs  1.9G     0  1.9G   0% /dev</span><br><span class="line">tmpfs                   tmpfs     1.9G     0  1.9G   0% /dev/shm</span><br><span class="line">tmpfs                   tmpfs     1.9G   12M  1.9G   1% /run</span><br><span class="line">tmpfs                   tmpfs     1.9G     0  1.9G   0% /sys/fs/cgroup</span><br><span class="line">/dev/mapper/centos-root xfs        50G   50G   33M 100% /</span><br><span class="line">/dev/mapper/centos-home xfs       445G   33M  445G   1% /home</span><br><span class="line">/dev/sda1               xfs      1014M  151M  864M  15% /boot</span><br><span class="line">tmpfs                   tmpfs     378M     0  378M   0% /run/user/0</span><br><span class="line">[root@dbserver /]# ls </span><br><span class="line">bin  boot  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  u01  usr  var</span><br></pre></td></tr></table></figure><p>根分区是没地方了，可是&#x2F;home分区却几乎没用。</p><p>这就是之前的集成实施人员和软件实施人员没有对接好，两个人都是二把刀，导致这么个结果。</p><h2 id="此时如何快速恢复业务呢？"><a href="#此时如何快速恢复业务呢？" class="headerlink" title="此时如何快速恢复业务呢？"></a>此时如何快速恢复业务呢？</h2><p>经过检查&#x2F;home分区下只有用户的默认文件夹，并无其它生产数据，与客户沟通后，小倩建议把&#x2F;home分区删除，扩容到根分区里，快速恢复业务。</p><p>说干就干，首先，先去$ORACLE_BASE目录下释放一点文件，比如下面这些，都可以删除</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/u01/app/oracle/diag/rdbms/orcl/orcl/alert   目录下的log_*.xml文件</span><br><span class="line">/u01/app/oracle/diag/rdbms/orcl/orcl/trace   目录下的日志文件，alert_orcl.log如果不是很大，不建议删除。</span><br></pre></td></tr></table></figure><p>备份一下home下的文件，检查了只有oracle目录。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@dbserver home]# ls -al</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x.  3 root   root  20 Sep  7 21:59 .</span><br><span class="line">dr-xr-xr-x. 18 root   root 255 Sep  7 22:00 ..</span><br><span class="line">drwx------   2 oracle dba   62 Sep  7 21:59 oracle</span><br></pre></td></tr></table></figure><p>这里我们用cp 直接复制&#x2F;home目录下的文件到&#x2F;root目录下。r表示目录下所有子目录也复制，p表进带权限复制。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /home/</span><br><span class="line">cp * -rp /root/</span><br><span class="line">cd ~</span><br></pre></td></tr></table></figure><p>下一步，我们要卸载&#x2F;home分区，把&#x2F;home分区对应的lv删除。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@dbserver ~]# umount  /home/</span><br><span class="line">[root@dbserver ~]# lvremove /dev/centos/home </span><br><span class="line">Do you really want to remove active logical volume centos/home? [y/n]: y</span><br><span class="line">  Logical volume &quot;home&quot; successfully removed</span><br></pre></td></tr></table></figure><p>查看VG有空闲空间，这里我们再把剩余的空间扩容到根分区所属于的名为root的lv里。扩容lv后，在线直接扩容设备&#x2F;dev&#x2F;mapper&#x2F;centos-root对应的根文件系统。扩容成功后根分区空间立即够用了，业务立马恢复。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@dbserver ~]# vgs</span><br><span class="line">  VG     #PV #LV #SN Attr   VSize    VFree  </span><br><span class="line">  centos   1   2   0 wz--n- &lt;499.00g 445.12g</span><br><span class="line">[root@dbserver ~]# lvresize -l +100%FREE /dev/centos/root </span><br><span class="line">  Size of logical volume centos/root changed from 50.00 GiB (12800 extents) to 495.12 GiB (126751 extents).</span><br><span class="line">  Logical volume centos/root successfully resized.</span><br><span class="line">[root@dbserver ~]# lvs</span><br><span class="line">  LV   VG     Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert</span><br><span class="line">  root centos -wi-ao---- 495.12g                                                    </span><br><span class="line">  swap centos -wi-ao----  &lt;3.88g </span><br><span class="line">[root@dbserver]# xfs_growfs /dev/mapper/centos-root </span><br><span class="line">meta-data=/dev/mapper/centos-root isize=512    agcount=4, agsize=3276800 blks</span><br><span class="line">         =                       sectsz=512   attr=2, projid32bit=1</span><br><span class="line">         =                       crc=1        finobt=0 spinodes=0</span><br><span class="line">data     =                       bsize=4096   blocks=13107200, imaxpct=25</span><br><span class="line">         =                       sunit=0      swidth=0 blks</span><br><span class="line">naming   =version 2              bsize=4096   ascii-ci=0 ftype=1</span><br><span class="line">log      =internal               bsize=4096   blocks=6400, version=2</span><br><span class="line">         =                       sectsz=512   sunit=0 blks, lazy-count=1</span><br><span class="line">realtime =none                   extsz=4096   blocks=0, rtextents=0</span><br><span class="line">data blocks changed from 13107200 to 129793024</span><br><span class="line">[root@dbserver]# df -h</span><br><span class="line">Filesystem               Size  Used Avail Use% Mounted on</span><br><span class="line">devtmpfs                 1.9G     0  1.9G   0% /dev</span><br><span class="line">tmpfs                    1.9G     0  1.9G   0% /dev/shm</span><br><span class="line">tmpfs                    1.9G   12M  1.9G   1% /run</span><br><span class="line">tmpfs                    1.9G     0  1.9G   0% /sys/fs/cgroup</span><br><span class="line">/dev/mapper/centos-root  496G   50G  446G  11% /</span><br><span class="line">/dev/sda1               1014M  151M  864M  15% /boot</span><br><span class="line">tmpfs                    378M     0  378M   0% /run/user/0</span><br></pre></td></tr></table></figure><p>最后别忘记了把备份走文件恢复到&#x2F;home目录下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@dbserver ~]# cp -rp oracle/ /home/</span><br></pre></td></tr></table></figure><h2 id="完美收工了？"><a href="#完美收工了？" class="headerlink" title="完美收工了？"></a>完美收工了？</h2><p>你以为这样就完了么？</p><p>没过1天，领导又找到了小倩，说数据库在本地磁盘空间太小了，性能也不能，我们又搞了个磁盘阵列，想把数据库整体迁移到存储上。</p><p>下一期我们一起来看看小倩同学怎么操作。</p><p>欢迎联系我一起讨论。我的微信号：Eric_xu_2023</p><p>也欢迎关注我的公众号：</p><img alt="1.png" src="https://oss-emcsprod-public.modb.pro/image/editor/20251010-1976625582993584128_3605.png" referrerpolicy="no-referrer"/>]]></content>
      
      
      <categories>
          
          <category> 操作系统_linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oracle </tag>
            
            <tag> linux </tag>
            
            <tag> dba </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>记一次NetApp FAS2554更换故障硬盘</title>
      <link href="/post/baf45ed4.html"/>
      <url>/post/baf45ed4.html</url>
      
        <content type="html"><![CDATA[<h2 id="案例背景"><a href="#案例背景" class="headerlink" title="案例背景"></a>案例背景</h2><p>记一次某医院PACS存储NetApp FAS2554更换故障硬盘的过程。</p><p>这个netapp设备以前从未调试过，据客户说该设备上线也有快9年了，头一次故障硬盘。因为己经过保了，客户只是采购的硬盘，我这来免费服务了。。。</p><p>netapp调试基本全靠命令行，更换的过程中也遇到了一些麻烦，特此记录一下。</p><p>设备大概长这个样子（网上图片，现场没拍）</p><img alt="1.png" src="https://i-blog.csdnimg.cn/blog_migrate/da2804f19df5d557488f51d4aa6ba583.png" referrerpolicy="no-referrer"/><h2 id="更换过程"><a href="#更换过程" class="headerlink" title="更换过程"></a>更换过程</h2><p>替换前，0a.00.2磁盘己经由热备盘替换，RAID-DP状态为normal,active</p><p>直接拔下该位置故障磁盘，替换为新的磁盘</p><p>检查磁盘状态</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">FAS2240-A&gt; sysconfig -r          </span><br><span class="line">Aggregate aggr0 (online, raid_dp) (block checksums)</span><br><span class="line">  Plex /aggr0/plex0 (online, normal, active, pool0)</span><br><span class="line">    RAID group /aggr0/plex0/rg0 (normal, block checksums)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      RAID DiskDevice  HA  SHELF BAY CHAN Pool Type  RPM  Used (MB/blks)    Phys (MB/blks)</span><br><span class="line">      ---------------  ------------- ---- ---- ---- ----- --------------    --------------</span><br><span class="line">      dparity 0a.00.0 0a    0   0   SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line">      parity  0a.00.110a    0   11  SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line">      data    0a.00.4 0a    0   4   SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line">      data    0a.00.6 0a    0   6   SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line">      data    0a.00.7 0a    0   7   SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line">      data    0a.00.8 0a    0   8   SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line">      data    0a.00.9 0a    0   9   SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line">      data    0a.00.100a    0   10  SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line">      data    0a.00.1 0a    0   1   SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line"></span><br><span class="line">Pool1 spare disks (empty)</span><br><span class="line">Pool0 spare disks (empty)</span><br><span class="line">Partner disks</span><br><span class="line">RAID DiskDevice  HA  SHELF BAY CHAN Pool Type  RPM  Used (MB/blks)    Phys (MB/blks)</span><br><span class="line">---------------  ------------- ---- ---- ---- ----- --------------    --------------</span><br><span class="line">partner 0a.00.5 0a    0   5   SA:A   0  BSAS  7200 0/0               1695759/3472914816 </span><br><span class="line">partner 0a.00.3 0a    0   3   SA:A   0  BSAS  7200 0/0               1695759/3472914816</span><br></pre></td></tr></table></figure><p>检查所有磁盘，发现磁盘0a.00.2识别到</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">FAS2240-A&gt; disk show -v  </span><br><span class="line">  DISK       OWNER                  POOL   SERIAL NUMBER           HOME                     CHKSUM</span><br><span class="line">------------ -------------          -----  -------------           -------------            ------</span><br><span class="line">0a.00.0      FAS2240-A (1897445747)    Pool0  WD-WCAY01059319       FAS2240-A (1897445747)  Block</span><br><span class="line">0a.00.9      FAS2240-A (1897445747)    Pool0  WD-WCAY01110442       FAS2240-A (1897445747)  Block</span><br><span class="line">0a.00.11     FAS2240-A (1897445747)    Pool0  WD-WCAY01118699       FAS2240-A (1897445747)  Block</span><br><span class="line">0a.00.3      FAS2240-B (1897447544)    Pool0  WD-WCAY01148720       FAS2240-B (1897447544)  Block</span><br><span class="line">0a.00.5      FAS2240-B (1897447544)    Pool0  WD-WCAY01110637       FAS2240-B (1897447544)  Block</span><br><span class="line">0a.00.6      FAS2240-A (1897445747)    Pool0  WD-WCAY01138268       FAS2240-A (1897445747)  Block</span><br><span class="line">0a.00.8      FAS2240-A (1897445747)    Pool0  WD-WCAY01140234       FAS2240-A (1897445747)  Block</span><br><span class="line">0a.00.7      FAS2240-A (1897445747)    Pool0  WD-WCAY01148812       FAS2240-A (1897445747)  Block</span><br><span class="line">0a.00.10     FAS2240-A (1897445747)    Pool0  WD-WCAY01059555       FAS2240-A (1897445747)  Block</span><br><span class="line">0a.00.2      FAS3250-B (2017886517)    Pool0  YGHNUAWA              FAS3250-B (2017886517)  Block</span><br><span class="line">0a.00.1      FAS2240-A (1897445747)    Pool0  WD-WCAY01110728       FAS2240-A (1897445747)  Block</span><br><span class="line">0a.00.4      FAS2240-A (1897445747)    Pool0  WD-WCAY01140030       FAS2240-A (1897445747)  Block</span><br></pre></td></tr></table></figure><p>0a.00.2为后替换的磁盘，默认分配到FAS3250-B，而B控制器目前只存储系统RAID4，使用磁盘0a.00.5，0a.00.3。B控无法使用0a.00.2，需要切换该磁盘到A控制器。</p><p>进入到维护模式</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FAS2240-A&gt; priv set diag </span><br><span class="line">Warning: These diagnostic commands are for use by NetApp</span><br><span class="line">         personnel only.</span><br></pre></td></tr></table></figure><p>查看disk 命令提示</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">FAS2240-A*&gt; disk</span><br><span class="line">usage: disk &lt;options&gt;</span><br><span class="line">Options are:</span><br><span class="line">assign &#123;&lt;disk_name&gt; | all | [-T &lt;storage type&gt; | -shelf &lt;shelf name&gt;] [-n &lt;count&gt;] | auto&#125; [-p &lt;pool&gt;] [-o &lt;ownername&gt;] [-s &lt;sysid&gt;] [-c block|zoned] [-f] - assign a disk to a filer or all unowned disks by specifying &quot;all&quot;  or &lt;count&gt; number of unowned disks</span><br><span class="line">ddr_label &#123;repair | print | delete | dumpraw | modify [-c] -o &lt;offset&gt; -v &lt;value&gt; | start_scan | pause_scan | resume_scan | error_scan | rediscover | reinit &#125; [-f] [-d all | &lt;disk_list&gt;]</span><br><span class="line">encrypt &#123; lock | rekey | destroy | sanitize | show &#125; - perform tasks specific to self-encrypting disks</span><br><span class="line">fail [-i] [-f] &lt;disk_name&gt;  - fail a file system disk</span><br><span class="line">maint &#123; start | abort | status | list&#125; - run maintenance tests on one or more disks</span><br><span class="line">power_cycle [ -f ] &#123; [-d &lt;disk_list&gt;] | [ -c &lt;channel_name&gt; [ -s &lt;shelf_number&gt; ] ] &#125; - power-cycle one or more disks</span><br><span class="line">reassign &#123;-o &lt;old_name&gt; | -s &lt;old_sysid&gt;&#125; [-n &lt;new_name&gt;] [-d &lt;new_sysid&gt;] - reassign disks from old filer</span><br><span class="line">remove [-w] &lt;disk_name&gt;     - remove a spare disk</span><br><span class="line">remove_ownership [&lt;disk_name&gt; | all | -s &lt;sysid&gt;] [-f] - revert/remove disk ownership</span><br><span class="line">replace &#123;start [-f] [-m] &lt;disk_name&gt; &lt;spare_disk_name&gt;&#125; | &#123;stop &lt;disk_name&gt;&#125; - replace a file system disk with a spare disk or stop replacing</span><br><span class="line">sanitize &#123; start | abort | status | release &#125; - sanitize one or more disks</span><br><span class="line">sanown_stats &#123;start| stop| show &#125;- collect sanown event stats</span><br><span class="line">scrub  &#123; start | stop &#125;     - start or stop disk scrubbing</span><br><span class="line">shm_stats [&lt;disk_name&gt; | asup | clear_errors]     - Storage Health Monitor statistics for a disk</span><br><span class="line">show [-o &lt;ownername&gt; | -s &lt;sysid&gt; | -n | -v | -a]  - lists disks and owners</span><br><span class="line">simpull &lt;disk_name1&gt; [&lt;disk_name2&gt; [&lt;disk_name3&gt; ... ]]  - simulate one or more disk pulls</span><br><span class="line">simpush [&lt;sim_disk_path_name1&gt; [&lt;sim_disk_path_name2&gt; [&lt;sim_disk_path_name3&gt; ...]] | -l] - simulate one or more disk pushes or list available disks to push</span><br><span class="line">unfail [-s] &lt;disk_name&gt;     - unfail a disk  (-s  not valid in maintenance mode)</span><br><span class="line">zero spares                 - Zero all spare disks</span><br></pre></td></tr></table></figure><p>记划从控制器中删除该磁盘，失败</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">FAS2240-A*&gt; disk remove_ownership 0a.00.2 </span><br><span class="line">disk remove_ownership: Disk 0a.00.2 is not owned by this node.</span><br><span class="line">FAS2240-A*&gt; disk remove_ownership 0a.00.2 -f</span><br><span class="line">disk remove_ownership: Disk 0a.00.2 is not owned by this node.</span><br><span class="line"></span><br><span class="line">FAS2240-A*&gt; sysconfig        </span><br><span class="line">NetApp Release 8.1.3 7-Mode: Sat Jun  8 08:11:51 PDT 2013</span><br><span class="line">System ID: 1897445747 (FAS2240-A); partner ID: 1897447544 (FAS2240-B)</span><br><span class="line">System Serial Number: 700001384306 (FAS2240-A)</span><br><span class="line">System Rev: D1</span><br><span class="line">System Storage Configuration: Single-Path HA</span><br><span class="line">System ACP Connectivity: Partial Connectivity</span><br><span class="line">slot 0: System Board</span><br><span class="line">                Processors:         4</span><br><span class="line">                Processor type:     Intel(R) Xeon(R) CPU           C3528  @ 1.73GHz</span><br><span class="line">                Memory Size:        6144 MB</span><br><span class="line">                Memory Attributes:  Hoisting</span><br><span class="line">                                    Normal ECC</span><br><span class="line">                Controller:         A</span><br><span class="line">Service Processor           Status: Online</span><br><span class="line">slot 0: Internal 10/100 Ethernet Controller</span><br><span class="line">e0M MAC Address:    00:a0:98:3f:8b:05 (auto-100tx-fd-up)</span><br><span class="line">e0P MAC Address:    00:a0:98:3f:8b:04 (auto-100tx-fd-up)</span><br><span class="line">slot 0: Quad Gigabit Ethernet Controller 82580</span><br><span class="line">e0a MAC Address:    00:a0:98:3f:8b:00 (auto-100tx-fd-up)</span><br><span class="line">e0b MAC Address:    00:a0:98:3f:8b:01 (auto-1000t-fd-down)</span><br><span class="line">e0c MAC Address:    00:a0:98:3f:8b:02 (auto-1000t-fd-down)</span><br><span class="line">e0d MAC Address:    00:a0:98:3f:8b:03 (auto-1000t-fd-down)</span><br><span class="line">slot 0: Interconnect HBA:   Mellanox IB MT25204</span><br><span class="line">slot 0: SAS Host Adapter 0a </span><br><span class="line">                12 Disks:            20345.5GB</span><br><span class="line">1 shelf with IOM6E</span><br><span class="line">slot 0: SAS Host Adapter 0b </span><br><span class="line">slot 0: Intel ICH USB EHCI Adapter u0a (0xdf101000)</span><br><span class="line">boot0Micron Technology Real SSD eUSB 2GB, class 0/0, rev 2.00/11.10, addr 2 1936MB 512B/sect (B9F0022700107745)</span><br><span class="line">        slot 1: Fibre Channel Target Host Adapter 1a</span><br><span class="line">        slot 1: Fibre Channel Target Host Adapter 1b</span><br></pre></td></tr></table></figure><p>直接接使用命令在A控上分配该磁盘失败</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FAS2240-A*&gt; disk assign 0a.00.2</span><br><span class="line">disk assign: Assign failed for one or more disks in the disk list.</span><br></pre></td></tr></table></figure><p>使用强制-f参数，分配成功</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">FAS2240-A*&gt; disk assign 0a.00.2 -f</span><br><span class="line">FAS2240-A*&gt; Sun Oct 20 20:10:18 CST [FAS2240-A:raid.assim.disk.nolabels:error]: Disk 0a.00.2 Shelf 0 Bay 2 [NETAPP   X306_HMARK02TSSA 4321] S/N [YGHNUAWA] has no valid labels. It will be taken out of service to prevent possible data loss.  </span><br><span class="line">Sun Oct 20 20:10:18 CST [FAS2240-A:raid.config.disk.bad.label:error]: Disk 0a.00.2 Shelf 0 Bay 2 [NETAPP   X306_HMARK02TSSA 4321] S/N [YGHNUAWA] has bad label.  </span><br><span class="line">Sun Oct 20 20:10:18 CST [FAS2240-A:callhome.dsk.label:CRITICAL]: Call home for DISK BAD LABEL</span><br></pre></td></tr></table></figure><p>分配成功后，该盘标记为坏盘</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">FAS2240-A*&gt; sysconfig -r</span><br><span class="line">Aggregate aggr0 (online, raid_dp) (block checksums)</span><br><span class="line">  Plex /aggr0/plex0 (online, normal, active, pool0)</span><br><span class="line">    RAID group /aggr0/plex0/rg0 (normal, block checksums)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      RAID DiskDevice  HA  SHELF BAY CHAN Pool Type  RPM  Used (MB/blks)    Phys (MB/blks)</span><br><span class="line">      ---------------  ------------- ---- ---- ---- ----- --------------    --------------</span><br><span class="line">      dparity 0a.00.0 0a    0   0   SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line">      parity  0a.00.110a    0   11  SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line">      data    0a.00.4 0a    0   4   SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line">      data    0a.00.6 0a    0   6   SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line">      data    0a.00.7 0a    0   7   SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line">      data    0a.00.8 0a    0   8   SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line">      data    0a.00.9 0a    0   9   SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line">      data    0a.00.100a    0   10  SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line">      data    0a.00.1 0a    0   1   SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line"></span><br><span class="line">Pool1 spare disks (empty)</span><br><span class="line">Pool0 spare disks (empty)</span><br><span class="line">Broken disks</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RAID DiskDevice  HA  SHELF BAY CHAN Pool Type  RPM  Used (MB/blks)    Phys (MB/blks)</span><br><span class="line">---------------  ------------- ---- ---- ---- ----- --------------    --------------</span><br><span class="line">bad label0a.00.2 0a    0   2   SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Partner disks</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RAID DiskDevice  HA  SHELF BAY CHAN Pool Type  RPM  Used (MB/blks)    Phys (MB/blks)</span><br><span class="line">---------------  ------------- ---- ---- ---- ----- --------------    --------------</span><br><span class="line">partner 0a.00.5 0a    0   5   SA:A   0  BSAS  7200 0/0               1695759/3472914816 </span><br><span class="line">partner 0a.00.3 0a    0   3   SA:A   0  BSAS  7200 0/0               1695759/3472914816 </span><br><span class="line">FAS2240-A*&gt; disk show -v</span><br><span class="line">  DISK       OWNER                  POOL   SERIAL NUMBER           HOME                     CHKSUM</span><br><span class="line">------------ -------------          -----  -------------           -------------            ------</span><br><span class="line">0a.00.0      FAS2240-A (1897445747)    Pool0  WD-WCAY01059319       FAS2240-A (1897445747)  Block</span><br><span class="line">0a.00.9      FAS2240-A (1897445747)    Pool0  WD-WCAY01110442       FAS2240-A (1897445747)  Block</span><br><span class="line">0a.00.11     FAS2240-A (1897445747)    Pool0  WD-WCAY01118699       FAS2240-A (1897445747)  Block</span><br><span class="line">0a.00.3      FAS2240-B (1897447544)    Pool0  WD-WCAY01148720       FAS2240-B (1897447544)  Block</span><br><span class="line">0a.00.5      FAS2240-B (1897447544)    Pool0  WD-WCAY01110637       FAS2240-B (1897447544)  Block</span><br><span class="line">0a.00.6      FAS2240-A (1897445747)    Pool0  WD-WCAY01138268       FAS2240-A (1897445747)  Block</span><br><span class="line">0a.00.8      FAS2240-A (1897445747)    Pool0  WD-WCAY01140234       FAS2240-A (1897445747)  Block</span><br><span class="line">0a.00.7      FAS2240-A (1897445747)    Pool0  WD-WCAY01148812       FAS2240-A (1897445747)  Block</span><br><span class="line">0a.00.10     FAS2240-A (1897445747)    Pool0  WD-WCAY01059555       FAS2240-A (1897445747)  Block</span><br><span class="line">0a.00.1      FAS2240-A (1897445747)    Pool0  WD-WCAY01110728       FAS2240-A (1897445747)  Block</span><br><span class="line">0a.00.4      FAS2240-A (1897445747)    Pool0  WD-WCAY01140030       FAS2240-A (1897445747)  Block</span><br><span class="line">0a.00.2      FAS2240-A (1897445747)    Pool0  YGHNUAWA              FAS2240-A (1897445747)  Block</span><br><span class="line">FAS2240-A*&gt; Sun Oct 20 20:11:00 CST [FAS2240-A:monitor.globalStatus.nonCritical:warning]: Disk on adapter 0a, shelf 0, bay 2, failed.</span><br></pre></td></tr></table></figure><p>使用命令标记该盘为正常磁盘</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">FAS2240-A*&gt; disk unfail  -s 0a.00.2</span><br><span class="line">disk unfail: unfailing disk 0a.00.2...</span><br><span class="line">FAS2240-A*&gt; disk show -v           </span><br><span class="line">  DISK       OWNER                  POOL   SERIAL NUMBER           HOME                     CHKSUM</span><br><span class="line">------------ -------------          -----  -------------           -------------            ------</span><br><span class="line">0a.00.0      FAS2240-A (1897445747)    Pool0  WD-WCAY01059319       FAS2240-A (1897445747)  Block</span><br><span class="line">0a.00.9      FAS2240-A (1897445747)    Pool0  WD-WCAY01110442       FAS2240-A (1897445747)  Block</span><br><span class="line">0a.00.11     FAS2240-A (1897445747)    Pool0  WD-WCAY01118699       FAS2240-A (1897445747)  Block</span><br><span class="line">0a.00.3      FAS2240-B (1897447544)    Pool0  WD-WCAY01148720       FAS2240-B (1897447544)  Block</span><br><span class="line">0a.00.5      FAS2240-B (1897447544)    Pool0  WD-WCAY01110637       FAS2240-B (1897447544)  Block</span><br><span class="line">0a.00.6      FAS2240-A (1897445747)    Pool0  WD-WCAY01138268       FAS2240-A (1897445747)  Block</span><br><span class="line">0a.00.8      FAS2240-A (1897445747)    Pool0  WD-WCAY01140234       FAS2240-A (1897445747)  Block</span><br><span class="line">0a.00.7      FAS2240-A (1897445747)    Pool0  WD-WCAY01148812       FAS2240-A (1897445747)  Block</span><br><span class="line">0a.00.10     FAS2240-A (1897445747)    Pool0  WD-WCAY01059555       FAS2240-A (1897445747)  Block</span><br><span class="line">0a.00.1      FAS2240-A (1897445747)    Pool0  WD-WCAY01110728       FAS2240-A (1897445747)  Block</span><br><span class="line">0a.00.4      FAS2240-A (1897445747)    Pool0  WD-WCAY01140030       FAS2240-A (1897445747)  Block</span><br><span class="line">0a.00.2      FAS2240-A (1897445747)    Pool0  YGHNUAWA              FAS2240-A (1897445747)  Block</span><br><span class="line">FAS2240-A*&gt; sysconfig -r           </span><br><span class="line">Aggregate aggr0 (online, raid_dp) (block checksums)</span><br><span class="line">  Plex /aggr0/plex0 (online, normal, active, pool0)</span><br><span class="line">    RAID group /aggr0/plex0/rg0 (normal, block checksums)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      RAID DiskDevice  HA  SHELF BAY CHAN Pool Type  RPM  Used (MB/blks)    Phys (MB/blks)</span><br><span class="line">      ---------------  ------------- ---- ---- ---- ----- --------------    --------------</span><br><span class="line">      dparity 0a.00.0 0a    0   0   SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line">      parity  0a.00.110a    0   11  SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line">      data    0a.00.4 0a    0   4   SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line">      data    0a.00.6 0a    0   6   SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line">      data    0a.00.7 0a    0   7   SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line">      data    0a.00.8 0a    0   8   SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line">      data    0a.00.9 0a    0   9   SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line">      data    0a.00.100a    0   10  SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line">      data    0a.00.1 0a    0   1   SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line"></span><br><span class="line">Pool1 spare disks (empty)</span><br><span class="line">Pool0 spare disks</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RAID DiskDevice  HA  SHELF BAY CHAN Pool Type  RPM  Used (MB/blks)    Phys (MB/blks)</span><br><span class="line">---------------  ------------- ---- ---- ---- ----- --------------    --------------</span><br><span class="line">Spare disks for block checksum</span><br><span class="line">spare   0a.00.2 0a    0   2   SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 (not zeroed)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Partner disks</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RAID DiskDevice  HA  SHELF BAY CHAN Pool Type  RPM  Used (MB/blks)    Phys (MB/blks)</span><br><span class="line">---------------  ------------- ---- ---- ---- ----- --------------    --------------</span><br><span class="line">partner 0a.00.5 0a    0   5   SA:A   0  BSAS  7200 0/0               1695759/3472914816 </span><br><span class="line">partner 0a.00.3 0a    0   3   SA:A   0  BSAS  7200 0/0               1695759/3472914816 </span><br><span class="line">FAS2240-A*&gt; aggr status -s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Pool1 spare disks (empty)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Pool0 spare disks</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RAID DiskDevice  HA  SHELF BAY CHAN Pool Type  RPM  Used (MB/blks)    Phys (MB/blks)</span><br><span class="line">---------------  ------------- ---- ---- ---- ----- --------------    --------------</span><br><span class="line">Spare disks for block checksum</span><br><span class="line">spare   0a.00.2 0a    0   2   SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 (not zeroed)</span><br><span class="line">FAS2240-A*&gt; vol status -s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Pool1 spare disks (empty)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Pool0 spare disks</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RAID DiskDevice  HA  SHELF BAY CHAN Pool Type  RPM  Used (MB/blks)    Phys (MB/blks)</span><br><span class="line">---------------  ------------- ---- ---- ---- ----- --------------    --------------</span><br><span class="line">Spare disks for block checksum</span><br><span class="line">spare   0a.00.2 0a    0   2   SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 (not zeroed)</span><br></pre></td></tr></table></figure><p>热备盘为not zeroed，重新格式化该磁盘</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FAS2240-A*&gt; disk zero spares</span><br></pre></td></tr></table></figure><p>执行命令查看格式化进度，直至格式化完毕</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">FAS2240-A*&gt; vol status -s   </span><br><span class="line">Pool1 spare disks (empty)</span><br><span class="line">Pool0 spare disks</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RAID DiskDevice  HA  SHELF BAY CHAN Pool Type  RPM  Used (MB/blks)    Phys (MB/blks)</span><br><span class="line">---------------  ------------- ---- ---- ---- ----- --------------    --------------</span><br><span class="line">Spare disks for block checksum</span><br><span class="line">spare   0a.00.2 0a    0   2   SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 (zeroing, 0% done)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">FAS2240-A*&gt; vol status -s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Pool1 spare disks (empty)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Pool0 spare disks</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RAID DiskDevice  HA  SHELF BAY CHAN Pool Type  RPM  Used (MB/blks)    Phys (MB/blks)</span><br><span class="line">---------------  ------------- ---- ---- ---- ----- --------------    --------------</span><br><span class="line">Spare disks for block checksum</span><br><span class="line">spare   0a.00.2 0a    0   2   SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 (zeroing, 8% done)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">FAS2240-A*&gt; vol status -s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Pool1 spare disks (empty)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Pool0 spare disks</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RAID DiskDevice  HA  SHELF BAY CHAN Pool Type  RPM  Used (MB/blks)    Phys (MB/blks)</span><br><span class="line">---------------  ------------- ---- ---- ---- ----- --------------    --------------</span><br><span class="line">Spare disks for block checksum</span><br><span class="line">spare   0a.00.2 0a    0   2   SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 (zeroing, 11% done)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">FAS2240-A&gt; vol status -s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Pool1 spare disks (empty)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Pool0 spare disks</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RAID DiskDevice  HA  SHELF BAY CHAN Pool Type  RPM  Used (MB/blks)    Phys (MB/blks)</span><br><span class="line">---------------  ------------- ---- ---- ---- ----- --------------    --------------</span><br><span class="line">Spare disks for block checksum</span><br><span class="line">spare   0a.00.2 0a    0   2   SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line">FAS2240-A&gt; sysconfig -r</span><br><span class="line">Aggregate aggr0 (online, raid_dp) (block checksums)</span><br><span class="line">  Plex /aggr0/plex0 (online, normal, active, pool0)</span><br><span class="line">    RAID group /aggr0/plex0/rg0 (normal, block checksums)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      RAID DiskDevice  HA  SHELF BAY CHAN Pool Type  RPM  Used (MB/blks)    Phys (MB/blks)</span><br><span class="line">      ---------------  ------------- ---- ---- ---- ----- --------------    --------------</span><br><span class="line">      dparity 0a.00.0 0a    0   0   SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line">      parity  0a.00.110a    0   11  SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line">      data    0a.00.4 0a    0   4   SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line">      data    0a.00.6 0a    0   6   SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line">      data    0a.00.7 0a    0   7   SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line">      data    0a.00.8 0a    0   8   SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line">      data    0a.00.9 0a    0   9   SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line">      data    0a.00.100a    0   10  SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line">      data    0a.00.1 0a    0   1   SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Pool1 spare disks (empty)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Pool0 spare disks</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RAID DiskDevice  HA  SHELF BAY CHAN Pool Type  RPM  Used (MB/blks)    Phys (MB/blks)</span><br><span class="line">---------------  ------------- ---- ---- ---- ----- --------------    --------------</span><br><span class="line">Spare disks for block checksum</span><br><span class="line">spare   0a.00.2 0a    0   2   SA:A   0  BSAS  7200 1695466/3472315904 1695759/3472914816 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Partner disks</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RAID DiskDevice  HA  SHELF BAY CHAN Pool Type  RPM  Used (MB/blks)    Phys (MB/blks)</span><br><span class="line">---------------  ------------- ---- ---- ---- ----- --------------    --------------</span><br><span class="line">partner 0a.00.5 0a    0   5   SA:A   0  BSAS  7200 0/0               1695759/3472914816 </span><br><span class="line">partner 0a.00.3 0a    0   3   SA:A   0  BSAS  7200 0/0               1695759/3472914816 </span><br></pre></td></tr></table></figure><p>到这里，全流程更换完毕！</p><p>欢迎联系我一起讨论。我的微信号：Eric_xu_2023</p><p>也欢迎关注我的公众号：</p><img alt="1.png" src="https://oss-emcsprod-public.modb.pro/image/editor/20251010-1976625582993584128_3605.png" referrerpolicy="no-referrer"/>]]></content>
      
      
      <categories>
          
          <category> IT Hardware Maintenance </category>
          
      </categories>
      
      
        <tags>
            
            <tag> netapp </tag>
            
            <tag> storage </tag>
            
            <tag> hardware maintenance </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>银河麒麟V10_x86一键更新openssh10.2p1</title>
      <link href="/post/b04c611b.html"/>
      <url>/post/b04c611b.html</url>
      
        <content type="html"><![CDATA[<p>昨天刚做出来opessh10.1p1的安装包，今天登录openssh网站就发现又更新了，事出反常，肯定是出来不小的问题才更新这么快。</p><div style="position:relative;padding-bottom:56.25%;width:100%;height:0;">     <iframe src="https://player.bilibili.com/player.html?isOutside=true&amp;aid=115350238665617&bvid=BV1dV4HzTEaq&cid=32972934127;page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" style="position:absolute;height:100%;width:100%;"></iframe></div><p>想要获取一键安装包可以关注我的公众号联系我获取。</p><img alt="1.png" src="https://oss-emcsprod-public.modb.pro/image/editor/20251010-1976625582993584128_3605.png" referrerpolicy="no-referrer"/><p>今天主要说2个问题：</p><p>1.这么快更新了openssh 10.2解决了啥问题？</p><p>2.顺便说一下这次编译遇到的问题。具体如何编译RPM包，可以看我之前的文章介绍了。<a href="https://mp.weixin.qq.com/s/Uz5dDzvP7mSXNjuD1fxpMQ">手搓OPENSSH安装RPM包</a></p><h2 id="更新openssh-10-2解决问题"><a href="#更新openssh-10-2解决问题" class="headerlink" title="更新openssh 10.2解决问题"></a>更新openssh 10.2解决问题</h2><p>本版本为漏洞修复版本，主要修复了 “启用 ControlPersist 后导致 <code>ssh(1)</code> 无法使用” 的问题。</p><h3 id="漏洞修复"><a href="#漏洞修复" class="headerlink" title="漏洞修复"></a>漏洞修复</h3><ol><li><strong><code>ssh(1)</code></strong>：修复了 “ControlPersist 处于活跃状态时，终端连接处理异常导致会话无法使用” 的问题（漏洞编号：bz3872）。</li><li><strong><code>ssh-keygen(1)</code></strong>：修复了 “从 PKCS#11 令牌下载密钥” 的功能异常。</li><li><strong><code>ssh-keygen(1)</code></strong>：修复了 “CA 密钥存储在 <code>ssh-agent(1)</code> 中时，CA 签名操作失败” 的问题（漏洞编号：bz3877）。</li></ol><h3 id="可移植性优化"><a href="#可移植性优化" class="headerlink" title="可移植性优化"></a>可移植性优化</h3><ul><li><p><strong>全组件</strong>：支持无 <code>mmap(2)</code> 函数的平台，例如 WASM 构建版本（示例：<a href="https://hterm.org/">https://hterm.org</a>）。</p></li><li><p><strong>全组件</strong>：修复了 FreeBSD 系统上因缺少 <code>fnctl.h</code> 头文件导致的构建失败问题。</p></li><li><p><strong>全组件</strong>：修复了 MacOS 10.12（Sierra）以下版本因缺少 <code>clock_gettime(3)</code> 函数导致的构建失败问题。</p></li><li><p><strong><code>sshd(8)</code></strong>：若远程主机名为 “UNKNOWN” 占位符，将不执行 <code>PAM_RHOST</code> 操作。此优化可避免部分 PAM 模块尝试解析该主机名时可能出现的挂起问题。需注意，仅当连接不通过 IPv4 或 IPv6 套接字建立时，<code>sshd(8)</code> 才会使用 “UNKNOWN” 作为主机名。</p></li></ul><h2 id="编译遇到的错误及解决办法"><a href="#编译遇到的错误及解决办法" class="headerlink" title="编译遇到的错误及解决办法"></a>编译遇到的错误及解决办法</h2><p>还是用脚本编译最新的安装包，遇到个错误</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">~/openssh-rpms-main/el7 ~/openssh-rpms-main</span><br><span class="line">‘/root/openssh-rpms-main/downloads/openssh-10.2p1.tar.gz’ -&gt; ‘./SOURCES/openssh-10.2p1.tar.gz’</span><br><span class="line">‘/root/openssh-rpms-main/downloads/openssl-3.0.18.tar.gz’ -&gt; ‘./SOURCES/openssl-3.0.18.tar.gz’</span><br><span class="line">‘/root/openssh-rpms-main/downloads/x11-ssh-askpass-1.2.4.1.tar.gz’ -&gt; ‘./SOURCES/x11-ssh-askpass-1.2.4.1.tar.gz’</span><br><span class="line">Executing(%prep): /bin/sh -e /var/tmp/rpm-tmp.CUAJLh</span><br><span class="line">+ umask 022</span><br><span class="line">+ cd /root/openssh-rpms-main/el7/BUILD</span><br><span class="line">+ cd /root/openssh-rpms-main/el7/BUILD</span><br><span class="line">+ rm -rf openssh-10.2p1</span><br><span class="line">+ /usr/bin/gzip -dc /root/openssh-rpms-main/el7/SOURCES/openssh-10.2p1.tar.gz</span><br><span class="line">+ /usr/bin/tar -xf -</span><br><span class="line">+ STATUS=0</span><br><span class="line">+ &#x27;[&#x27; 0 -ne 0 &#x27;]&#x27;</span><br><span class="line">+ cd openssh-10.2p1</span><br><span class="line">+ /usr/bin/chmod -Rf a+rX,u+w,g-w,o-w .</span><br><span class="line">+ mkdir -p openssl</span><br><span class="line">+ tar xfz /root/openssh-rpms-main/el7/SOURCES/openssl-3.0.18.tar.gz --strip-components=1 -C openssl</span><br><span class="line">+ pushd openssl</span><br><span class="line">~/openssh-rpms-main/el7/BUILD/openssh-10.2p1/openssl ~/openssh-rpms-main/el7/BUILD/openssh-10.2p1</span><br><span class="line">+ ./config shared zlib -fPIC</span><br><span class="line">Configuring OpenSSL version 3.0.18 for target linux-x86_64</span><br><span class="line">Using os-specific seed configuration</span><br><span class="line">Created configdata.pm</span><br><span class="line">Running configdata.pm</span><br><span class="line">Created Makefile.in</span><br><span class="line">Can&#x27;t locate Time/Piece.pm in @INC (@INC contains: . /root/openssh-rpms-main/el7/BUILD/openssh-10.2p1/openssl/Configurations /root/openssh-rpms-main/el7/BUILD/openssh-10.2p1/openssl/util/perl /usr/local/lib64/perl5 /usr/local/share/perl5 /usr/lib64/perl5/vendor_perl /usr/share/perl5/vendor_perl /usr/lib64/perl5 /usr/share/perl5 /root/openssh-rpms-main/el7/BUILD/openssh-10.2p1/openssl/external/perl/Text-Template-1.56/lib) at Makefile.in line 37.</span><br><span class="line">BEGIN failed--compilation aborted at Makefile.in line 37.</span><br><span class="line">error: Bad exit status from /var/tmp/rpm-tmp.CUAJLh (%prep)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RPM build errors:</span><br><span class="line">    Bad exit status from /var/tmp/rpm-tmp.CUAJLh (%prep)</span><br></pre></td></tr></table></figure><p>错误的原因可能是当你在运行 Perl 脚本时遇到 <em>Can’t locate time&#x2F;piece.pm in @INC</em> 错误，这意味着 Perl 无法找到所需的模块 <em>Time::Piece</em>。这通常是因为该模块尚未安装。</p><p>示例</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Can&amp;#39;t locate Time/Piece.pm in @INC (@INC contains: /etc/perl /usr/local/lib/perl5 /usr/local/share/perl5 /usr/lib/perl5 /usr/share/perl5 .) at script.pl line 1</span><br></pre></td></tr></table></figure><p>解决的办法就是安装该模块</p><p><strong>错误处理过程</strong></p><p>确保你的机器连网，执行以下命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -MCPAN -e &#x27;install Time::Piece&#x27;</span><br></pre></td></tr></table></figure><p>然后一路回车，开始安装，遇到提示就是回车，之后重新编译openssh安装包</p>]]></content>
      
      
      <categories>
          
          <category> 操作系统_linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> openssh </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Centos7_x86一键更新openssh10.1p1</title>
      <link href="/post/a7c8ab66.html"/>
      <url>/post/a7c8ab66.html</url>
      
        <content type="html"><![CDATA[<h2 id="如何完成一键更新OPENSSH"><a href="#如何完成一键更新OPENSSH" class="headerlink" title="如何完成一键更新OPENSSH"></a>如何完成一键更新OPENSSH</h2><p>我己经制作好了一键安装脚本和RPM软件包，完美适配centos7&#x2F;8</p><div style="position:relative;padding-bottom:56.25%;width:100%;height:0;">     <iframe src="https://player.bilibili.com/player.html?isOutside=true&amp;aid=115344299528429&bvid=BV1mHxCz7EYK&cid=32946720040;page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" style="position:absolute;height:100%;width:100%;"></iframe></div><p>想要获取一键安装包可以关注我的公众号联系我获取</p><img alt="1.png" src="https://oss-emcsprod-public.modb.pro/image/editor/20251010-1976625582993584128_3605.png" referrerpolicy="no-referrer"/><h2 id="openssh更新了啥？"><a href="#openssh更新了啥？" class="headerlink" title="openssh更新了啥？"></a>openssh更新了啥？</h2><p>OpenSSH 10.1 版本核心变更对照表</p><table><thead><tr><th>变更类型</th><th>涉及组件</th><th>关键影响与核心内容</th></tr></thead><tbody><tr><td><strong>未来弃用警告</strong></td><td>全组件</td><td>弃用SHA1格式SSHFP记录，仅保留SHA256格式；SHA256自2012年OpenSSH 6.1起已支持。</td></tr><tr><td><strong>潜在不兼容变更</strong></td><td>ssh(1)</td><td>非后量子密钥协商算法触发警告，可通过<code>WarnWeakCrypto</code>配置控制（默认开启）。</td></tr><tr><td></td><td>ssh(1)、sshd(8)</td><td>DSCP&#x2F;IPQoS逻辑重构：交互式流量默认用EF类别，非交互式用系统默认，支持动态切换。</td></tr><tr><td></td><td>ssh(1)、sshd(8)</td><td>弃用IPQoS中的ToS关键字（lowdelay&#x2F;reliability&#x2F;throughput），改用DSCP。</td></tr><tr><td></td><td>ssh-add(1)</td><td>证书过期时间+5分钟宽限期，代理自动清理过期证书；<code>ssh-add -N</code>可禁用此功能。</td></tr><tr><td></td><td>全组件</td><td>移除XMSS密钥实验性支持，计划后续实现新后量子签名方案。</td></tr><tr><td></td><td>ssh-agent(1)、sshd(8)</td><td>代理套接字从<code>/tmp</code>迁移至<code>~/.ssh/agent</code>，新增自动清理功能与多个控制选项（-U&#x2F;-u等）。</td></tr><tr><td><strong>安全修复</strong></td><td>ssh(1)</td><td>禁止用户名含控制字符、URI含<code>\0</code>字符，防范shell注入；可信配置文件用户名无此限制。</td></tr><tr><td><strong>新增功能</strong></td><td>ssh(1)、sshd(8)</td><td>新增SIGINFO处理器，记录活跃通道与会话信息。</td></tr><tr><td></td><td>sshd(8)</td><td>拒绝证书认证时，额外记录证书标识信息，便于调试。</td></tr><tr><td></td><td>ssh(1)、ssh-agent(1)</td><td>支持PKCS#11令牌上的ed25519密钥。</td></tr><tr><td></td><td>ssh(1)</td><td>新增<code>RefuseConnection</code>配置项，可在配置中添加连接阻断提醒（如弃用主机提示）。</td></tr><tr><td></td><td>sshd(8)</td><td>X11显示号检查适配<code>X11DisplayOffset</code>，支持更高端口范围配置。</td></tr><tr><td></td><td>测试框架</td><td>新增基准测试功能，OpenBSD用<code>make UNITTEST_BENCHMARK=yes</code>，Portable版用<code>make unit-bench</code>。</td></tr><tr><td><strong>漏洞修复</strong></td><td>sshd(8)</td><td>修复<code>MaxStartups</code>进程跟踪异常，避免插槽占满导致拒绝新连接。</td></tr><tr><td></td><td>ssh(1)</td><td>修复启用<code>ObscureKeystrokeTiming</code>时X客户端启动延迟问题（bz#3820）。</td></tr><tr><td></td><td>sshd(8)</td><td>配置文件最大限制从256KB提升至4MB，超限时提前报错。</td></tr><tr><td></td><td>全组件</td><td>修复多处内存泄漏，优化日志显示（如密钥加载失败详情、<code>PermitRootLogin</code>别名修正）。</td></tr><tr><td><strong>可移植性优化</strong></td><td>sshd(8)</td><td>检查PAM事务用户名变更，避免配置错误导致的授权异常；FreeBSD适配<code>SSH_TUN_COMPAT_AF</code>。</td></tr><tr><td></td><td>全组件</td><td>补充缺失系统头文件，减少跨平台编译差异；macOS适配<code>nlist</code>函数检查逻辑。</td></tr><tr><td></td><td>ssh-agent(1)</td><td>systemd套接字激活模式下，<code>SIGTERM</code>退出返回0，避免服务错误标记为“失败”。</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> 操作系统_linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> openssh </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>处理一则Oracle未能完全引用大页问题</title>
      <link href="/post/b2a8ff3d.html"/>
      <url>/post/b2a8ff3d.html</url>
      
        <content type="html"><![CDATA[<h2 id="关于配置大页"><a href="#关于配置大页" class="headerlink" title="关于配置大页"></a>关于配置大页</h2><p>大页是啥我就不具体介绍了，网上介绍的文章很多，大多安装数据库的文章都有这么一步告诉大家配置大页，我只想说说错误的使用情况：</p><p>那就是大页内存配置成功了，但是数据库却有正确使用大页，等数据库启动后就只能用少得可怜的普通内存，导致内存不足影响性能，如果数据库服务器上再跑个ETL进程或者其它应用，那么可能会导致数据库性能严重下降。</p><p>在数据库交流群里也遇到过好几次这类的问题，非常的典型，配置完大页记得检查下有没有使用，避免此类问题。</p><p>我之前也写过一篇关于如何在aix 系统上开启大页内存的文章，测试效果还不错。</p><p><strong>然而，大多数环境即使你不配置大页也没啥问题</strong>，因为大多数系统虽然用了oracle，但并不是说满负荷运行且硬件没有上升空间了。</p><p>以前刚入行的时候也犯过这个错误，比如最近在给同事检查7年前我安装的数据库服务器，我就发现了我配置了大页却没有使用。。。虽说是个不太繁忙的业务系统，但还是经验不足当时，只是照着别人写的文档来装就完了，啥也不懂。</p><p><strong>下面说个最近遇到的场景，大页没有完全使用</strong>：操作系统是oracle linux 9.6  数据库是11.2.0.4 rac </p><p>当然这个问题仅限于11G，因为之后的版本己经没有这个参数了。</p><p>多说一句：在11gR2版本的数据库，use_large_pages的默认值是TRUE。通常不用再修改</p><h2 id="问题场景"><a href="#问题场景" class="headerlink" title="问题场景"></a>问题场景</h2><p>给oracle 11g配置了大页，但是查看告警日志启动时有个报错说是有个参数被disable了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Starting ORACLE instance (normal)</span><br><span class="line">************************ Large Pages Information *******************</span><br><span class="line">Per process system memlock (soft) limit = UNLIMITED</span><br><span class="line"></span><br><span class="line">Large page usage restricted to processor group &quot;user.slice&quot;</span><br><span class="line"></span><br><span class="line">Total Shared Global Region in Large Pages = 100 GB (100%)</span><br><span class="line"></span><br><span class="line">WARNING:</span><br><span class="line">  The parameter _linux_prepage_large_pages is explicitly disabled.</span><br><span class="line">  Oracle strongly recommends setting the _linux_prepage_large_pages</span><br><span class="line">  parameter since the instance  is running in a Processor Group. If there is</span><br><span class="line">  insufficient large page memory, instance may encounter SIGBUS error</span><br><span class="line">  and may terminate abnormally.</span><br><span class="line"></span><br><span class="line">Large Pages used by this instance: 51201 (100 GB)</span><br><span class="line">Large Pages unused in Processor Group user.slice = 82444 (161 GB)</span><br><span class="line">Large Pages configured in Processor Group user.slice = 82445 (161 GB)</span><br><span class="line">Large Page size = 2048 KB</span><br><span class="line"></span><br><span class="line">********************************************************************</span><br></pre></td></tr></table></figure><p>于是检查了一下大页的使用情况，发现大页确实没有被完全使用，只是用了一部分，使用的部分：</p><p>82445-74789&#x3D;7656*2MB&#x3D;15312MB，一共才不到15G</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@dbnode2 ~]# cat /proc/meminfo |grep Hug</span><br><span class="line">AnonHugePages:         0 kB</span><br><span class="line">ShmemHugePages:        0 kB</span><br><span class="line">FileHugePages:         0 kB</span><br><span class="line">HugePages_Total:   82445</span><br><span class="line">HugePages_Free:    74789</span><br><span class="line">HugePages_Rsvd:    43545</span><br><span class="line">HugePages_Surp:        0</span><br><span class="line">Hugepagesize:       2048 kB</span><br><span class="line">Hugetlb:        168847360 kB</span><br></pre></td></tr></table></figure><p>检查下配置文件，我这里大页配置的有点大161G，实际内存SGA只配置了100G。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[oracle@dbnode2:/u01/app/oracle/diag/rdbms/dbm/dbm2/trace]$ grep -v &#x27;^#&#x27; /etc/sysctl.conf</span><br><span class="line">kernel.shmmni = 4096</span><br><span class="line">fs.aio-max-nr = 1048576</span><br><span class="line">fs.file-max = 6815744</span><br><span class="line">kernel.sem = 250 32000 100 128</span><br><span class="line">net.ipv4.ip_local_port_range = 9000 65500</span><br><span class="line">net.core.rmem_default = 262144</span><br><span class="line">net.core.rmem_max = 4194304</span><br><span class="line">net.core.wmem_default = 262144</span><br><span class="line">net.core.wmem_max = 1048586</span><br><span class="line">vm.swappiness = 10</span><br><span class="line">kernel.shmmax= 229633380966</span><br><span class="line">kernel.shmall = 56062837</span><br><span class="line">vm.nr_hugepages = 82445</span><br><span class="line"></span><br><span class="line">[oracle@dbnode2:/u01/app/oracle/diag/rdbms/dbm/dbm2/trace]$  grep -v &#x27;^#&#x27; /etc/security/limits.conf</span><br><span class="line">oracle soft nofile 1024</span><br><span class="line">oracle hard nofile 65536</span><br><span class="line">oracle soft stack 10240</span><br><span class="line">oracle hard stack 32768</span><br><span class="line">oracle soft nproc 2047</span><br><span class="line">oracle hard nproc 16384</span><br><span class="line">oracle hard memlock 134217728</span><br><span class="line">oracle soft memlock 134217728</span><br><span class="line">grid soft nofile 1024</span><br><span class="line">grid hard nofile 65536</span><br><span class="line">grid soft stack 10240</span><br><span class="line">grid hard stack 32768</span><br><span class="line">grid soft nproc 2047</span><br><span class="line">grid hard nproc 16384</span><br></pre></td></tr></table></figure><h2 id="问题修复"><a href="#问题修复" class="headerlink" title="问题修复"></a>问题修复</h2><p>接下来尝试修改数据库参数并重新调整大页大小。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter system set &quot;_linux_prepage_large_pages&quot;=TRUE scope=spfile;</span><br></pre></td></tr></table></figure><p>修改sysctl.conf，配置大页100G</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vm.nr_hugepages = 51210</span><br></pre></td></tr></table></figure><p><strong>配置完后为确保内存释放最好是重启下服务器</strong>。之后再次启动数据库查看报警没有了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Starting ORACLE instance (normal)</span><br><span class="line">Tue Sep 16 23:51:33 2025</span><br><span class="line">************************ Large Pages Information *******************</span><br><span class="line">Per process system memlock (soft) limit = UNLIMITED</span><br><span class="line">Large page usage restricted to processor group &quot;user.slice&quot;</span><br><span class="line">Total Shared Global Region in Large Pages = 100 GB (100%)</span><br><span class="line">Large Pages in Shared Memory Region are prepaged</span><br><span class="line">Large Pages used by this instance: 51201 (100 GB)</span><br><span class="line">Large Pages unused in Processor Group user.slice = 31244 (61 GB)</span><br><span class="line">Large Pages configured in Processor Group user.slice = 82445 (161 GB)</span><br><span class="line">Large Page size = 2048 KB</span><br><span class="line"></span><br><span class="line">********************************************************************</span><br></pre></td></tr></table></figure><p>再确认下大页使用情况，这次全部使用了（配置的时候我多写了9个，这里显示剩余正常）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@dbnode2 ~]# cat /proc/meminfo |grep Hug</span><br><span class="line">AnonHugePages:         0 kB</span><br><span class="line">ShmemHugePages:        0 kB</span><br><span class="line">FileHugePages:         0 kB</span><br><span class="line">HugePages_Total:   51210</span><br><span class="line">HugePages_Free:        9</span><br><span class="line">HugePages_Rsvd:        0</span><br><span class="line">HugePages_Surp:        0</span><br><span class="line">Hugepagesize:       2048 kB</span><br><span class="line">Hugetlb:        104878080 kB</span><br></pre></td></tr></table></figure><h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><p>大页计算官方脚本，记得chmod+x后使用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">!/bin/bash</span><br><span class="line">#</span><br><span class="line"># hugepages_settings.sh</span><br><span class="line">#</span><br><span class="line"># Linux bash script to compute values for the</span><br><span class="line"># recommended HugePages/HugeTLB configuration</span><br><span class="line"># on Oracle Linux</span><br><span class="line">#</span><br><span class="line"># Note: This script does calculation for all shared memory</span><br><span class="line"># segments available when the script is run, no matter it</span><br><span class="line"># is an Oracle RDBMS shared memory segment or not.</span><br><span class="line">#</span><br><span class="line"># This script is provided by Doc ID 401749.1 from My Oracle Support</span><br><span class="line"># http://support.oracle.com</span><br><span class="line"></span><br><span class="line"># Welcome text</span><br><span class="line">echo &quot;</span><br><span class="line">This script is provided by Doc ID 401749.1 from My Oracle Support</span><br><span class="line">(http://support.oracle.com) where it is intended to compute values for</span><br><span class="line">the recommended HugePages/HugeTLB configuration for the current shared</span><br><span class="line">memory segments on Oracle Linux. Before proceeding with the execution please note following:</span><br><span class="line"> * For ASM instance, it needs to configure ASMM instead of AMM.</span><br><span class="line"> * The &#x27;pga_aggregate_target&#x27; is outside the SGA and</span><br><span class="line">   you should accommodate this while calculating the overall size.</span><br><span class="line"> * In case you changes the DB SGA size,</span><br><span class="line">   as the new SGA will not fit in the previous HugePages configuration,</span><br><span class="line">   it had better disable the whole HugePages,</span><br><span class="line">   start the DB with new SGA size and run the script again.</span><br><span class="line">And make sure that:</span><br><span class="line"> * Oracle Database instance(s) are up and running</span><br><span class="line"> * Oracle Database Automatic Memory Management (AMM) is not setup</span><br><span class="line">   (See Doc ID 749851.1)</span><br><span class="line"> * The shared memory segments can be listed by command:</span><br><span class="line">     # ipcs -m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Press Enter to proceed...&quot;</span><br><span class="line"></span><br><span class="line">read</span><br><span class="line"></span><br><span class="line"># Check for the kernel version</span><br><span class="line">KERN=`uname -r | awk -F. &#x27;&#123; printf(&quot;%d.%d\n&quot;,$1,$2); &#125;&#x27;`</span><br><span class="line"></span><br><span class="line"># Find out the HugePage size</span><br><span class="line">HPG_SZ=`grep Hugepagesize /proc/meminfo | awk &#x27;&#123;print $2&#125;&#x27;`</span><br><span class="line">if [ -z &quot;$HPG_SZ&quot; ];then</span><br><span class="line">    echo &quot;The hugepages may not be supported in the system where the script is being executed.&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># Initialize the counter</span><br><span class="line">NUM_PG=0</span><br><span class="line"></span><br><span class="line"># Cumulative number of pages required to handle the running shared memory segments</span><br><span class="line">for SEG_BYTES in `ipcs -m | cut -c44-300 | awk &#x27;&#123;print $1&#125;&#x27; | grep &quot;[0-9][0-9]*&quot;`</span><br><span class="line">do</span><br><span class="line">    MIN_PG=`echo &quot;$SEG_BYTES/($HPG_SZ*1024)&quot; | bc -q`</span><br><span class="line">    if [ $MIN_PG -gt 0 ]; then</span><br><span class="line">        NUM_PG=`echo &quot;$NUM_PG+$MIN_PG+1&quot; | bc -q`</span><br><span class="line">    fi</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">RES_BYTES=`echo &quot;$NUM_PG * $HPG_SZ * 1024&quot; | bc -q`</span><br><span class="line"></span><br><span class="line"># An SGA less than 100MB does not make sense</span><br><span class="line"># Bail out if that is the case</span><br><span class="line">if [ $RES_BYTES -lt 100000000 ]; then</span><br><span class="line">    echo &quot;***********&quot;</span><br><span class="line">    echo &quot;** ERROR **&quot;</span><br><span class="line">    echo &quot;***********&quot;</span><br><span class="line">    echo &quot;Sorry! There are not enough total of shared memory segments allocated for</span><br><span class="line">HugePages configuration. HugePages can only be used for shared memory segments</span><br><span class="line">that you can list by command:</span><br><span class="line"></span><br><span class="line">    # ipcs -m</span><br><span class="line"></span><br><span class="line">of a size that can match an Oracle Database SGA. Please make sure that:</span><br><span class="line"> * Oracle Database instance is up and running</span><br><span class="line"> * Oracle Database Automatic Memory Management (AMM) is not configured&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># Finish with results</span><br><span class="line">    echo &quot;Recommended setting: vm.nr_hugepages = $NUM_PG&quot;;</span><br><span class="line"></span><br><span class="line"># End</span><br></pre></td></tr></table></figure><p>欢迎联系我一起讨论。我的微信号：Eric_xu_2023</p><p>也欢迎关注我的公众号：</p><img alt="1.png" src="https://oss-emcsprod-public.modb.pro/image/editor/20251010-1976625582993584128_3605.png" referrerpolicy="no-referrer"/>]]></content>
      
      
      <categories>
          
          <category> oracle_tuning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oracle </tag>
            
            <tag> database </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
